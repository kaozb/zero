
<!DOCTYPE html>

<html lang="zh_Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Django 5.0 版本发行说明 &#8212; Django 5.0.3.dev20240221071519 文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Django 4.2.11 release notes" href="4.2.11.html" />
    <link rel="prev" title="Django 5.0.1 版本发行说明" href="5.0.1.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 5.0.3.dev20240221071519 文档</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="5.0.1.html" title="Django 5.0.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="4.2.11.html" title="Django 4.2.11 release notes">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="releases-5.0">
            
  <div class="section" id="s-django-5-0-release-notes">
<span id="django-5-0-release-notes"></span><h1>Django 5.0 版本发行说明<a class="headerlink" href="#django-5-0-release-notes" title="永久链接至标题">¶</a></h1>
<p><em>2023 年 12 月 4 日</em></p>
<p>欢迎使用 Django 5.0 ！</p>
<p>这些发布说明涵盖了 <a class="reference internal" href="#whats-new-5-0"><span class="std std-ref">新功能</span></a>，以及一些在从 Django 4.2 或更早版本升级时需要注意的 <a class="reference internal" href="#backwards-incompatible-5-0"><span class="std std-ref">不兼容变更</span></a>。我们已经 <a class="reference internal" href="#deprecated-features-5-0"><span class="std std-ref">开始了一些功能的弃用过程</span></a>。</p>
<p>如果你要更新现有的项目，请看 <a class="reference internal" href="../howto/upgrade-version.html"><span class="doc">如何将 Django 更新至新的版本</span></a> 指南。</p>
<div class="section" id="s-python-compatibility">
<span id="python-compatibility"></span><h2>Python 兼容性<a class="headerlink" href="#python-compatibility" title="永久链接至标题">¶</a></h2>
<p>Django 5.0 支持 Python 3.10、3.11 和 3.12。我们 <strong>强烈推荐</strong> 并且只官方支持每个系列的最新发布版本。</p>
<p>Django 4.2.x 系列是最后一个支持 Python 3.8 和 3.9 的版本。</p>
</div>
<div class="section" id="s-third-party-library-support-for-older-version-of-django">
<span id="third-party-library-support-for-older-version-of-django"></span><h2>对于较旧版本的 Django 的第三方库支持<a class="headerlink" href="#third-party-library-support-for-older-version-of-django" title="永久链接至标题">¶</a></h2>
<p>在 Django 5.0 发布之后，我们建议第三方应用程序的作者停止对 4.2 之前的所有 Django 版本的支持。在那时，你应该能够使用 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-Wd</span></code> 运行你包的测试，以便出现弃用警告。在进行弃用警告修复后，你的应用程序应该与 Django 5.0 兼容。</p>
</div>
<div class="section" id="s-what-s-new-in-django-5-0">
<span id="s-whats-new-5-0"></span><span id="what-s-new-in-django-5-0"></span><span id="whats-new-5-0"></span><h2>Django 5.0 新特性<a class="headerlink" href="#what-s-new-in-django-5-0" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-facet-filters-in-the-admin">
<span id="facet-filters-in-the-admin"></span><h3>管理界面中的分面过滤器<a class="headerlink" href="#facet-filters-in-the-admin" title="永久链接至标题">¶</a></h3>
<p>在管理界面的 changelist 中，当通过 UI 切换开启时，现在会显示已应用过滤器的分面计数。此行为可以通过新的 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.show_facets" title="django.contrib.admin.ModelAdmin.show_facets"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.show_facets</span></code></a> 属性进行更改。更多信息请参阅 <a class="reference internal" href="../ref/contrib/admin/filters.html#facet-filters"><span class="std std-ref">Facets</span></a>。</p>
</div>
<div class="section" id="s-simplified-templates-for-form-field-rendering">
<span id="simplified-templates-for-form-field-rendering"></span><h3>简化的表单字段渲染模板<a class="headerlink" href="#simplified-templates-for-form-field-rendering" title="永久链接至标题">¶</a></h3>
<p>Django 5.0 引入了字段组（field group）的概念，以及字段组模板。这简化了渲染 Django 表单字段的相关元素，如标签、小部件、帮助文本和错误。</p>
<p>例如，下面的模板：</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
...
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="cp">{{</span> <span class="nv">form.name.label_tag</span> <span class="cp">}}</span>
  <span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.name.help_text</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;helptext&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">form.name.auto_id</span> <span class="cp">}}</span><span class="s">_helptext&quot;</span><span class="p">&gt;</span>
      <span class="cp">{{</span> <span class="nv">form.name.help_text</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
  <span class="cp">{{</span> <span class="nv">form.name.errors</span> <span class="cp">}}</span>
  <span class="cp">{{</span> <span class="nv">form.name</span> <span class="cp">}}</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
      <span class="cp">{{</span> <span class="nv">form.email.label_tag</span> <span class="cp">}}</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.email.help_text</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;helptext&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">form.email.auto_id</span> <span class="cp">}}</span><span class="s">_helptext&quot;</span><span class="p">&gt;</span>
          <span class="cp">{{</span> <span class="nv">form.email.help_text</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
      <span class="cp">{{</span> <span class="nv">form.email.errors</span> <span class="cp">}}</span>
      <span class="cp">{{</span> <span class="nv">form.email</span> <span class="cp">}}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
      <span class="cp">{{</span> <span class="nv">form.password.label_tag</span> <span class="cp">}}</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.password.help_text</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;helptext&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">form.password.auto_id</span> <span class="cp">}}</span><span class="s">_helptext&quot;</span><span class="p">&gt;</span>
          <span class="cp">{{</span> <span class="nv">form.password.help_text</span><span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
      <span class="cp">{{</span> <span class="nv">form.password.errors</span> <span class="cp">}}</span>
      <span class="cp">{{</span> <span class="nv">form.password</span> <span class="cp">}}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
...
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>现在可以简化为：</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>
...
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="cp">{{</span> <span class="nv">form.name.as_field_group</span> <span class="cp">}}</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.email.as_field_group</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.password.as_field_group</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
...
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><a class="reference internal" href="../ref/forms/api.html#django.forms.BoundField.as_field_group" title="django.forms.BoundField.as_field_group"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_field_group()</span></code></a> 默认使用 <code class="docutils literal notranslate"><span class="pre">&quot;django/forms/field.html&quot;</span></code> 模板来渲染字段，并可以在每个项目、每个字段或每个请求的基础上进行自定义。请参阅 <a class="reference internal" href="../topics/forms/index.html#reusable-field-group-templates"><span class="std std-ref">可重用的字段组模板</span></a>。</p>
</div>
<div class="section" id="s-database-computed-default-values">
<span id="database-computed-default-values"></span><h3>数据库计算的默认值<a class="headerlink" href="#database-computed-default-values" title="永久链接至标题">¶</a></h3>
<p>新的 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.db_default" title="django.db.models.Field.db_default"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Field.db_default</span></code></a> 参数设置了一个数据库计算的默认值。例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.db.models.functions</span> <span class="kn">import</span> <span class="n">Now</span><span class="p">,</span> <span class="n">Pi</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">db_default</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">db_default</span><span class="o">=</span><span class="n">Now</span><span class="p">())</span>
    <span class="n">circumference</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">db_default</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Pi</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="s-database-generated-model-field">
<span id="database-generated-model-field"></span><h3>数据库生成的模型字段<a class="headerlink" href="#database-generated-model-field" title="永久链接至标题">¶</a></h3>
<p>新的 <a class="reference internal" href="../ref/models/fields.html#django.db.models.GeneratedField" title="django.db.models.GeneratedField"><code class="xref py py-class docutils literal notranslate"><span class="pre">GeneratedField</span></code></a> 允许创建数据库生成的列。此字段可用于所有支持的数据库后端，以创建一个始终从其他字段计算得到的字段。例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">F</span>


<span class="k">class</span> <span class="nc">Square</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">side</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GeneratedField</span><span class="p">(</span>
        <span class="n">expression</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s2">&quot;side&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">F</span><span class="p">(</span><span class="s2">&quot;side&quot;</span><span class="p">),</span>
        <span class="n">output_field</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">BigIntegerField</span><span class="p">(),</span>
        <span class="n">db_persist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-more-options-for-declaring-field-choices">
<span id="more-options-for-declaring-field-choices"></span><h3>声明字段选择项的更多选项<a class="headerlink" href="#more-options-for-declaring-field-choices" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.choices" title="django.db.models.Field.choices"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Field.choices</span></code></a> （用于模型字段）和 <a class="reference internal" href="../ref/forms/fields.html#django.forms.ChoiceField.choices" title="django.forms.ChoiceField.choices"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ChoiceField.choices</span></code></a> （用于表单字段）在声明它们的值时提供了更多的灵活性。在以前的 Django 版本中，<code class="docutils literal notranslate"><span class="pre">choices</span></code> 应该是一个包含 2 元组的列表，或者是一个 <a class="reference internal" href="../ref/models/fields.html#field-choices-enum-types"><span class="std std-ref">枚举类型</span></a> 的子类，但后者需要访问 <code class="docutils literal notranslate"><span class="pre">.choices</span></code> 属性以提供预期形式的值：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="n">Medal</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextChoices</span><span class="p">(</span><span class="s2">&quot;Medal&quot;</span><span class="p">,</span> <span class="s2">&quot;GOLD SILVER BRONZE&quot;</span><span class="p">)</span>

<span class="n">SPORT_CHOICES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;Martial Arts&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;judo&quot;</span><span class="p">,</span> <span class="s2">&quot;Judo&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;karate&quot;</span><span class="p">,</span> <span class="s2">&quot;Karate&quot;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="s2">&quot;Racket&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;badminton&quot;</span><span class="p">,</span> <span class="s2">&quot;Badminton&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;tennis&quot;</span><span class="p">,</span> <span class="s2">&quot;Tennis&quot;</span><span class="p">)]),</span>
    <span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">),</span>
<span class="p">]</span>


<span class="k">class</span> <span class="nc">Winner</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">medal</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">Medal</span><span class="o">.</span><span class="n">choices</span><span class="p">)</span>
    <span class="n">sport</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">SPORT_CHOICES</span><span class="p">)</span>
</pre></div>
</div>
<p>Django 5.0 添加了对接受映射或可调用对象的支持，而不是可迭代对象，并且不再需要直接使用 <code class="docutils literal notranslate"><span class="pre">.choices</span></code> 来扩展 <a class="reference internal" href="../ref/models/fields.html#field-choices-enum-types"><span class="std std-ref">枚举类型</span></a>：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="n">Medal</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextChoices</span><span class="p">(</span><span class="s2">&quot;Medal&quot;</span><span class="p">,</span> <span class="s2">&quot;GOLD SILVER BRONZE&quot;</span><span class="p">)</span>

<span class="n">SPORT_CHOICES</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># Using a mapping instead of a list of 2-tuples.</span>
    <span class="s2">&quot;Martial Arts&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;judo&quot;</span><span class="p">:</span> <span class="s2">&quot;Judo&quot;</span><span class="p">,</span> <span class="s2">&quot;karate&quot;</span><span class="p">:</span> <span class="s2">&quot;Karate&quot;</span><span class="p">},</span>
    <span class="s2">&quot;Racket&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;badminton&quot;</span><span class="p">:</span> <span class="s2">&quot;Badminton&quot;</span><span class="p">,</span> <span class="s2">&quot;tennis&quot;</span><span class="p">:</span> <span class="s2">&quot;Tennis&quot;</span><span class="p">},</span>
    <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">get_scores</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>


<span class="k">class</span> <span class="nc">Winner</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">medal</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">Medal</span><span class="p">)</span>  <span class="c1"># Using `.choices` not required.</span>
    <span class="n">sport</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">SPORT_CHOICES</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">get_scores</span><span class="p">)</span>  <span class="c1"># A callable is allowed.</span>
</pre></div>
</div>
<p>在内部，每当更新 <code class="docutils literal notranslate"><span class="pre">choices</span></code> 值时，提供的 <code class="docutils literal notranslate"><span class="pre">choices</span></code> 将被规范化为包含 2 元组的列表，作为规范形式。有关更多信息，请查看 <a class="reference internal" href="../ref/models/fields.html#field-choices"><span class="std std-ref">模型字段参考中的 choices</span></a>。</p>
</div>
<div class="section" id="s-minor-features">
<span id="minor-features"></span><h3>次要特性<a class="headerlink" href="#minor-features" title="永久链接至标题">¶</a></h3>
<div class="section" id="s-django-contrib-admin">
<span id="django-contrib-admin"></span><h4><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#django-contrib-admin" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.get_log_entries" title="django.contrib.admin.AdminSite.get_log_entries"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AdminSite.get_log_entries()</span></code></a> 方法允许自定义站点列出的日志条目的查询集。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.admin.AllValuesFieldListFilter</span></code>、<code class="docutils literal notranslate"><span class="pre">ChoicesFieldListFilter</span></code>、<code class="docutils literal notranslate"><span class="pre">RelatedFieldListFilter</span></code> 和 <code class="docutils literal notranslate"><span class="pre">RelatedOnlyFieldListFilter</span></code> 管理筛选器现在处理多值查询参数。</li>
<li><code class="docutils literal notranslate"><span class="pre">XRegExp</span></code> 升级到版本 5.1.1，从之前的版本 3.2.0。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.get_model_admin" title="django.contrib.admin.AdminSite.get_model_admin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AdminSite.get_model_admin()</span></code></a> 方法返回给定模型类的管理类。</li>
<li><a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.list_display" title="django.contrib.admin.ModelAdmin.list_display"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.list_display</span></code></a> 中的属性现在支持 <code class="docutils literal notranslate"><span class="pre">boolean</span></code> 属性。</li>
<li>jQuery 升级到版本 3.7.1，从之前的版本 3.6.4。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-auth">
<span id="django-contrib-auth"></span><h4><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a><a class="headerlink" href="#django-contrib-auth" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>PBKDF2 密码哈希器的默认迭代次数从 600,000 增加到 720,000。</li>
<li>现在提供了新的异步函数，使用 <code class="docutils literal notranslate"><span class="pre">a</span></code> 前缀：<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.aauthenticate" title="django.contrib.auth.aauthenticate"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.auth.aauthenticate()</span></code></a>、<a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.aget_user" title="django.contrib.auth.aget_user"><code class="xref py py-func docutils literal notranslate"><span class="pre">aget_user()</span></code></a>、<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.alogin" title="django.contrib.auth.alogin"><code class="xref py py-func docutils literal notranslate"><span class="pre">alogin()</span></code></a>、<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.alogout" title="django.contrib.auth.alogout"><code class="xref py py-func docutils literal notranslate"><span class="pre">alogout()</span></code></a> 和 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.aupdate_session_auth_hash" title="django.contrib.auth.aupdate_session_auth_hash"><code class="xref py py-func docutils literal notranslate"><span class="pre">aupdate_session_auth_hash()</span></code></a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">AuthenticationMiddleware</span></code> 现在添加了一个 <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.auser" title="django.http.HttpRequest.auser"><code class="xref py py-meth docutils literal notranslate"><span class="pre">HttpRequest.auser()</span></code></a> 异步方法，用于返回当前已登录的用户。</li>
<li>新的 <a class="reference internal" href="../topics/auth/passwords.html#django.contrib.auth.hashers.acheck_password" title="django.contrib.auth.hashers.acheck_password"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.auth.hashers.acheck_password()</span></code></a> 异步函数和 <a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.models.AbstractBaseUser.acheck_password" title="django.contrib.auth.models.AbstractBaseUser.acheck_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">AbstractBaseUser.acheck_password()</span></code></a> 方法允许异步检查用户密码。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-contenttypes">
<span id="django-contrib-contenttypes"></span><h4><a class="reference internal" href="../ref/contrib/contenttypes.html#module-django.contrib.contenttypes" title="django.contrib.contenttypes: Provides generic interface to installed models."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.contenttypes</span></code></a><a class="headerlink" href="#django-contrib-contenttypes" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.prefetch_related" title="django.db.models.query.QuerySet.prefetch_related"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.prefetch_related()</span></code></a> 现在支持在结果集中存在非同质的情况下预取 <a class="reference internal" href="../ref/contrib/contenttypes.html#django.contrib.contenttypes.fields.GenericForeignKey" title="django.contrib.contenttypes.fields.GenericForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">GenericForeignKey</span></code></a>。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-gis">
<span id="django-contrib-gis"></span><h4><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#django-contrib-gis" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.ClosestPoint" title="django.contrib.gis.db.models.functions.ClosestPoint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClosestPoint()</span></code></a> 函数返回几何图形上距离另一个几何图形最近的二维点。</li>
<li><a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#gis-aggregation-functions"><span class="std std-ref">GIS 聚合函数</span></a> 现在支持 <code class="docutils literal notranslate"><span class="pre">filter</span></code> 参数。</li>
<li>添加了对 GDAL 3.7 和 GEOS 3.12 的支持。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.GEOSGeometry.equals_identical" title="django.contrib.gis.geos.GEOSGeometry.equals_identical"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GEOSGeometry.equals_identical()</span></code></a> 方法允许逐点等价检查几何图形。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-messages">
<span id="django-contrib-messages"></span><h4><a class="reference internal" href="../ref/contrib/messages.html#module-django.contrib.messages" title="django.contrib.messages: Provides cookie- and session-based temporary message storage."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.messages</span></code></a><a class="headerlink" href="#django-contrib-messages" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/contrib/messages.html#django.contrib.messages.test.MessagesTestMixin.assertMessages" title="django.contrib.messages.test.MessagesTestMixin.assertMessages"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MessagesTestMixin.assertMessages()</span></code></a> 断言方法允许测试添加到 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse" title="django.http.HttpResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">response</span></code></a> 的 <a class="reference internal" href="../ref/contrib/messages.html#module-django.contrib.messages" title="django.contrib.messages: Provides cookie- and session-based temporary message storage."><code class="xref py py-mod docutils literal notranslate"><span class="pre">messages</span></code></a>。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-postgres">
<span id="django-contrib-postgres"></span><h4><a class="reference internal" href="../ref/contrib/postgres/index.html#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a><a class="headerlink" href="#django-contrib-postgres" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/contrib/postgres/constraints.html#django.contrib.postgres.constraints.ExclusionConstraint" title="django.contrib.postgres.constraints.ExclusionConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExclusionConstraint</span></code></a> 的新属性 <a class="reference internal" href="../ref/contrib/postgres/constraints.html#django.contrib.postgres.constraints.ExclusionConstraint.violation_error_code" title="django.contrib.postgres.constraints.ExclusionConstraint.violation_error_code"><code class="xref py py-attr docutils literal notranslate"><span class="pre">violation_error_code</span></code></a> 允许在 <a class="reference internal" href="../ref/models/instances.html#validating-objects"><span class="std std-ref">模型验证</span></a> 期间自定义 <code class="docutils literal notranslate"><span class="pre">ValidationError</span></code> 引发的 <code class="docutils literal notranslate"><span class="pre">code</span></code>。</li>
</ul>
</div>
<div class="section" id="s-asynchronous-views">
<span id="asynchronous-views"></span><h4>异步视图<a class="headerlink" href="#asynchronous-views" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 ASGI 下，现在可以处理 <code class="docutils literal notranslate"><span class="pre">http.disconnect</span></code> 事件。这允许视图在客户端在生成响应之前断开连接时执行任何必要的清理工作。有关更多详细信息，请参阅 <a class="reference internal" href="../topics/async.html#async-handling-disconnect"><span class="std std-ref">处理断开连接</span></a>。</li>
</ul>
</div>
<div class="section" id="s-decorators">
<span id="decorators"></span><h4>装饰器<a class="headerlink" href="#decorators" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>以下装饰器现在支持包装异步视图函数：<ul>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.cache.cache_control" title="django.views.decorators.cache.cache_control"><code class="xref py py-func docutils literal notranslate"><span class="pre">cache_control()</span></code></a></li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.cache.never_cache" title="django.views.decorators.cache.never_cache"><code class="xref py py-func docutils literal notranslate"><span class="pre">never_cache()</span></code></a></li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.common.no_append_slash" title="django.views.decorators.common.no_append_slash"><code class="xref py py-func docutils literal notranslate"><span class="pre">no_append_slash()</span></code></a></li>
<li><a class="reference internal" href="../ref/csrf.html#django.views.decorators.csrf.csrf_exempt" title="django.views.decorators.csrf.csrf_exempt"><code class="xref py py-func docutils literal notranslate"><span class="pre">csrf_exempt()</span></code></a></li>
<li><a class="reference internal" href="../ref/csrf.html#django.views.decorators.csrf.csrf_protect" title="django.views.decorators.csrf.csrf_protect"><code class="xref py py-func docutils literal notranslate"><span class="pre">csrf_protect()</span></code></a></li>
<li><a class="reference internal" href="../ref/csrf.html#django.views.decorators.csrf.ensure_csrf_cookie" title="django.views.decorators.csrf.ensure_csrf_cookie"><code class="xref py py-func docutils literal notranslate"><span class="pre">ensure_csrf_cookie()</span></code></a></li>
<li><a class="reference internal" href="../ref/csrf.html#django.views.decorators.csrf.requires_csrf_token" title="django.views.decorators.csrf.requires_csrf_token"><code class="xref py py-func docutils literal notranslate"><span class="pre">requires_csrf_token()</span></code></a></li>
<li><a class="reference internal" href="../howto/error-reporting.html#django.views.decorators.debug.sensitive_variables" title="django.views.decorators.debug.sensitive_variables"><code class="xref py py-func docutils literal notranslate"><span class="pre">sensitive_variables()</span></code></a></li>
<li><a class="reference internal" href="../howto/error-reporting.html#django.views.decorators.debug.sensitive_post_parameters" title="django.views.decorators.debug.sensitive_post_parameters"><code class="xref py py-func docutils literal notranslate"><span class="pre">sensitive_post_parameters()</span></code></a></li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.gzip.gzip_page" title="django.views.decorators.gzip.gzip_page"><code class="xref py py-func docutils literal notranslate"><span class="pre">gzip_page()</span></code></a></li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.http.condition" title="django.views.decorators.http.condition"><code class="xref py py-func docutils literal notranslate"><span class="pre">condition()</span></code></a></li>
<li><code class="docutils literal notranslate"><span class="pre">conditional_page()</span></code></li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.http.etag" title="django.views.decorators.http.etag"><code class="xref py py-func docutils literal notranslate"><span class="pre">etag()</span></code></a></li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.http.last_modified" title="django.views.decorators.http.last_modified"><code class="xref py py-func docutils literal notranslate"><span class="pre">last_modified()</span></code></a></li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.http.require_http_methods" title="django.views.decorators.http.require_http_methods"><code class="xref py py-func docutils literal notranslate"><span class="pre">require_http_methods()</span></code></a></li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.http.require_GET" title="django.views.decorators.http.require_GET"><code class="xref py py-func docutils literal notranslate"><span class="pre">require_GET()</span></code></a></li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.http.require_POST" title="django.views.decorators.http.require_POST"><code class="xref py py-func docutils literal notranslate"><span class="pre">require_POST()</span></code></a></li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.http.require_safe" title="django.views.decorators.http.require_safe"><code class="xref py py-func docutils literal notranslate"><span class="pre">require_safe()</span></code></a></li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.vary.vary_on_cookie" title="django.views.decorators.vary.vary_on_cookie"><code class="xref py py-func docutils literal notranslate"><span class="pre">vary_on_cookie()</span></code></a></li>
<li><a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.vary.vary_on_headers" title="django.views.decorators.vary.vary_on_headers"><code class="xref py py-func docutils literal notranslate"><span class="pre">vary_on_headers()</span></code></a></li>
<li><code class="docutils literal notranslate"><span class="pre">xframe_options_deny()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">xframe_options_sameorigin()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">xframe_options_exempt()</span></code></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="s-error-reporting">
<span id="error-reporting"></span><h4>错误报告<a class="headerlink" href="#error-reporting" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../howto/error-reporting.html#django.views.decorators.debug.sensitive_variables" title="django.views.decorators.debug.sensitive_variables"><code class="xref py py-func docutils literal notranslate"><span class="pre">sensitive_variables()</span></code></a> 和 <a class="reference internal" href="../howto/error-reporting.html#django.views.decorators.debug.sensitive_post_parameters" title="django.views.decorators.debug.sensitive_post_parameters"><code class="xref py py-func docutils literal notranslate"><span class="pre">sensitive_post_parameters()</span></code></a> 现在可以与异步函数一起使用。</li>
</ul>
</div>
<div class="section" id="s-file-storage">
<span id="file-storage"></span><h4>文件存储<a class="headerlink" href="#file-storage" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/files/file.html#django.core.files.File.open" title="django.core.files.File.open"><code class="xref py py-meth docutils literal notranslate"><span class="pre">File.open()</span></code></a> 现在将所有位置参数（<code class="docutils literal notranslate"><span class="pre">*args</span></code>）和关键字参数（<code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>）传递给 Python 内置的 <a class="reference external" href="https://docs.python.org/3/library/functions.html#open" title="(在 Python v3.12)"><code class="docutils literal notranslate"><span class="pre">open()</span></code></a>。</li>
</ul>
</div>
<div class="section" id="s-forms">
<span id="forms"></span><h4>表单<a class="headerlink" href="#forms" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/forms/fields.html#django.forms.URLField.assume_scheme" title="django.forms.URLField.assume_scheme"><code class="xref py py-attr docutils literal notranslate"><span class="pre">assume_scheme</span></code></a> 参数用于 <a class="reference internal" href="../ref/forms/fields.html#django.forms.URLField" title="django.forms.URLField"><code class="xref py py-class docutils literal notranslate"><span class="pre">URLField</span></code></a>，允许指定默认的 URL 方案。</li>
<li>为了提高可访问性，进行了以下更改：<ul>
<li>现在表单字段包括 <code class="docutils literal notranslate"><span class="pre">aria-describedby</span></code> HTML 属性，以使屏幕阅读器能够将表单字段与其帮助文本关联起来。</li>
<li>无效的表单字段现在包括 <code class="docutils literal notranslate"><span class="pre">aria-invalid=&quot;true&quot;</span></code> HTML 属性。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="s-internationalization">
<span id="internationalization"></span><h4>国际化<a class="headerlink" href="#internationalization" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>现在支持维吾尔语，并提供翻译。</li>
</ul>
</div>
<div class="section" id="s-migrations">
<span id="migrations"></span><h4>迁移<a class="headerlink" href="#migrations" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>现在支持对使用 <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.cache" title="(在 Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.cache()</span></code></a> 或 <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.lru_cache" title="(在 Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.lru_cache()</span></code></a> 装饰的函数进行序列化，无需编写自定义序列化器。</li>
</ul>
</div>
<div class="section" id="s-models">
<span id="models"></span><h4>模型<a class="headerlink" href="#models" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.update_or_create" title="django.db.models.query.QuerySet.update_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.update_or_create()</span></code></a> 和 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.aupdate_or_create" title="django.db.models.query.QuerySet.aupdate_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.aupdate_or_create()</span></code></a> 方法的新 <code class="docutils literal notranslate"><span class="pre">create_defaults</span></code> 参数允许为创建操作指定不同的字段值。</li>
<li><a class="reference internal" href="../ref/models/constraints.html#django.db.models.BaseConstraint" title="django.db.models.BaseConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseConstraint</span></code></a>、<a class="reference internal" href="../ref/models/constraints.html#django.db.models.CheckConstraint" title="django.db.models.CheckConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">CheckConstraint</span></code></a> 和 <a class="reference internal" href="../ref/models/constraints.html#django.db.models.UniqueConstraint" title="django.db.models.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint</span></code></a> 的新 <code class="docutils literal notranslate"><span class="pre">violation_error_code</span></code> 属性允许自定义在 <a class="reference internal" href="../ref/models/instances.html#validating-objects"><span class="std std-ref">模型验证</span></a> 过程中引发的 <code class="docutils literal notranslate"><span class="pre">ValidationError</span></code> 的 <code class="docutils literal notranslate"><span class="pre">code</span></code>。</li>
<li><a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.save()</span></code></a> 的 <a class="reference internal" href="../ref/models/instances.html#ref-models-force-insert"><span class="std std-ref">force_insert</span></a> 参数现在允许指定必须强制插入的父类的元组。</li>
<li>当启用 <code class="docutils literal notranslate"><span class="pre">update_conflicts</span></code> 参数时，<a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.bulk_create" title="django.db.models.query.QuerySet.bulk_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.bulk_create()</span></code></a> 和 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.abulk_create" title="django.db.models.query.QuerySet.abulk_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.abulk_create()</span></code></a> 方法现在会为每个模型实例设置主键（如果数据库支持的话）。</li>
<li>新的 <a class="reference internal" href="../ref/models/constraints.html#django.db.models.UniqueConstraint.nulls_distinct" title="django.db.models.UniqueConstraint.nulls_distinct"><code class="xref py py-attr docutils literal notranslate"><span class="pre">UniqueConstraint.nulls_distinct</span></code></a> 属性允许自定义在 PostgreSQL 15+ 上对 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 值的处理方式。</li>
<li>新的 <a class="reference internal" href="../topics/http/shortcuts.html#django.shortcuts.aget_object_or_404" title="django.shortcuts.aget_object_or_404"><code class="xref py py-func docutils literal notranslate"><span class="pre">aget_object_or_404()</span></code></a> 和 <a class="reference internal" href="../topics/http/shortcuts.html#django.shortcuts.aget_list_or_404" title="django.shortcuts.aget_list_or_404"><code class="xref py py-func docutils literal notranslate"><span class="pre">aget_list_or_404()</span></code></a> 异步快捷方式允许异步获取对象。</li>
<li>新的 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.aprefetch_related_objects" title="django.db.models.aprefetch_related_objects"><code class="xref py py-func docutils literal notranslate"><span class="pre">aprefetch_related_objects()</span></code></a> 函数允许异步预取模型实例。</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.aiterator" title="django.db.models.query.QuerySet.aiterator"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.aiterator()</span></code></a> 现在支持之前对 <code class="docutils literal notranslate"><span class="pre">prefetch_related()</span></code> 的调用。</li>
<li>在 MariaDB 10.7+ 上，<code class="docutils literal notranslate"><span class="pre">UUIDField</span></code> 现在将创建为 <code class="docutils literal notranslate"><span class="pre">UUID</span></code> 列，而不是 <code class="docutils literal notranslate"><span class="pre">CHAR(32)</span></code> 列。有关 <a class="reference internal" href="#migrating-uuidfield"><span class="std std-ref">迁移现有的在 MariaDB 10.7+ 上的 UUIDField</span></a> 的更多详细信息，请参阅迁移指南。</li>
<li>Django 现在支持 <a class="reference external" href="https://oracle.github.io/python-oracledb/">oracledb</a> 版本 1.3.2 或更高版本。从此版本开始，对 <code class="docutils literal notranslate"><span class="pre">cx_Oracle</span></code> 的支持已被弃用，并将在 Django 6.0 中移除。</li>
</ul>
</div>
<div class="section" id="s-pagination">
<span id="pagination"></span><h4>分页<a class="headerlink" href="#pagination" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/paginator.html#django.core.paginator.Paginator.error_messages" title="django.core.paginator.Paginator.error_messages"><code class="xref py py-attr docutils literal notranslate"><span class="pre">django.core.paginator.Paginator.error_messages</span></code></a> 参数允许自定义由 <a class="reference internal" href="../ref/paginator.html#django.core.paginator.Paginator.page" title="django.core.paginator.Paginator.page"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Paginator.page()</span></code></a> 引发的错误消息。</li>
</ul>
</div>
<div class="section" id="s-signals">
<span id="signals"></span><h4>信号<a class="headerlink" href="#signals" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../topics/signals.html#django.dispatch.Signal.asend" title="django.dispatch.Signal.asend"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Signal.asend()</span></code></a> 和 <a class="reference internal" href="../topics/signals.html#django.dispatch.Signal.asend_robust" title="django.dispatch.Signal.asend_robust"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Signal.asend_robust()</span></code></a> 方法允许异步信号分发。信号接收器可以是同步或异步的，将自动适应正确的调用方式。</li>
</ul>
</div>
<div class="section" id="s-templates">
<span id="templates"></span><h4>模板<a class="headerlink" href="#templates" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-escapeseq"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">escapeseq</span></code></a> 模板过滤器将 <a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-escape"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">escape</span></code></a> 应用于序列的每个元素。</li>
</ul>
</div>
<div class="section" id="s-tests">
<span id="tests"></span><h4>测试<a class="headerlink" href="#tests" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../topics/testing/tools.html#django.test.Client" title="django.test.Client"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client</span></code></a> 和 <a class="reference internal" href="../topics/testing/tools.html#django.test.AsyncClient" title="django.test.AsyncClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncClient</span></code></a> 现在提供异步方法，使用 <code class="docutils literal notranslate"><span class="pre">a</span></code> 前缀：<a class="reference internal" href="../topics/testing/tools.html#django.test.Client.asession" title="django.test.Client.asession"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asession()</span></code></a>、<a class="reference internal" href="../topics/testing/tools.html#django.test.Client.alogin" title="django.test.Client.alogin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">alogin()</span></code></a>、<a class="reference internal" href="../topics/testing/tools.html#django.test.Client.aforce_login" title="django.test.Client.aforce_login"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aforce_login()</span></code></a> 和 <a class="reference internal" href="../topics/testing/tools.html#django.test.Client.alogout" title="django.test.Client.alogout"><code class="xref py py-meth docutils literal notranslate"><span class="pre">alogout()</span></code></a>。</li>
<li><a class="reference internal" href="../topics/testing/tools.html#django.test.AsyncClient" title="django.test.AsyncClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncClient</span></code></a> 现在支持 <code class="docutils literal notranslate"><span class="pre">follow</span></code> 参数。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-test-durations"><code class="xref std std-option docutils literal notranslate"><span class="pre">test</span> <span class="pre">--durations</span></code></a> 选项允许在 Python 3.12+ 上显示最慢测试的持续时间。</li>
</ul>
</div>
<div class="section" id="s-validators">
<span id="validators"></span><h4>验证器<a class="headerlink" href="#validators" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/validators.html#django.core.validators.StepValueValidator" title="django.core.validators.StepValueValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">StepValueValidator</span></code></a> 的新 <code class="docutils literal notranslate"><span class="pre">offset</span></code> 参数允许为有效值指定偏移量。</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-backwards-incompatible-changes-in-5-0">
<span id="s-backwards-incompatible-5-0"></span><span id="backwards-incompatible-changes-in-5-0"></span><span id="backwards-incompatible-5-0"></span><h2>5.0 版本中不向后兼容的变更<a class="headerlink" href="#backwards-incompatible-changes-in-5-0" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-database-backend-api">
<span id="database-backend-api"></span><h3>数据库后端 API<a class="headerlink" href="#database-backend-api" title="永久链接至标题">¶</a></h3>
<p>本节介绍了第三方数据库后端可能需要的更改。</p>
<ul class="simple">
<li>如果数据库不支持将数据库函数用作默认值，则应将 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.supports_expression_defaults</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</li>
<li>如果数据库不支持在 <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> 查询中使用 <code class="docutils literal notranslate"><span class="pre">DEFAULT</span></code> 关键字，应将 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.supports_default_keyword_in_insert</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</li>
<li>如果数据库不支持在批量 <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> 查询中使用 <code class="docutils literal notranslate"><span class="pre">DEFAULT</span></code> 关键字，应将 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.supports_default_keyword_in_bulk_insert</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</li>
</ul>
</div>
<div class="section" id="s-id1">
<span id="id1"></span><h3><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>移除对 GDAL 2.2 和 2.3 的支持。</li>
<li>移除对 GEOS 3.6 和 3.7 的支持。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sitemaps">
<span id="django-contrib-sitemaps"></span><h3><a class="reference internal" href="../ref/contrib/sitemaps.html#module-django.contrib.sitemaps" title="django.contrib.sitemaps: A framework for generating Google sitemap XML files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sitemaps</span></code></a><a class="headerlink" href="#django-contrib-sitemaps" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>移除了 <code class="docutils literal notranslate"><span class="pre">django.contrib.sitemaps.ping_google()</span></code> 函数和 <code class="docutils literal notranslate"><span class="pre">ping_google</span></code> 管理命令，因为 Google Sitemaps 的 ping 端点已被弃用，并将于 2024 年 1 月被移除。</li>
<li>移除了 <code class="docutils literal notranslate"><span class="pre">django.contrib.sitemaps.SitemapNotFound</span></code> 异常类。</li>
</ul>
</div>
<div class="section" id="s-dropped-support-for-mysql-8-0-11">
<span id="dropped-support-for-mysql-8-0-11"></span><h3>不再支持 MySQL 版本低于 8.0.11。<a class="headerlink" href="#dropped-support-for-mysql-8-0-11" title="永久链接至标题">¶</a></h3>
<p>不再支持 MySQL 8.0.x 系列的预发布版本。Django 5.0 支持 MySQL 8.0.11 及更高版本。</p>
</div>
<div class="section" id="s-using-create-defaults-exact-may-now-be-required-with-queryset-update-or-create">
<span id="using-create-defaults-exact-may-now-be-required-with-queryset-update-or-create"></span><h3>在使用 <code class="docutils literal notranslate"><span class="pre">QuerySet.update_or_create()</span></code> 时，可能现在需要使用 <code class="docutils literal notranslate"><span class="pre">create_defaults__exact</span></code>。<a class="headerlink" href="#using-create-defaults-exact-may-now-be-required-with-queryset-update-or-create" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.update_or_create" title="django.db.models.query.QuerySet.update_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.update_or_create()</span></code></a> 现在支持参数 <code class="docutils literal notranslate"><span class="pre">create_defaults</span></code>。因此，任何在 <code class="docutils literal notranslate"><span class="pre">update_or_create()</span></code> 中使用具有名为 <code class="docutils literal notranslate"><span class="pre">create_defaults</span></code> 的字段的模型应该在查找中使用 <code class="docutils literal notranslate"><span class="pre">create_defaults__exact</span></code> 指定该字段。</p>
</div>
<div class="section" id="s-migrating-existing-uuidfield-on-mariadb-10-7">
<span id="s-migrating-uuidfield"></span><span id="migrating-existing-uuidfield-on-mariadb-10-7"></span><span id="migrating-uuidfield"></span><h3>迁移现有的在 MariaDB 10.7+ 上的 <code class="docutils literal notranslate"><span class="pre">UUIDField</span></code><a class="headerlink" href="#migrating-existing-uuidfield-on-mariadb-10-7" title="永久链接至标题">¶</a></h3>
<p>在 MariaDB 10.7+ 中，现在将 <code class="docutils literal notranslate"><span class="pre">UUIDField</span></code> 创建为 <code class="docutils literal notranslate"><span class="pre">UUID</span></code> 列，而不再是 <code class="docutils literal notranslate"><span class="pre">CHAR(32)</span></code> 列。因此，在 Django 版本小于 5.0 中创建的任何 <code class="docutils literal notranslate"><span class="pre">UUIDField</span></code> 都应该替换为由 <code class="docutils literal notranslate"><span class="pre">CHAR(32)</span></code> 支持的 <code class="docutils literal notranslate"><span class="pre">UUIDField</span></code> 子类:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Char32UUIDField</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">UUIDField</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">db_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;char(32)&quot;</span>

    <span class="k">def</span> <span class="nf">get_db_prep_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">prepared</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_db_prep_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">prepared</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">hex</span>
        <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
<p>例子：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UUIDField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">)</span>
</pre></div>
</div>
<p>应该变成：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Char32UUIDField</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">UUIDField</span><span class="p">):</span> <span class="o">...</span>


<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">uuid</span> <span class="o">=</span> <span class="n">Char32UUIDField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">)</span>
</pre></div>
</div>
<p>运行 <a class="reference internal" href="../ref/django-admin.html#django-admin-makemigrations"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemigrations</span></code></a> 命令将生成一个包含无操作的 <code class="docutils literal notranslate"><span class="pre">AlterField</span></code> 操作的迁移。</p>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h3>杂项<a class="headerlink" href="#miscellaneous" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>未记录的 <code class="docutils literal notranslate"><span class="pre">BaseModelFormSet.save_existing()</span></code> 方法的 <code class="docutils literal notranslate"><span class="pre">instance</span></code> 参数已重命名为 <code class="docutils literal notranslate"><span class="pre">obj</span></code>。</li>
<li>未记录的 <code class="docutils literal notranslate"><span class="pre">django.contrib.admin.helpers.checkbox</span></code> 已被移除。</li>
<li>在 SQLite 上，整数字段现在会被验证为 64 位整数，以匹配 <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> 的行为。</li>
<li>未记录的 <code class="docutils literal notranslate"><span class="pre">Query.annotation_select_mask</span></code> 属性已从字符串集更改为有序的字符串列表。</li>
<li>如果未设置 <code class="docutils literal notranslate"><span class="pre">width_field</span></code> 和 <code class="docutils literal notranslate"><span class="pre">height_field</span></code>，则不再在 <code class="docutils literal notranslate"><span class="pre">post_init</span></code> 信号上调用 <code class="docutils literal notranslate"><span class="pre">ImageField.update_dimension_fields()</span></code>。</li>
<li>在 Oracle 上，<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Now" title="django.db.models.functions.Now"><code class="xref py py-class docutils literal notranslate"><span class="pre">Now</span></code></a> 数据库函数现在使用 <code class="docutils literal notranslate"><span class="pre">LOCALTIMESTAMP</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">CURRENT_TIMESTAMP</span></code>。</li>
<li><a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.AdminSite.site_header" title="django.contrib.admin.AdminSite.site_header"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AdminSite.site_header</span></code></a> 现在呈现在一个 <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code> 标签中，而不是 <code class="docutils literal notranslate"><span class="pre">&lt;h1&gt;</span></code>。屏幕阅读器用户依赖标题元素在页面内导航。拥有两个 <code class="docutils literal notranslate"><span class="pre">&lt;h1&gt;</span></code> 元素会引起混淆，而且站点标题在所有页面上都重复出现，没有帮助。</li>
<li>为了提高可访问性，管理员的主要内容区域和页眉内容区域现在呈现在 <code class="docutils literal notranslate"><span class="pre">&lt;main&gt;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&lt;header&gt;</span></code> 标签中，而不是 <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>。</li>
<li>在没有原生支持 SQL <code class="docutils literal notranslate"><span class="pre">XOR</span></code> 运算符的数据库上，作为异或（<code class="docutils literal notranslate"><span class="pre">XOR</span></code>）运算符的 <code class="docutils literal notranslate"><span class="pre">^</span></code> 现在会返回被奇数个操作数匹配的行，而不是严格匹配一个操作数。这与 MySQL、MariaDB 和 Python 的行为一致。</li>
<li><code class="docutils literal notranslate"><span class="pre">asgiref</span></code> 的最低支持版本已从 3.6.0 增加到 3.7.0。</li>
<li><code class="docutils literal notranslate"><span class="pre">selenium</span></code> 的最低支持版本已从 3.8.0 增加到 4.8.0。</li>
<li><code class="docutils literal notranslate"><span class="pre">AlreadyRegistered</span></code> 和 <code class="docutils literal notranslate"><span class="pre">NotRegistered</span></code> 异常已从 <code class="docutils literal notranslate"><span class="pre">django.contrib.admin.sites</span></code> 移动到 <code class="docutils literal notranslate"><span class="pre">django.contrib.admin.exceptions</span></code>。</li>
<li>SQLite 的最低支持版本已从 3.21.0 增加到 3.27.0。</li>
<li>不再支持 <code class="docutils literal notranslate"><span class="pre">cx_Oracle</span></code> 版本小于 8.3。</li>
<li>在应用程序注册表完全填充之前执行 SQL 查询现在会引发 <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeWarning" title="(在 Python v3.12)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeWarning</span></code></a>。</li>
<li>对于非 UTF-8 编码的请求和 <em class="mimetype">application/x-www-form-urlencoded</em> 内容类型，将引发 <a class="reference internal" href="../ref/exceptions.html#django.core.exceptions.BadRequest" title="django.core.exceptions.BadRequest"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BadRequest</span></code></a> 异常。有关详细信息，请参阅 <span class="target" id="index-2"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc1866.html"><strong>RFC 1866</strong></a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">colorama</span></code> 的最低支持版本已增加到 0.4.6。</li>
<li><code class="docutils literal notranslate"><span class="pre">docutils</span></code> 的最低支持版本已增加到 0.19。</li>
<li>Filtering querysets against overflowing integer values now always returns an
empty queryset. As a consequence, you may need to use <code class="docutils literal notranslate"><span class="pre">ExpressionWrapper()</span></code>
to <a class="reference internal" href="../ref/models/expressions.html#using-f-with-annotations"><span class="std std-ref">explicitly wrap</span></a> arithmetic against
integer fields in such cases.</li>
</ul>
</div>
</div>
<div class="section" id="s-features-deprecated-in-5-0">
<span id="s-deprecated-features-5-0"></span><span id="features-deprecated-in-5-0"></span><span id="deprecated-features-5-0"></span><h2>在 5.0 版本中废弃的功能<a class="headerlink" href="#features-deprecated-in-5-0" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-id2">
<span id="id2"></span><h3>杂项<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">DjangoDivFormRenderer</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Jinja2DivFormRenderer</span></code> 过渡的表单渲染器已被弃用。</li>
<li>将位置参数 <code class="docutils literal notranslate"><span class="pre">name</span></code> 和 <code class="docutils literal notranslate"><span class="pre">violation_error_message</span></code> 传递给 <a class="reference internal" href="../ref/models/constraints.html#django.db.models.BaseConstraint" title="django.db.models.BaseConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseConstraint</span></code></a> 已被弃用，建议使用关键字参数方式。</li>
<li><code class="docutils literal notranslate"><span class="pre">request</span></code> 已添加到 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.lookup_allowed" title="django.contrib.admin.ModelAdmin.lookup_allowed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.lookup_allowed()</span></code></a> 的签名中。不接受此参数的 <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> 子类的支持已被弃用。</li>
<li><code class="docutils literal notranslate"><span class="pre">ForeignObject</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ForeignObjectRel</span></code> 的 <code class="docutils literal notranslate"><span class="pre">get_joining_columns()</span></code> 方法已被弃用。从 Django 6.0 开始，<code class="docutils literal notranslate"><span class="pre">django.db.models.sql.datastructures.Join</span></code> 将不再回退到 <code class="docutils literal notranslate"><span class="pre">get_joining_columns()</span></code>。子类应该改为实现 <code class="docutils literal notranslate"><span class="pre">get_joining_fields()</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">ForeignObject.get_reverse_joining_columns()</span></code> 方法已被弃用。</li>
<li>在 Django 6.0 中，<code class="docutils literal notranslate"><span class="pre">forms.URLField</span></code> 的默认方案将从 <code class="docutils literal notranslate"><span class="pre">&quot;http&quot;</span></code> 更改为 <code class="docutils literal notranslate"><span class="pre">&quot;https&quot;</span></code>。在 Django 5.x 发布周期中，将 <a class="reference internal" href="../ref/settings.html#std-setting-FORMS_URLFIELD_ASSUME_HTTPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">FORMS_URLFIELD_ASSUME_HTTPS</span></code></a> 过渡设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code> 以选择假定 <code class="docutils literal notranslate"><span class="pre">&quot;https&quot;</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">FORMS_URLFIELD_ASSUME_HTTPS</span></code> 过渡设置已被弃用。</li>
<li>不再支持在不传递 args 或 kwargs 的情况下调用 <code class="docutils literal notranslate"><span class="pre">format_html()</span></code>。</li>
<li>对 <code class="docutils literal notranslate"><span class="pre">cx_Oracle</span></code> 的支持已被弃用，建议使用 <a class="reference external" href="https://oracle.github.io/python-oracledb/">oracledb</a> 1.3.2+ Python 驱动程序。</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseOperations.field_cast_sql()</span></code> 已被弃用，建议使用 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.lookup_cast()</span></code>。从 Django 6.0 开始，<code class="docutils literal notranslate"><span class="pre">BuiltinLookup.process_lhs()</span></code> 将不再调用 <code class="docutils literal notranslate"><span class="pre">field_cast_sql()</span></code>。第三方数据库后端应该改为实现 <code class="docutils literal notranslate"><span class="pre">lookup_cast()</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.enums.ChoicesMeta</span></code> 元类已更名为 <code class="docutils literal notranslate"><span class="pre">ChoicesType</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">Prefetch.get_current_queryset()</span></code> 方法已被弃用。</li>
<li>相关管理器和描述符的 <code class="docutils literal notranslate"><span class="pre">get_prefetch_queryset()</span></code> 方法已被弃用。从 Django 6.0 开始，<code class="docutils literal notranslate"><span class="pre">get_prefetcher()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">prefetch_related_objects()</span></code> 将不再回退到 <code class="docutils literal notranslate"><span class="pre">get_prefetch_queryset()</span></code>。子类应该改为实现 <code class="docutils literal notranslate"><span class="pre">get_prefetch_querysets()</span></code>。</li>
</ul>
</div>
</div>
<div class="section" id="s-features-removed-in-5-0">
<span id="features-removed-in-5-0"></span><h2>在 5.0 版本中移除的功能<a class="headerlink" href="#features-removed-in-5-0" title="永久链接至标题">¶</a></h2>
<p>这些功能已经完成了它们的弃用周期，并在 Django 5.0 中被移除。</p>
<p>有关这些更改的详细信息，包括如何删除对这些功能的使用，请参阅 <a class="reference internal" href="4.0.html#deprecated-features-4-0"><span class="std std-ref">在 4.0 版本中废弃的功能</span></a>。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SERIALIZE</span></code> 测试设置已被移除。</li>
<li>未记录的 <code class="docutils literal notranslate"><span class="pre">django.utils.baseconv</span></code> 模块已被移除。</li>
<li>未记录的 <code class="docutils literal notranslate"><span class="pre">django.utils.datetime_safe</span></code> 模块已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">USE_TZ</span></code> 设置的默认值已从 <code class="docutils literal notranslate"><span class="pre">False</span></code> 更改为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</li>
<li>在不在请求上下文之外构建的站点地图的默认协议已从 <code class="docutils literal notranslate"><span class="pre">'http'</span></code> 更改为 <code class="docutils literal notranslate"><span class="pre">'https'</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">DiscoverRunner.build_suite()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">DiscoverRunner.run_tests()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">extra_tests</span></code> 参数已被移除。</li>
<li>当没有行时，<code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.aggregates.ArrayAgg</span></code>、<code class="docutils literal notranslate"><span class="pre">JSONBAgg</span></code> 和 <code class="docutils literal notranslate"><span class="pre">StringAgg</span></code> 聚合现在不再返回 <code class="docutils literal notranslate"><span class="pre">[]</span></code>、<code class="docutils literal notranslate"><span class="pre">[]</span></code> 和 <code class="docutils literal notranslate"><span class="pre">''</span></code>，而是返回 <code class="docutils literal notranslate"><span class="pre">None</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">USE_L10N</span></code> 设置已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">USE_DEPRECATED_PYTZ</span></code> 过渡设置已被移除。</li>
<li>对于 <code class="docutils literal notranslate"><span class="pre">pytz</span></code> 时区的支持已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">is_dst</span></code> 参数已从以下地方移除：<ul>
<li><code class="docutils literal notranslate"><span class="pre">QuerySet.datetimes()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.timezone.make_aware()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.functions.Trunc()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.functions.TruncSecond()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.functions.TruncMinute()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.functions.TruncHour()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.functions.TruncDay()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.functions.TruncWeek()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.functions.TruncMonth()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.functions.TruncQuarter()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.models.functions.TruncYear()</span></code></li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.admin.GeoModelAdmin</span></code> 和 <code class="docutils literal notranslate"><span class="pre">OSMGeoAdmin</span></code> 类已被移除。</li>
<li>未记录的 <code class="docutils literal notranslate"><span class="pre">BaseForm._html_output()</span></code> 方法已被移除。</li>
<li>在渲染 <code class="docutils literal notranslate"><span class="pre">ErrorDict</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ErrorList</span></code> 时返回 <code class="docutils literal notranslate"><span class="pre">str</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">SafeString</span></code> 的能力已被移除。</li>
</ul>
<p>有关这些更改的详细信息，包括如何删除对这些功能的使用，请参阅 <a class="reference internal" href="4.1.html#deprecated-features-4-1"><span class="std std-ref">4.1 版本中弃用的功能</span></a>。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SitemapIndexItem.__str__()</span></code> 方法已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">CSRF_COOKIE_MASKED</span></code> 过渡设置已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.functional.cached_property()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">name</span></code> 参数已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.constraints.ExclusionConstraint</span></code> 的 <code class="docutils literal notranslate"><span class="pre">opclasses</span></code> 参数已被移除。</li>
<li>已移除将 <code class="docutils literal notranslate"><span class="pre">errors=None</span></code> 传递给 <code class="docutils literal notranslate"><span class="pre">SimpleTestCase.assertFormError()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">assertFormsetError()</span></code> 的未记录能力。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.sessions.serializers.PickleSerializer</span></code> 已被移除。</li>
<li>不再允许在预取相关对象但没有提供 <code class="docutils literal notranslate"><span class="pre">chunk_size</span></code> 参数的查询集上使用 <code class="docutils literal notranslate"><span class="pre">QuerySet.iterator()</span></code>。</li>
<li>不再允许将未保存的模型实例传递给相关的过滤器。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">RemoteUserBackend.configure_user()</span></code> 子类的签名中需要包含 <code class="docutils literal notranslate"><span class="pre">created=True</span></code>。</li>
<li>已移除通过 <code class="docutils literal notranslate"><span class="pre">GET</span></code> 请求在 <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.views.LogoutView</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.views.logout_then_login()</span></code> 中进行登出的支持。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.timezone.utc</span></code> 到 <code class="docutils literal notranslate"><span class="pre">datetime.timezone.utc</span></code> 的别名已被移除。</li>
<li>不再允许将响应对象和表单/表单集名称传递给 <code class="docutils literal notranslate"><span class="pre">SimpleTestCase.assertFormError()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">assertFormSetError()</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.admin.OpenLayersWidget</span></code> 已被移除。</li>
</ul>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.hashers.CryptPasswordHasher</span></code> 已被移除。</li>
</ul>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&quot;django/forms/default.html&quot;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&quot;django/forms/formsets/default.html&quot;</span></code> 模板已被移除。</li>
<li>默认的表单和表单集呈现样式已更改为基于 div 的样式。</li>
<li>不再允许向 <code class="docutils literal notranslate"><span class="pre">Expression.asc()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Expression.desc()</span></code> 方法以及 <code class="docutils literal notranslate"><span class="pre">OrderBy</span></code> 表达式传递 <code class="docutils literal notranslate"><span class="pre">nulls_first=False</span></code> 或 <code class="docutils literal notranslate"><span class="pre">nulls_last=False</span></code>。</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Django 5.0 版本发行说明</a><ul>
<li><a class="reference internal" href="#python-compatibility">Python 兼容性</a></li>
<li><a class="reference internal" href="#third-party-library-support-for-older-version-of-django">对于较旧版本的 Django 的第三方库支持</a></li>
<li><a class="reference internal" href="#what-s-new-in-django-5-0">Django 5.0 新特性</a><ul>
<li><a class="reference internal" href="#facet-filters-in-the-admin">管理界面中的分面过滤器</a></li>
<li><a class="reference internal" href="#simplified-templates-for-form-field-rendering">简化的表单字段渲染模板</a></li>
<li><a class="reference internal" href="#database-computed-default-values">数据库计算的默认值</a></li>
<li><a class="reference internal" href="#database-generated-model-field">数据库生成的模型字段</a></li>
<li><a class="reference internal" href="#more-options-for-declaring-field-choices">声明字段选择项的更多选项</a></li>
<li><a class="reference internal" href="#minor-features">次要特性</a><ul>
<li><a class="reference internal" href="#django-contrib-admin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-auth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-contenttypes"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.contenttypes</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-gis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-messages"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.messages</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-postgres"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a></li>
<li><a class="reference internal" href="#asynchronous-views">异步视图</a></li>
<li><a class="reference internal" href="#decorators">装饰器</a></li>
<li><a class="reference internal" href="#error-reporting">错误报告</a></li>
<li><a class="reference internal" href="#file-storage">文件存储</a></li>
<li><a class="reference internal" href="#forms">表单</a></li>
<li><a class="reference internal" href="#internationalization">国际化</a></li>
<li><a class="reference internal" href="#migrations">迁移</a></li>
<li><a class="reference internal" href="#models">模型</a></li>
<li><a class="reference internal" href="#pagination">分页</a></li>
<li><a class="reference internal" href="#signals">信号</a></li>
<li><a class="reference internal" href="#templates">模板</a></li>
<li><a class="reference internal" href="#tests">测试</a></li>
<li><a class="reference internal" href="#validators">验证器</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-incompatible-changes-in-5-0">5.0 版本中不向后兼容的变更</a><ul>
<li><a class="reference internal" href="#database-backend-api">数据库后端 API</a></li>
<li><a class="reference internal" href="#id1"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sitemaps"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sitemaps</span></code></a></li>
<li><a class="reference internal" href="#dropped-support-for-mysql-8-0-11">不再支持 MySQL 版本低于 8.0.11。</a></li>
<li><a class="reference internal" href="#using-create-defaults-exact-may-now-be-required-with-queryset-update-or-create">在使用 <code class="docutils literal notranslate"><span class="pre">QuerySet.update_or_create()</span></code> 时，可能现在需要使用 <code class="docutils literal notranslate"><span class="pre">create_defaults__exact</span></code>。</a></li>
<li><a class="reference internal" href="#migrating-existing-uuidfield-on-mariadb-10-7">迁移现有的在 MariaDB 10.7+ 上的 <code class="docutils literal notranslate"><span class="pre">UUIDField</span></code></a></li>
<li><a class="reference internal" href="#miscellaneous">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-deprecated-in-5-0">在 5.0 版本中废弃的功能</a><ul>
<li><a class="reference internal" href="#id2">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-removed-in-5-0">在 5.0 版本中移除的功能</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="5.0.1.html"
                          title="上一章">Django 5.0.1 版本发行说明</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="4.2.11.html"
                          title="下一章">Django 4.2.11 release notes</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/releases/5.0.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">2月 21, 2024</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="5.0.1.html" title="Django 5.0.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="4.2.11.html" title="Django 4.2.11 release notes">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>