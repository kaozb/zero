
<!DOCTYPE html>

<html lang="zh_Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Django 2.0 版本发行说明 &#8212; Django 5.0.3.dev20240221071519 文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Django 1.11.29 版本发行说明" href="1.11.29.html" />
    <link rel="prev" title="Django 2.0.1 版本发行说明" href="2.0.1.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 5.0.3.dev20240221071519 文档</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="2.0.1.html" title="Django 2.0.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="1.11.29.html" title="Django 1.11.29 版本发行说明">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="releases-2.0">
            
  <div class="section" id="s-django-2-0-release-notes">
<span id="django-2-0-release-notes"></span><h1>Django 2.0 版本发行说明<a class="headerlink" href="#django-2-0-release-notes" title="永久链接至标题">¶</a></h1>
<p><em>2017 年 12 月 2 日</em></p>
<p>欢迎来到 Django 2.0 版本!</p>
<p>这些发布说明涵盖了 <a class="reference internal" href="#whats-new-2-0"><span class="std std-ref">新特性</span></a>，以及从 Django 1.11 或更早版本升级时需要注意的一些 <a class="reference internal" href="#backwards-incompatible-2-0"><span class="std std-ref">不兼容的变更</span></a>。我们已经 <a class="reference internal" href="#removed-features-2-0"><span class="std std-ref">删除了一些已经达到了弃用周期末尾的功能</span></a>，并且我们已经 <a class="reference internal" href="#deprecated-features-2-0"><span class="std std-ref">开始了一些功能的弃用过程</span></a>。</p>
<p>这个发布版本开始使用了 Django 的一种 <a class="reference internal" href="../internals/release-process.html#internal-release-cadence"><span class="std std-ref">松散形式的语义版本</span></a>，但并没有出现与 2.0 版本发布相符的重大不兼容变更。升级应该与过去的功能发布相似的努力。</p>
<p>如果你要更新现有的项目，请看 <a class="reference internal" href="../howto/upgrade-version.html"><span class="doc">如何将 Django 更新至新的版本</span></a> 指南。</p>
<div class="section" id="s-python-compatibility">
<span id="python-compatibility"></span><h2>Python 兼容性<a class="headerlink" href="#python-compatibility" title="永久链接至标题">¶</a></h2>
<p>Django 2.0 支持 Python 3.4、3.5、3.6 和 3.7。我们 <strong>强烈建议</strong> 并且只官方支持每个系列的最新版本。</p>
<p>Django 1.11.x 系列是支持 Python 2.7 版本的最后一个系列。</p>
<p>Django 2.0 将是最后一个支持 Python 3.4 的发布系列。如果您计划在 Django 2.0 的生命周期结束后（2019 年 4 月）继续使用 Python 3.4，请改用 Django 1.11 LTS（支持到 2020 年 4 月）代替。请注意，Python 3.4 的生命周期将于 2019 年 3 月结束。</p>
</div>
<div class="section" id="s-third-party-library-support-for-older-version-of-django">
<span id="third-party-library-support-for-older-version-of-django"></span><h2>对于较旧版本的 Django 的第三方库支持<a class="headerlink" href="#third-party-library-support-for-older-version-of-django" title="永久链接至标题">¶</a></h2>
<p>在 Django 2.0 发布之后，我们建议第三方应用程序的作者停止支持 1.11 之前的所有 Django 版本。在那个时候，你应该能够使用 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-Wd</span></code> 运行你包的测试，以便弃用警告会出现。在进行弃用警告修复后，你的应用程序应该与 Django 2.0 兼容。</p>
</div>
<div class="section" id="s-what-s-new-in-django-2-0">
<span id="s-whats-new-2-0"></span><span id="what-s-new-in-django-2-0"></span><span id="whats-new-2-0"></span><h2>Django 2.0 新特性<a class="headerlink" href="#what-s-new-in-django-2-0" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-simplified-url-routing-syntax">
<span id="simplified-url-routing-syntax"></span><h3>简化 URL 路由语法<a class="headerlink" href="#simplified-url-routing-syntax" title="永久链接至标题">¶</a></h3>
<p>新版本 <a class="reference internal" href="../ref/urls.html#django.urls.path" title="django.urls.path"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.urls.path()</span></code></a> 函数使用更简单易读的 URL 路由语法。一个来自 Django 旧版本的例子：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^articles/(?P&lt;year&gt;[0-9]</span><span class="si">{4}</span><span class="s2">)/$&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">year_archive</span><span class="p">),</span>
</pre></div>
</div>
<p>可以写成：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span><span class="p">(</span><span class="s2">&quot;articles/&lt;int:year&gt;/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">year_archive</span><span class="p">),</span>
</pre></div>
</div>
<p>新版本语法支持对 URL 参数的强制类型转换。在这个例子中，视图将会以数字类型接收参数 <code class="docutils literal notranslate"><span class="pre">year</span></code> 而不是以字符串类型。而且 URLs 的匹配限制也减少了。例如，因为参数 year 并没有像正则表达式中那样明确限制为四位数，year 为 10000 也会匹配成功。</p>
<p>旧版本中的 <code class="docutils literal notranslate"><span class="pre">django.conf.urls.url()</span></code> 函数现在可以在 <a class="reference internal" href="../ref/urls.html#django.urls.re_path" title="django.urls.re_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.urls.re_path()</span></code></a> 中获取。前者依然保留，向后兼容，并没有立即弃用。旧版本中的 <code class="docutils literal notranslate"><span class="pre">django.conf.urls.include()</span></code> 函数现在可以从 <code class="docutils literal notranslate"><span class="pre">django.urls</span></code> 中导入，这样你就可以在 URLconfs 中使用 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">django.urls</span> <span class="pre">import</span> <span class="pre">include,</span> <span class="pre">path,</span> <span class="pre">re_path</span></code> 。</p>
<p>重新编写的文档 <a class="reference internal" href="../topics/http/urls.html"><span class="doc">URL调度器</span></a> 涵盖了新的语法并且提供了更多的细节。</p>
</div>
<div class="section" id="s-mobile-friendly-contrib-admin">
<span id="mobile-friendly-contrib-admin"></span><h3><code class="docutils literal notranslate"><span class="pre">contrib.admin</span></code> 针对移动设备的优化改进<a class="headerlink" href="#mobile-friendly-contrib-admin" title="永久链接至标题">¶</a></h3>
<p>新版本的 admin 可以响应和支持所有主流移动设备。较旧的浏览器可能会遇到不同程度的功能降低。</p>
</div>
<div class="section" id="s-window-expressions">
<span id="window-expressions"></span><h3>Window 表达式<a class="headerlink" href="#window-expressions" title="永久链接至标题">¶</a></h3>
<p>新的 <a class="reference internal" href="../ref/models/expressions.html#django.db.models.expressions.Window" title="django.db.models.expressions.Window"><code class="xref py py-class docutils literal notranslate"><span class="pre">Window</span></code></a> 表达式允许在查询集上添加一个 <code class="docutils literal notranslate"><span class="pre">OVER</span></code> 子句。你可以在这个表达式中使用 <a class="reference internal" href="../ref/models/database-functions.html#window-functions"><span class="std std-ref">窗口函数</span></a> 和 <a class="reference internal" href="../ref/models/querysets.html#aggregation-functions"><span class="std std-ref">聚合函数</span></a>。</p>
</div>
<div class="section" id="s-minor-features">
<span id="minor-features"></span><h3>次要特性<a class="headerlink" href="#minor-features" title="永久链接至标题">¶</a></h3>
<div class="section" id="s-django-contrib-admin">
<span id="django-contrib-admin"></span><h4><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#django-contrib-admin" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.autocomplete_fields" title="django.contrib.admin.ModelAdmin.autocomplete_fields"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.autocomplete_fields</span></code></a> 属性和 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.get_autocomplete_fields" title="django.contrib.admin.ModelAdmin.get_autocomplete_fields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.get_autocomplete_fields()</span></code></a> 方法允许在 <code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ManyToManyField</span></code> 上使用 <a class="reference external" href="https://select2.org/">Select2</a> 搜索小部件。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-auth">
<span id="django-contrib-auth"></span><h4><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a><a class="headerlink" href="#django-contrib-auth" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>PBKDF2 密码散列器的默认迭代计数从 36,000 增加到 100,000。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-gis">
<span id="django-contrib-gis"></span><h4><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#django-contrib-gis" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>增加了 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.AsGeoJSON" title="django.contrib.gis.db.models.functions.AsGeoJSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsGeoJSON</span></code></a> 函数、 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.GeoHash" title="django.contrib.gis.db.models.functions.GeoHash"><code class="xref py py-class docutils literal notranslate"><span class="pre">GeoHash</span></code></a> 函数、<a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.IsValid" title="django.contrib.gis.db.models.functions.IsValid"><code class="xref py py-class docutils literal notranslate"><span class="pre">IsValid</span></code></a> 函数、<a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#std-fieldlookup-isvalid"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">isvalid</span></code></a> 查找、以及 <a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#distance-lookups"><span class="std std-ref">distance lookups</span></a> 对 MySQL 的支持。</li>
<li>添加了 PostGIS 和 SpatiaLite 支持的两个函数 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.Azimuth" title="django.contrib.gis.db.models.functions.Azimuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">Azimuth</span></code></a> 和 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.LineLocatePoint" title="django.contrib.gis.db.models.functions.LineLocatePoint"><code class="xref py py-class docutils literal notranslate"><span class="pre">LineLocatePoint</span></code></a>。</li>
<li>现在所有从 GeoJSON 导入的 <a class="reference internal" href="../ref/contrib/gis/geos.html#django.contrib.gis.geos.GEOSGeometry" title="django.contrib.gis.geos.GEOSGeometry"><code class="xref py py-class docutils literal notranslate"><span class="pre">GEOSGeometry</span></code></a> 都设置了其 SRID。</li>
<li>添加了 <a class="reference internal" href="../ref/contrib/gis/forms-api.html#django.contrib.gis.forms.widgets.OSMWidget.default_zoom" title="django.contrib.gis.forms.widgets.OSMWidget.default_zoom"><code class="xref py py-attr docutils literal notranslate"><span class="pre">OSMWidget.default_zoom</span></code></a> 属性来自定义地图的默认缩放级别。</li>
<li>通过 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALRaster.metadata" title="django.contrib.gis.gdal.GDALRaster.metadata"><code class="xref py py-attr docutils literal notranslate"><span class="pre">metadata</span></code></a>、<a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALRaster.info" title="django.contrib.gis.gdal.GDALRaster.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">info</span></code></a> 和 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALBand.metadata" title="django.contrib.gis.gdal.GDALBand.metadata"><code class="xref py py-attr docutils literal notranslate"><span class="pre">metadata</span></code></a> 属性，使栅格数据的元数据可读可编辑。</li>
<li>允许使用 <code class="docutils literal notranslate"><span class="pre">papsz_options</span></code> 将 driver-specific creation options 传递给 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALRaster" title="django.contrib.gis.gdal.GDALRaster"><code class="xref py py-class docutils literal notranslate"><span class="pre">GDALRaster</span></code></a> 对象。</li>
<li>允许在 GDAL 的内部虚拟文件系统中创建 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALRaster" title="django.contrib.gis.gdal.GDALRaster"><code class="xref py py-class docutils literal notranslate"><span class="pre">GDALRaster</span></code></a> 对象。现在可以将栅格数据从内存中的二进制数据 <a class="reference internal" href="../ref/contrib/gis/gdal.html#gdal-raster-vsimem"><span class="std std-ref">创建和转换</span></a>。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALBand.color_interp" title="django.contrib.gis.gdal.GDALBand.color_interp"><code class="xref py py-meth docutils literal notranslate"><span class="pre">GDALBand.color_interp()</span></code></a> 方法返回了该波段的颜色解释。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-postgres">
<span id="django-contrib-postgres"></span><h4><a class="reference internal" href="../ref/contrib/postgres/index.html#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a><a class="headerlink" href="#django-contrib-postgres" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>对于 <a class="reference internal" href="../ref/contrib/postgres/aggregates.html#django.contrib.postgres.aggregates.ArrayAgg" title="django.contrib.postgres.aggregates.ArrayAgg"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArrayAgg</span></code></a>，新的 <code class="docutils literal notranslate"><span class="pre">distinct</span></code> 参数确定连接的值是否是不同的。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/postgres/functions.html#django.contrib.postgres.functions.RandomUUID" title="django.contrib.postgres.functions.RandomUUID"><code class="xref py py-class docutils literal notranslate"><span class="pre">RandomUUID</span></code></a> 数据库函数返回版本 4 的 UUID。它需要使用 PostgreSQL 的 <code class="docutils literal notranslate"><span class="pre">pgcrypto</span></code> 扩展，可以通过新的 <a class="reference internal" href="../ref/contrib/postgres/operations.html#django.contrib.postgres.operations.CryptoExtension" title="django.contrib.postgres.operations.CryptoExtension"><code class="xref py py-class docutils literal notranslate"><span class="pre">CryptoExtension</span></code></a> 迁移操作来激活。</li>
<li><a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.GinIndex" title="django.contrib.postgres.indexes.GinIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.contrib.postgres.indexes.GinIndex</span></code></a> 现在支持 <code class="docutils literal notranslate"><span class="pre">fastupdate</span></code> 和 <code class="docutils literal notranslate"><span class="pre">gin_pending_list_limit</span></code> 参数。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.GistIndex" title="django.contrib.postgres.indexes.GistIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">GistIndex</span></code></a> 类允许在数据库中创建 <code class="docutils literal notranslate"><span class="pre">GiST</span></code> 索引。新的 <a class="reference internal" href="../ref/contrib/postgres/operations.html#django.contrib.postgres.operations.BtreeGistExtension" title="django.contrib.postgres.operations.BtreeGistExtension"><code class="xref py py-class docutils literal notranslate"><span class="pre">BtreeGistExtension</span></code></a> 迁移操作安装了 <code class="docutils literal notranslate"><span class="pre">btree_gist</span></code> 扩展，以添加对不是内置的操作符类的支持。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-inspectdb"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">inspectdb</span></code></a> 现在可以内省 <code class="docutils literal notranslate"><span class="pre">JSONField</span></code> 和各种 <code class="docutils literal notranslate"><span class="pre">RangeField</span></code> （必须将 <code class="docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code> 添加到 <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> 中）。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sitemaps">
<span id="django-contrib-sitemaps"></span><h4><a class="reference internal" href="../ref/contrib/sitemaps.html#module-django.contrib.sitemaps" title="django.contrib.sitemaps: A framework for generating Google sitemap XML files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sitemaps</span></code></a><a class="headerlink" href="#django-contrib-sitemaps" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 <a class="reference internal" href="../ref/contrib/sitemaps.html#django.contrib.sitemaps.GenericSitemap" title="django.contrib.sitemaps.GenericSitemap"><code class="xref py py-class docutils literal notranslate"><span class="pre">GenericSitemap</span></code></a> 构造函数中添加了 <code class="docutils literal notranslate"><span class="pre">protocol</span></code> 关键字参数。</li>
</ul>
</div>
<div class="section" id="s-cache">
<span id="cache"></span><h4>缓存<a class="headerlink" href="#cache" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">cache.set_many()</span></code> 现在返回一个未能插入的键的列表。对于内置的后端，失败的插入只会发生在 memcached 上。</li>
</ul>
</div>
<div class="section" id="s-file-storage">
<span id="file-storage"></span><h4>文件存储<a class="headerlink" href="#file-storage" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/files/file.html#django.core.files.File.open" title="django.core.files.File.open"><code class="xref py py-meth docutils literal notranslate"><span class="pre">File.open()</span></code></a> 可以作为上下文管理器使用，例如 <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">file.open()</span> <span class="pre">as</span> <span class="pre">f:</span></code>。</li>
</ul>
</div>
<div class="section" id="s-forms">
<span id="forms"></span><h4>表单<a class="headerlink" href="#forms" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>对于 <a class="reference internal" href="../ref/forms/widgets.html#django.forms.SplitDateTimeWidget" title="django.forms.SplitDateTimeWidget"><code class="xref py py-class docutils literal notranslate"><span class="pre">SplitDateTimeWidget</span></code></a> 和 <a class="reference internal" href="../ref/forms/widgets.html#django.forms.SplitHiddenDateTimeWidget" title="django.forms.SplitHiddenDateTimeWidget"><code class="xref py py-class docutils literal notranslate"><span class="pre">SplitHiddenDateTimeWidget</span></code></a>，新的 <code class="docutils literal notranslate"><span class="pre">date_attrs</span></code> 和 <code class="docutils literal notranslate"><span class="pre">time_attrs</span></code> 参数允许指定不同的 HTML 属性用于 <code class="docutils literal notranslate"><span class="pre">DateInput</span></code> 和 <code class="docutils literal notranslate"><span class="pre">TimeInput</span></code> （或隐藏）子部件。</li>
<li>新的 <a class="reference internal" href="../ref/forms/api.html#django.forms.Form.errors.get_json_data" title="django.forms.Form.errors.get_json_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Form.errors.get_json_data()</span></code></a> 方法返回适用于包含在 JSON 响应中的表单错误的字典。</li>
</ul>
</div>
<div class="section" id="s-generic-views">
<span id="generic-views"></span><h4>通用视图<a class="headerlink" href="#generic-views" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新属性 <a class="reference internal" href="../ref/class-based-views/mixins-simple.html#django.views.generic.base.ContextMixin.extra_context" title="django.views.generic.base.ContextMixin.extra_context"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ContextMixin.extra_context</span></code></a> 允许在 <code class="docutils literal notranslate"><span class="pre">View.as_view()</span></code> 添加上下文。</li>
</ul>
</div>
<div class="section" id="s-management-commands">
<span id="management-commands"></span><h4>管理命令<a class="headerlink" href="#management-commands" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-inspectdb"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">inspectdb</span></code></a> 现在将 MySQL 的无符号整数列翻译为 <code class="docutils literal notranslate"><span class="pre">PositiveIntegerField</span></code> 或 <code class="docutils literal notranslate"><span class="pre">PositiveSmallIntegerField</span></code>。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-makemessages-add-location"><code class="xref std std-option docutils literal notranslate"><span class="pre">makemessages</span> <span class="pre">--add-location</span></code></a> 选项控制 <code class="docutils literal notranslate"><span class="pre">.po</span></code> 文件中的注释格式。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-loaddata"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">loaddata</span></code></a> 现在可以从标准输入中 <a class="reference internal" href="../ref/django-admin.html#loading-fixtures-stdin"><span class="std std-ref">读取数据</span></a>。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-diffsettings-output"><code class="xref std std-option docutils literal notranslate"><span class="pre">diffsettings</span> <span class="pre">--output</span></code></a> 选项允许以统一的差异格式格式化输出。</li>
<li>在 Oracle 上，<a class="reference internal" href="../ref/django-admin.html#django-admin-inspectdb"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">inspectdb</span></code></a> 现在可以内省 <code class="docutils literal notranslate"><span class="pre">AutoField</span></code>，如果列被创建为标识列（identity column）。</li>
<li>在 MySQL 上，<a class="reference internal" href="../ref/django-admin.html#django-admin-dbshell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">dbshell</span></code></a> 现在支持客户端端的 TLS 证书。</li>
</ul>
</div>
<div class="section" id="s-migrations">
<span id="migrations"></span><h4>迁移<a class="headerlink" href="#migrations" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-squashmigrations-squashed-name"><code class="xref std std-option docutils literal notranslate"><span class="pre">squashmigrations</span> <span class="pre">--squashed-name</span></code></a> 选项允许命名合并后的迁移。</li>
</ul>
</div>
<div class="section" id="s-models">
<span id="models"></span><h4>模型<a class="headerlink" href="#models" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.StrIndex" title="django.db.models.functions.StrIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">StrIndex</span></code></a> 数据库函数用于查找一个字符串在另一个字符串中的起始索引。</li>
<li>在 Oracle 上，现在会将 <code class="docutils literal notranslate"><span class="pre">AutoField</span></code> 和 <code class="docutils literal notranslate"><span class="pre">BigAutoField</span></code> 创建为 <a class="reference external" href="https://docs.oracle.com/en/database/oracle/oracle-database/21/drdaa/intro-to-tools-and-products-supporting-migraiton.html#GUID-14E4817B-F3BC-4D99-B471-A0ACDC303CC9">标识列</a>。</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.iterator" title="django.db.models.query.QuerySet.iterator"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.iterator()</span></code></a> 的新参数 <code class="docutils literal notranslate"><span class="pre">chunk_size</span></code> 控制在从数据库流式传输结果时由 Python 数据库客户端提取的行数。对于不支持服务器端游标的数据库，它控制 Django 从数据库适配器提取的结果数量。</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.earliest" title="django.db.models.query.QuerySet.earliest"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.earliest()</span></code></a>、<a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.latest" title="django.db.models.query.QuerySet.latest"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.latest()</span></code></a> 和 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.get_latest_by" title="django.db.models.Options.get_latest_by"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.get_latest_by</span></code></a> 现在允许按多个字段排序。</li>
<li>新增了 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.ExtractQuarter" title="django.db.models.functions.ExtractQuarter"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtractQuarter</span></code></a> 函数，用于从 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateField" title="django.db.models.DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a> 和 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a> 中提取季度，并通过 <a class="reference internal" href="../ref/models/querysets.html#std-fieldlookup-quarter"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">quarter</span></code></a> 查找公开。</li>
<li>新增了 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.TruncQuarter" title="django.db.models.functions.TruncQuarter"><code class="xref py py-class docutils literal notranslate"><span class="pre">TruncQuarter</span></code></a> 函数，用于将 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateField" title="django.db.models.DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a> 和 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a> 截断到季度的第一天。</li>
<li>为基于类的索引添加了 <a class="reference internal" href="../ref/models/indexes.html#django.db.models.Index.db_tablespace" title="django.db.models.Index.db_tablespace"><code class="xref py py-attr docutils literal notranslate"><span class="pre">db_tablespace</span></code></a> 参数。</li>
<li>如果数据库支持原生的持续时间字段（Oracle 和 PostgreSQL），<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Extract" title="django.db.models.functions.Extract"><code class="xref py py-class docutils literal notranslate"><span class="pre">Extract</span></code></a> 现在可以与 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DurationField" title="django.db.models.DurationField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DurationField</span></code></a> 一起使用。</li>
<li>新增了 <code class="docutils literal notranslate"><span class="pre">of</span></code> 参数到 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.select_for_update" title="django.db.models.query.QuerySet.select_for_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.select_for_update()</span></code></a>，在 PostgreSQL 和 Oracle 上支持，可以锁定特定表中的行，而不是所有选定的表。这在特别是当 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.select_for_update" title="django.db.models.query.QuerySet.select_for_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">select_for_update()</span></code></a> 与 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.select_related" title="django.db.models.query.QuerySet.select_related"><code class="xref py py-meth docutils literal notranslate"><span class="pre">select_related()</span></code></a> 结合使用时可能会有所帮助。</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.in_bulk" title="django.db.models.query.QuerySet.in_bulk"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.in_bulk()</span></code></a> 的新参数 <code class="docutils literal notranslate"><span class="pre">field_name</span></code> 允许根据任何唯一模型字段获取结果。</li>
<li><a class="reference internal" href="../topics/db/sql.html#django.db.models.CursorWrapper.callproc" title="django.db.models.CursorWrapper.callproc"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorWrapper.callproc()</span></code></a> 现在可以接受一个可选的关键字参数字典，如果后端支持此功能。Django 内置的后端中，只有 Oracle 支持这个功能。</li>
<li>新的 <a class="reference internal" href="../topics/db/instrumentation.html#django.db.backends.base.DatabaseWrapper.execute_wrapper" title="django.db.backends.base.DatabaseWrapper.execute_wrapper"><code class="xref py py-meth docutils literal notranslate"><span class="pre">connection.execute_wrapper()</span></code></a> 方法允许 <a class="reference internal" href="../topics/db/instrumentation.html"><span class="doc">在执行数据库查询时安装包装器</span></a>。</li>
<li>内置聚合函数的新 <code class="docutils literal notranslate"><span class="pre">filter</span></code> 参数允许在同一字段或关系上的多个聚合中 <a class="reference internal" href="../ref/models/conditional-expressions.html#conditional-aggregation"><span class="std std-ref">添加不同的条件</span></a>。</li>
<li>在 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.ordering" title="django.db.models.Options.ordering"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.ordering</span></code></a> 中添加了对表达式的支持。</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.values_list" title="django.db.models.query.QuerySet.values_list"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.values_list()</span></code></a> 的新参数 <code class="docutils literal notranslate"><span class="pre">named</span></code> 允许将结果作为命名元组获取。</li>
<li>新的 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.FilteredRelation" title="django.db.models.FilteredRelation"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilteredRelation</span></code></a> 类允许在查询集中添加一个 <code class="docutils literal notranslate"><span class="pre">ON</span></code> 子句。</li>
</ul>
</div>
<div class="section" id="s-pagination">
<span id="pagination"></span><h4>分页<a class="headerlink" href="#pagination" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>添加了 <a class="reference internal" href="../ref/paginator.html#django.core.paginator.Paginator.get_page" title="django.core.paginator.Paginator.get_page"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Paginator.get_page()</span></code></a>，以提供处理无效页码的文档化模式。</li>
</ul>
</div>
<div class="section" id="s-requests-and-responses">
<span id="requests-and-responses"></span><h4>请求和响应<a class="headerlink" href="#requests-and-responses" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-runserver"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">runserver</span></code></a> Web 服务器支持 HTTP 1.1。</li>
</ul>
</div>
<div class="section" id="s-templates">
<span id="templates"></span><h4>模板<a class="headerlink" href="#templates" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>为了增加第三方应用程序中 <a class="reference internal" href="../ref/templates/api.html#django.template.Engine.get_default" title="django.template.Engine.get_default"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Engine.get_default()</span></code></a> 的实用性，如果在 <code class="docutils literal notranslate"><span class="pre">TEMPLATES</span></code> 中配置了多个 <code class="docutils literal notranslate"><span class="pre">DjangoTemplates</span></code> 引擎，它现在将返回第一个引擎，而不是引发 <code class="docutils literal notranslate"><span class="pre">ImproperlyConfigured</span></code> 异常。</li>
<li>现在自定义模板标签可以接受仅限关键字的参数。</li>
</ul>
</div>
<div class="section" id="s-tests">
<span id="tests"></span><h4>测试<a class="headerlink" href="#tests" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>向 <a class="reference internal" href="../topics/testing/tools.html#django.test.LiveServerTestCase" title="django.test.LiveServerTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">LiveServerTestCase</span></code></a> 添加了多线程支持。</li>
<li>添加了允许自定义 Oracle 测试表空间参数的设置：<a class="reference internal" href="../ref/settings.html#std-setting-DATAFILE_SIZE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATAFILE_SIZE</span></code></a>、<a class="reference internal" href="../ref/settings.html#std-setting-DATAFILE_TMP_SIZE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATAFILE_TMP_SIZE</span></code></a>、<a class="reference internal" href="../ref/settings.html#std-setting-DATAFILE_EXTSIZE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATAFILE_EXTSIZE</span></code></a> 和 <a class="reference internal" href="../ref/settings.html#std-setting-DATAFILE_TMP_EXTSIZE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATAFILE_TMP_EXTSIZE</span></code></a>。</li>
</ul>
</div>
<div class="section" id="s-validators">
<span id="validators"></span><h4>验证器<a class="headerlink" href="#validators" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/validators.html#django.core.validators.ProhibitNullCharactersValidator" title="django.core.validators.ProhibitNullCharactersValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProhibitNullCharactersValidator</span></code></a> 在 <a class="reference internal" href="../ref/forms/fields.html#django.forms.CharField" title="django.forms.CharField"><code class="xref py py-class docutils literal notranslate"><span class="pre">CharField</span></code></a> 表单字段及其子类的输入中禁止使用空字符。空字符输入是由于漏洞扫描工具而观察到的。大多数数据库会悄悄地丢弃空字符，但是当尝试将空字符保存到 PostgreSQL 的 char/text 字段时，psycopg2 2.7+ 会引发异常。</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-backwards-incompatible-changes-in-2-0">
<span id="s-backwards-incompatible-2-0"></span><span id="backwards-incompatible-changes-in-2-0"></span><span id="backwards-incompatible-2-0"></span><h2>2.0 版本的不向后兼容变更<a class="headerlink" href="#backwards-incompatible-changes-in-2-0" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-removed-support-for-bytestrings-in-some-places">
<span id="removed-support-for-bytestrings-in-some-places"></span><h3>在某些地方移除了对字节字符串的支持<a class="headerlink" href="#removed-support-for-bytestrings-in-some-places" title="永久链接至标题">¶</a></h3>
<p>为了支持原生的 Python 2 字符串，旧版本的 Django 必须同时接受字节字符串和 Unicode 字符串。现在 Python 2 的支持已被移除，字节字符串应该只出现在输入/输出边界（例如处理二进制字段或 HTTP 流）附近。您可能需要更新您的代码，以将字节字符串的使用限制到最低，因为 Django 不再在某些代码路径中接受字节字符串。Python 的 <a class="reference external" href="https://docs.python.org/3/using/cmdline.html#cmdoption-b" title="(在 Python v3.12)"><code class="xref std std-option docutils literal notranslate"><span class="pre">-b</span></code></a> 选项可能有助于检测代码中的这种错误。</p>
<p>例如，现在 <code class="docutils literal notranslate"><span class="pre">reverse()</span></code> 在将接收到的 <code class="docutils literal notranslate"><span class="pre">args</span></code> 和 <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> 放置在 URL 之前，使用 <code class="docutils literal notranslate"><span class="pre">str()</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">force_text()</span></code> 来强制转换它们。对于字节字符串，这会创建一个带有不希望的 <code class="docutils literal notranslate"><span class="pre">b</span></code> 前缀以及额外引号的字符串（<code class="docutils literal notranslate"><span class="pre">str(b'foo')</span></code> 是 <code class="docutils literal notranslate"><span class="pre">&quot;b'foo'&quot;</span></code>）。为了适应这种变化，在将字节字符串传递给 <code class="docutils literal notranslate"><span class="pre">reverse()</span></code> 之前，请调用 <code class="docutils literal notranslate"><span class="pre">decode()</span></code>。</p>
</div>
<div class="section" id="s-database-backend-api">
<span id="database-backend-api"></span><h3>数据库后端 API<a class="headerlink" href="#database-backend-api" title="永久链接至标题">¶</a></h3>
<p>本节介绍了第三方数据库后端可能需要的更改。</p>
<ul class="simple">
<li>现在，<code class="docutils literal notranslate"><span class="pre">DatabaseOperations.datetime_cast_date_sql()</span></code>、<code class="docutils literal notranslate"><span class="pre">datetime_cast_time_sql()</span></code>、<code class="docutils literal notranslate"><span class="pre">datetime_trunc_sql()</span></code>、<code class="docutils literal notranslate"><span class="pre">datetime_extract_sql()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">date_interval_sql()</span></code> 方法仅返回执行操作的 SQL，而不再返回 SQL 和参数列表。</li>
<li>第三方数据库后端应该添加一个名为 <code class="docutils literal notranslate"><span class="pre">DatabaseWrapper.display_name</span></code> 的属性，该属性包含您的后端适用于的数据库名称。Django 可能会在各种消息中使用它，例如系统检查中。</li>
<li><code class="docutils literal notranslate"><span class="pre">SchemaEditor._alter_column_type_sql()</span></code> 的第一个参数现在是 <code class="docutils literal notranslate"><span class="pre">model</span></code>，而不再是 <code class="docutils literal notranslate"><span class="pre">table</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">SchemaEditor._create_index_name()</span></code> 的第一个参数现在是 <code class="docutils literal notranslate"><span class="pre">table_name</span></code>，而不再是 <code class="docutils literal notranslate"><span class="pre">model</span></code>。</li>
<li>要启用 <code class="docutils literal notranslate"><span class="pre">FOR</span> <span class="pre">UPDATE</span> <span class="pre">OF</span></code> 支持，请设置 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.has_select_for_update_of</span> <span class="pre">=</span> <span class="pre">True</span></code>。如果数据库要求 <code class="docutils literal notranslate"><span class="pre">OF</span></code> 的参数是列而不是表，请设置 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.select_for_update_of_column</span> <span class="pre">=</span> <span class="pre">True</span></code>。</li>
<li>要启用对 <a class="reference internal" href="../ref/models/expressions.html#django.db.models.expressions.Window" title="django.db.models.expressions.Window"><code class="xref py py-class docutils literal notranslate"><span class="pre">Window</span></code></a> 表达式的支持，请将 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.supports_over_clause</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。您可能需要自定义 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.window_start_rows_start_end()</span></code> 和/或 <code class="docutils literal notranslate"><span class="pre">window_start_range_start_end()</span></code> 方法。</li>
<li>第三方数据库后端应该添加一个名为 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.cast_char_field_without_max_length</span></code> 的属性，该属性指定在没有提供 <code class="docutils literal notranslate"><span class="pre">max_length</span></code> 参数的情况下，在 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Cast" title="django.db.models.functions.Cast"><code class="xref py py-class docutils literal notranslate"><span class="pre">Cast</span></code></a> 函数中将用于 <code class="docutils literal notranslate"><span class="pre">CharField</span></code> 的数据库数据类型。</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseCreation._clone_test_db()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">get_test_db_clone_settings()</span></code> 的第一个参数现在是 <code class="docutils literal notranslate"><span class="pre">suffix</span></code>，而不再是 <code class="docutils literal notranslate"><span class="pre">number``（如果您希望为了一致性而在您的后端中重命名签名）。``django.test</span></code> 现在也将这些值作为字符串而不是整数传递。</li>
<li>第三方数据库后端应该基于 <code class="docutils literal notranslate"><span class="pre">BaseDatabaseIntrospection</span></code> 中的存根添加一个名为 <code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.get_sequences()</span></code> 的方法。</li>
</ul>
</div>
<div class="section" id="s-dropped-support-for-oracle-11-2">
<span id="dropped-support-for-oracle-11-2"></span><h3>不再支持 Oracle 11.2<a class="headerlink" href="#dropped-support-for-oracle-11-2" title="永久链接至标题">¶</a></h3>
<p>Oracle 11.2 的上游支持将于 2020 年 12 月结束。 Django 1.11 将在 2020 年 4 月之前得到支持，几乎达到了这个日期。 Django 2.0 正式支持 Oracle 12.1 及更高版本。</p>
</div>
<div class="section" id="s-default-mysql-isolation-level-is-read-committed">
<span id="default-mysql-isolation-level-is-read-committed"></span><h3>默认的 MySQL 隔离级别为读已提交（read committed）<a class="headerlink" href="#default-mysql-isolation-level-is-read-committed" title="永久链接至标题">¶</a></h3>
<p>MySQL 的默认隔离级别，可重复读（repeatable read），在典型的 Django 使用中可能会导致数据丢失。为了防止这种情况并保持与其他数据库的一致性，现在默认的隔离级别是读提交（read committed）。如果需要，您可以使用 <a class="reference internal" href="../ref/settings.html#std-setting-DATABASES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATABASES</span></code></a> 设置来 <a class="reference internal" href="../ref/databases.html#mysql-isolation-level"><span class="std std-ref">使用不同的隔离级别</span></a>。</p>
</div>
<div class="section" id="s-abstractuser-last-name-max-length-increased-to-150">
<span id="abstractuser-last-name-max-length-increased-to-150"></span><h3><a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User.last_name" title="django.contrib.auth.models.User.last_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AbstractUser.last_name</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">max_length</span></code> 增加到了 150。<a class="headerlink" href="#abstractuser-last-name-max-length-increased-to-150" title="永久链接至标题">¶</a></h3>
<p>包含了 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User.last_name" title="django.contrib.auth.models.User.last_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">django.contrib.auth.models.User.last_name</span></code></a> 的迁移。如果您有一个从 <code class="docutils literal notranslate"><span class="pre">AbstractUser</span></code> 继承的自定义用户模型，您需要生成并应用一个数据库迁移来更新您的用户模型。</p>
<p>如果您想保留姓氏的 30 个字符限制，请使用自定义表单：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">UserChangeForm</span>


<span class="k">class</span> <span class="nc">MyUserChangeForm</span><span class="p">(</span><span class="n">UserChangeForm</span><span class="p">):</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>如果你想在管理中编辑用户时保留这个限制，请将 <code class="docutils literal notranslate"><span class="pre">UserAdmin.form</span></code> 设置为使用这个表单：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.admin</span> <span class="kn">import</span> <span class="n">UserAdmin</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>


<span class="k">class</span> <span class="nc">MyUserAdmin</span><span class="p">(</span><span class="n">UserAdmin</span><span class="p">):</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">MyUserChangeForm</span>


<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">MyUserAdmin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-queryset-reverse-and-last-are-prohibited-after-slicing">
<span id="queryset-reverse-and-last-are-prohibited-after-slicing"></span><h3>在切片之后，禁止使用 <code class="docutils literal notranslate"><span class="pre">QuerySet.reverse()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">last()</span></code>。<a class="headerlink" href="#queryset-reverse-and-last-are-prohibited-after-slicing" title="永久链接至标题">¶</a></h3>
<p>在切片后调用 <code class="docutils literal notranslate"><span class="pre">QuerySet.reverse()</span></code> 或 <code class="docutils literal notranslate"><span class="pre">last()</span></code> 会导致意外的结果，因为切片是在重新排序后应用的。现在已禁止这样使用，例如：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">Cannot reverse a query once a slice has been taken.</span>
</pre></div>
</div>
</div>
<div class="section" id="s-form-fields-no-longer-accept-optional-arguments-as-positional-arguments">
<span id="form-fields-no-longer-accept-optional-arguments-as-positional-arguments"></span><h3>表单字段不再将可选参数作为位置参数接受<a class="headerlink" href="#form-fields-no-longer-accept-optional-arguments-as-positional-arguments" title="永久链接至标题">¶</a></h3>
<p>为了帮助防止由于表单字段参数顺序不正确而导致的运行时错误，内置表单字段的可选参数不再作为位置参数接受。例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">forms</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>会引发异常，并且应该替换为：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">forms</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">max_value</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-call-command-validates-the-options-it-receives">
<span id="call-command-validates-the-options-it-receives"></span><h3><code class="docutils literal notranslate"><span class="pre">call_command()</span></code> 验证它接收到的选项<a class="headerlink" href="#call-command-validates-the-options-it-receives" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">call_command()</span></code> 现在验证被调用的命令的参数解析器是否定义了传递给 <code class="docutils literal notranslate"><span class="pre">call_command()</span></code> 的所有选项。</p>
<p>对于使用非 <code class="docutils literal notranslate"><span class="pre">parser.add_argument()</span></code> 创建的选项的自定义管理命令，请在命令上添加一个名为 <code class="docutils literal notranslate"><span class="pre">stealth_options</span></code> 的属性：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyCommand</span><span class="p">(</span><span class="n">BaseCommand</span><span class="p">):</span>
    <span class="n">stealth_options</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;option_name&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-indexes-no-longer-accept-positional-arguments">
<span id="indexes-no-longer-accept-positional-arguments"></span><h3>索引不再接受位置参数<a class="headerlink" href="#indexes-no-longer-accept-positional-arguments" title="永久链接至标题">¶</a></h3>
<p>例子：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">([</span><span class="s2">&quot;headline&quot;</span><span class="p">,</span> <span class="s2">&quot;-pub_date&quot;</span><span class="p">],</span> <span class="s2">&quot;index_name&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>会引发异常，并且应该替换为：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;headline&quot;</span><span class="p">,</span> <span class="s2">&quot;-pub_date&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index_name&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-foreign-key-constraints-are-now-enabled-on-sqlite">
<span id="foreign-key-constraints-are-now-enabled-on-sqlite"></span><h3>现在在 SQLite 上启用了外键约束（Foreign key constraints）<a class="headerlink" href="#foreign-key-constraints-are-now-enabled-on-sqlite" title="永久链接至标题">¶</a></h3>
<p>如果尝试保存违反外键约束的现有模型实例，将会出现不兼容的后向变更（<code class="docutils literal notranslate"><span class="pre">IntegrityError:</span> <span class="pre">FOREIGN</span> <span class="pre">KEY</span> <span class="pre">constraint</span> <span class="pre">failed</span></code>）。</p>
<p>外键现在使用 <code class="docutils literal notranslate"><span class="pre">DEFERRABLE</span> <span class="pre">INITIALLY</span> <span class="pre">DEFERRED</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">DEFERRABLE</span> <span class="pre">IMMEDIATE</span></code> 来创建。因此，可能需要重新构建表以使用新的定义重新创建外键，特别是如果您使用了类似这样的模式：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">transaction</span>

<span class="k">with</span> <span class="n">transaction</span><span class="o">.</span><span class="n">atomic</span><span class="p">():</span>
    <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">author_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>如果不将外键重新创建为 <code class="docutils literal notranslate"><span class="pre">DEFERRED</span></code>，那么由于现在强制执行外键约束，第一次的 <code class="docutils literal notranslate"><span class="pre">create()</span></code> 将会失败。</p>
<p>首先备份您的数据库！在升级到 Django 2.0 后，您可以使用类似以下脚本的方式重新构建表格：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.apps</span> <span class="kn">import</span> <span class="n">apps</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connection</span>

<span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_app_configs</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">get_models</span><span class="p">(</span><span class="n">include_auto_created</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">managed</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">proxy</span> <span class="ow">or</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">swapped</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s2">&quot;_meta&quot;</span><span class="p">):</span>
                    <span class="n">base</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">local_many_to_many</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">local_many_to_many</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">schema_editor</span><span class="p">()</span> <span class="k">as</span> <span class="n">editor</span><span class="p">:</span>
                <span class="n">editor</span><span class="o">.</span><span class="n">_remake_table</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>这个脚本尚未经过广泛测试，并且需要根据不同情况进行调整，比如多个数据库的情况。欢迎贡献改进。</p>
<p>另外，由于 SQLite 的表更改限制，禁止在事务中对被其他模型引用的模型或字段执行 <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RenameModel" title="django.db.migrations.operations.RenameModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">RenameModel</span></code></a> 和 <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RenameField" title="django.db.migrations.operations.RenameField"><code class="xref py py-class docutils literal notranslate"><span class="pre">RenameField</span></code></a> 操作。为了允许应用包含这些操作的迁移，您必须将 <code class="docutils literal notranslate"><span class="pre">Migration.atomic</span></code> 属性设置为 <code class="docutils literal notranslate"><span class="pre">False</span></code>。</p>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h3>杂项<a class="headerlink" href="#miscellaneous" title="永久链接至标题">¶</a></h3>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">SessionAuthenticationMiddleware</span></code> 类已被移除。自 Django 1.10 版本起，它不再提供任何功能，因为会话身份验证已无条件启用。</p>
</li>
<li><p class="first">默认的 HTTP 错误处理程序（<code class="docutils literal notranslate"><span class="pre">handler404</span></code> 等）现在是可调用函数，而不再是点分 Python 路径字符串。Django 更倾向于可调用引用，因为它们提供更好的性能和调试体验。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/class-based-views/base.html#django.views.generic.base.RedirectView" title="django.views.generic.base.RedirectView"><code class="xref py py-class docutils literal notranslate"><span class="pre">RedirectView</span></code></a> 不再在 <code class="docutils literal notranslate"><span class="pre">pattern_name</span></code> 不存在时抑制 <code class="docutils literal notranslate"><span class="pre">NoReverseMatch</span></code>。</p>
</li>
<li><p class="first">当 <code class="docutils literal notranslate"><span class="pre">USE_L10N</span></code> 关闭时，<a class="reference internal" href="../ref/forms/fields.html#django.forms.FloatField" title="django.forms.FloatField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FloatField</span></code></a> 和 <a class="reference internal" href="../ref/forms/fields.html#django.forms.DecimalField" title="django.forms.DecimalField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DecimalField</span></code></a> 现在在验证过程中会尊重 <a class="reference internal" href="../ref/settings.html#std-setting-DECIMAL_SEPARATOR"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DECIMAL_SEPARATOR</span></code></a> 和 <a class="reference internal" href="../ref/settings.html#std-setting-THOUSAND_SEPARATOR"><code class="xref std std-setting docutils literal notranslate"><span class="pre">THOUSAND_SEPARATOR</span></code></a>。例如，使用以下设置：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">USE_L10N</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">USE_THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">DECIMAL_SEPARATOR</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span>
<span class="n">THOUSAND_SEPARATOR</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
</pre></div>
</div>
<p>输入值 <code class="docutils literal notranslate"><span class="pre">&quot;1.345&quot;</span></code> 现在被转换为 <code class="docutils literal notranslate"><span class="pre">1345</span></code>，而不是 <code class="docutils literal notranslate"><span class="pre">1.345</span></code>。</p>
</li>
<li><p class="first"><a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.models.AbstractBaseUser" title="django.contrib.auth.models.AbstractBaseUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractBaseUser</span></code></a> 的子类不再需要实现 <code class="docutils literal notranslate"><span class="pre">get_short_name()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">get_full_name()</span></code>。（已删除引发 <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code> 的基本实现。）如果实现了这些方法，<code class="docutils literal notranslate"><span class="pre">django.contrib.admin</span></code> 将使用它们，但不再要求它们。使用这些方法的第三方应用程序可能希望采用类似的方法。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">FIRST_DAY_OF_WEEK</span></code> 和 <code class="docutils literal notranslate"><span class="pre">NUMBER_GROUPING</span></code> 格式设置现在在 JavaScript 和 JSON i18n 视图输出中保持为整数。</p>
</li>
<li><p class="first"><a class="reference internal" href="../topics/testing/tools.html#django.test.TransactionTestCase.assertNumQueries" title="django.test.TransactionTestCase.assertNumQueries"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertNumQueries()</span></code></a> 现在忽略连接配置查询。以前，如果一个测试打开了一个新的数据库连接，那些查询可能会被包括在 <code class="docutils literal notranslate"><span class="pre">assertNumQueries()</span></code> 计数中。</p>
</li>
<li><p class="first">Oracle 测试表空间的默认大小从 20M 增加到 50M，自动扩展的默认大小从 10M 增加到 25M 。</p>
</li>
<li><p class="first">为了提高从数据库流式传输大型结果集的性能，<a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.iterator" title="django.db.models.query.QuerySet.iterator"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.iterator()</span></code></a> 现在一次获取 2000 行，而不是 100 行。可以使用 <code class="docutils literal notranslate"><span class="pre">chunk_size</span></code> 参数恢复旧的行为。例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">iterator</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">在 <a class="reference internal" href="../topics/i18n/translation.html#django.views.i18n.JavaScriptCatalog" title="django.views.i18n.JavaScriptCatalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code></a> 视图的 <code class="docutils literal notranslate"><span class="pre">packages</span></code> 参数中提供未知的包名称现在会引发 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>，而不是默默通过。</p>
</li>
<li><p class="first">现在，默认的 <code class="docutils literal notranslate"><span class="pre">Model.__str__()</span></code> 方法中会显示模型实例的主键，例如 <code class="docutils literal notranslate"><span class="pre">Question</span> <span class="pre">object</span> <span class="pre">(1)</span></code>。</p>
</li>
<li><p class="first">现在，<code class="docutils literal notranslate"><span class="pre">makemigrations</span></code> 会检测到模型字段的 <code class="docutils literal notranslate"><span class="pre">limit_choices_to</span></code> 选项的更改。请将其添加到现有的迁移中，或接受为使用它的字段生成的自动生成的迁移。</p>
</li>
<li><p class="first">在 MySQL 上执行需要 <a class="reference internal" href="../ref/contrib/gis/tutorial.html#automatic-spatial-transformations"><span class="std std-ref">自动空间转换</span></a> 的查询现在会引发 <code class="docutils literal notranslate"><span class="pre">NotImplementedError</span></code>，而不再默默地使用未经转换的几何图形。</p>
</li>
<li><p class="first">移除了 <code class="docutils literal notranslate"><span class="pre">django.core.exceptions.DjangoRuntimeWarning</span></code>。它只在缓存后端中用作 <code class="docutils literal notranslate"><span class="pre">CacheKeyWarning</span></code> 继承 <code class="docutils literal notranslate"><span class="pre">RuntimeWarning</span></code> 的中间类。</p>
</li>
<li><p class="first">将 <code class="docutils literal notranslate"><span class="pre">BaseExpression._output_field</span></code> 重命名为 <code class="docutils literal notranslate"><span class="pre">output_field</span></code>。您可能需要更新自定义表达式。</p>
</li>
<li><p class="first">在旧版本中，表单和表单集通过连接两者的 <code class="docutils literal notranslate"><span class="pre">Media</span></code> 来合并小部件的 <code class="docutils literal notranslate"><span class="pre">Media</span></code>。现在，合并尝试 <a class="reference internal" href="../topics/forms/media.html#form-media-asset-order"><span class="std std-ref">保持每个列表中元素的相对顺序</span></a>。如果无法保持顺序，将发出 <code class="docutils literal notranslate"><span class="pre">MediaOrderConflictWarning</span></code> 警告。</p>
</li>
<li><p class="first">移除了 <code class="docutils literal notranslate"><span class="pre">django.contrib.gis.gdal.OGRException</span></code>。自 Django 1.8 起，它一直是 <code class="docutils literal notranslate"><span class="pre">GDALException</span></code> 的别名。</p>
</li>
<li><p class="first">不再支持 GEOS 3.3.x 版本。</p>
</li>
<li><p class="first">选择 <code class="docutils literal notranslate"><span class="pre">GeometryField</span></code> 的数据的方式已更改以提高性能，在原始 SQL 查询中，现在必须将这些字段包装在 <code class="docutils literal notranslate"><span class="pre">connection.ops.select</span></code> 中。请参阅 GIS 教程中的 <a class="reference internal" href="../ref/contrib/gis/tutorial.html#gis-raw-sql"><span class="std std-ref">原始查询注意事项</span></a> 以获取示例。</p>
</li>
</ul>
</div>
</div>
<div class="section" id="s-features-deprecated-in-2-0">
<span id="s-deprecated-features-2-0"></span><span id="features-deprecated-in-2-0"></span><span id="deprecated-features-2-0"></span><h2>在 2.0 中被废弃的功能<a class="headerlink" href="#features-deprecated-in-2-0" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-context-argument-of-field-from-db-value-and-expression-convert-value">
<span id="context-argument-of-field-from-db-value-and-expression-convert-value"></span><h3><code class="docutils literal notranslate"><span class="pre">Field.from_db_value()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Expression.convert_value()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">context</span></code> 参数<a class="headerlink" href="#context-argument-of-field-from-db-value-and-expression-convert-value" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Field.from_db_value()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Expression.convert_value()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">context</span></code> 参数未被使用，因为它始终是一个空字典。现在这两个方法的签名是：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span>
</pre></div>
</div>
<p>替换成：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>对于自定义字段和表达式的旧签名，将继续支持直到 Django 3.0 版本。</p>
</div>
<div class="section" id="s-id1">
<span id="id1"></span><h3>杂项<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.db.backends.postgresql_psycopg2</span></code> 模块已被弃用，推荐使用 <code class="docutils literal notranslate"><span class="pre">django.db.backends.postgresql</span></code>。自 Django 1.9 起，它一直是一个别名。这仅影响直接从模块导入的代码。尽管如此，<code class="docutils literal notranslate"><span class="pre">DATABASES</span></code> 设置仍然可以使用 <code class="docutils literal notranslate"><span class="pre">'django.db.backends.postgresql_psycopg2'</span></code>，但您可以使用 Django 1.9 中添加的 <code class="docutils literal notranslate"><span class="pre">'django.db.backends.postgresql'</span></code> 名称来简化它。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.shortcuts.render_to_response()</span></code> 已被弃用，推荐使用 <a class="reference internal" href="../topics/http/shortcuts.html#django.shortcuts.render" title="django.shortcuts.render"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.shortcuts.render()</span></code></a>。<code class="docutils literal notranslate"><span class="pre">render()</span></code> 接受与之前相同的参数，只是现在需要传递一个 <code class="docutils literal notranslate"><span class="pre">request</span></code> 参数。</li>
<li><code class="docutils literal notranslate"><span class="pre">DEFAULT_CONTENT_TYPE</span></code> 设置已被弃用。它与第三方应用程序的兼容性不佳，并且自 HTML5 大多代替了 XHTML 后已过时。</li>
<li><code class="docutils literal notranslate"><span class="pre">HttpRequest.xreadlines()</span></code> 已被弃用，建议改为迭代请求对象。</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.earliest" title="django.db.models.query.QuerySet.earliest"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.earliest()</span></code></a> 和 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.latest" title="django.db.models.query.QuerySet.latest"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.latest()</span></code></a> 中的 <code class="docutils literal notranslate"><span class="pre">field_name</span></code> 关键字参数已被弃用，推荐将字段名称作为参数传递。请使用 <code class="docutils literal notranslate"><span class="pre">.earliest('pub_date')</span></code> 而不是 <code class="docutils literal notranslate"><span class="pre">.earliest(field_name='pub_date')</span></code>。</li>
</ul>
</div>
</div>
<div class="section" id="s-features-removed-in-2-0">
<span id="s-removed-features-2-0"></span><span id="features-removed-in-2-0"></span><span id="removed-features-2-0"></span><h2>在 2.0 版本中移除的功能<a class="headerlink" href="#features-removed-in-2-0" title="永久链接至标题">¶</a></h2>
<p>这些功能已经完成了废弃周期，并在 Django 2.0 中被移除。</p>
<p>有关这些更改的详细信息，包括如何删除对这些特性的使用，请参阅 <a class="reference internal" href="1.9.html#deprecated-features-1-9"><span class="std std-ref">在 1.9 中被废弃的功能</span></a>。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.dispatch.signals.Signal.disconnect()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">weak</span></code> 参数已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.db.backends.base.BaseDatabaseOperations.check_aggregate_support()</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.forms.extras</span></code> 包已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">assignment_tag</span></code> 辅助函数已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">SimpleTestCase.assertsRedirects()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">host</span></code> 参数已被移除。兼容性层也被移除，该层允许在路径相同时将绝对 URL 视为与相对 URL 相等。</li>
<li><code class="docutils literal notranslate"><span class="pre">Field.rel</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Field.remote_field.to</span></code> 已被移除。</li>
<li>在模型和迁移中，<code class="docutils literal notranslate"><span class="pre">ForeignKey</span></code> 和 <code class="docutils literal notranslate"><span class="pre">OneToOneField</span></code> 的 <code class="docutils literal notranslate"><span class="pre">on_delete</span></code> 参数现在是必需的。考虑合并迁移以减少需要更新的迁移数量。</li>
<li>移除了 <code class="docutils literal notranslate"><span class="pre">django.db.models.fields.add_lazy_relation()</span></code>。</li>
<li>启用时间区域支持时，不再在数据库后端不支持时间区域的情况下将感知的日期时间转换为 UTC 中的非感知值，当这样的值作为参数传递给 ORM 之外的 SQL 查询执行时（例如使用 <code class="docutils literal notranslate"><span class="pre">cursor.execute()</span></code>）。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.tests.utils.skipIfCustomUser()</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">GeoManager</span></code> 和 <code class="docutils literal notranslate"><span class="pre">GeoQuerySet</span></code> 类已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.geoip</span></code> 模块已被移除。</li>
<li>模板加载器的 <code class="docutils literal notranslate"><span class="pre">supports_recursion</span></code> 检查已从以下地方移除：<ul>
<li><code class="docutils literal notranslate"><span class="pre">django.template.engine.Engine.find_template()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loader_tags.ExtendsNode.find_template()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loaders.base.Loader.supports_recursion()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loaders.cached.Loader.supports_recursion()</span></code></li>
</ul>
</li>
<li>已移除 <code class="docutils literal notranslate"><span class="pre">load_template</span></code> 和 <code class="docutils literal notranslate"><span class="pre">load_template_sources</span></code> 模板加载器方法。</li>
<li>模板加载器的 <code class="docutils literal notranslate"><span class="pre">template_dirs</span></code> 参数已被移除：<ul>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loaders.base.Loader.get_template()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loaders.cached.Loader.cache_key()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loaders.cached.Loader.get_template()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loaders.cached.Loader.get_template_sources()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loaders.filesystem.Loader.get_template_sources()</span></code></li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loaders.base.Loader.__call__()</span></code> 已被移除。</li>
<li>不接受 <code class="docutils literal notranslate"><span class="pre">exception</span></code> 参数的自定义错误视图的支持已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.feedgenerator.Atom1Feed</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.utils.feedgenerator.RssFeed</span></code> 的 <code class="docutils literal notranslate"><span class="pre">mime_type</span></code> 属性已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">include()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">app_name</span></code> 参数已被移除。</li>
<li>不再支持将一个包含 <code class="docutils literal notranslate"><span class="pre">admin.site.urls</span></code> 的 3 元组作为 <code class="docutils literal notranslate"><span class="pre">include()</span></code> 的第一个参数。</li>
<li>不再支持在没有应用程序命名空间的情况下设置 URL 实例命名空间。</li>
<li><code class="docutils literal notranslate"><span class="pre">Field._get_val_from_obj()</span></code> 已被移除。</li>
<li>移除了 <code class="docutils literal notranslate"><span class="pre">django.template.loaders.eggs.Loader</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">contrib.auth</span></code> 函数式视图的 <code class="docutils literal notranslate"><span class="pre">current_app</span></code> 参数已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">SimpleTestCase.assertRaisesMessage()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">callable_obj</span></code> 关键字参数已被移除。</li>
<li>不再支持在 <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> 方法上的 <code class="docutils literal notranslate"><span class="pre">allow_tags</span></code> 属性。</li>
<li><code class="docutils literal notranslate"><span class="pre">SyndicationFeed.add_item()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">enclosure</span></code> 关键字参数已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.template.loader.LoaderOrigin</span></code> 和 <code class="docutils literal notranslate"><span class="pre">django.template.base.StringOrigin</span></code> 别名已被移除，对应的是 <code class="docutils literal notranslate"><span class="pre">django.template.base.Origin</span></code>。</li>
</ul>
<p>请参阅 <a class="reference internal" href="1.10.html#deprecated-features-1-10"><span class="std std-ref">在 1.10 中被废弃的功能</span></a> 以获取有关这些更改的详细信息。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">makemigrations</span> <span class="pre">--exit</span></code> 选项已被移除。</li>
<li>不再支持直接对反向外键或多对多关系进行赋值。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.geos.GEOSGeometry</span></code> 的 <code class="docutils literal notranslate"><span class="pre">get_srid()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">set_srid()</span></code> 方法已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.geos.Point</span></code> 的 <code class="docutils literal notranslate"><span class="pre">get_x()</span></code>, <code class="docutils literal notranslate"><span class="pre">set_x()</span></code>, <code class="docutils literal notranslate"><span class="pre">get_y()</span></code>, <code class="docutils literal notranslate"><span class="pre">set_y()</span></code>, <code class="docutils literal notranslate"><span class="pre">get_z()</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">set_z()</span></code> 方法已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.geos.Point</span></code> 的 <code class="docutils literal notranslate"><span class="pre">get_coords()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">set_coords()</span></code> 方法已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.geos.MultiPolygon</span></code> 的 <code class="docutils literal notranslate"><span class="pre">cascaded_union</span></code> 属性已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.functional.allow_lazy()</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">shell</span> <span class="pre">--plain</span></code> 选项已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.core.urlresolvers</span></code> 模块已被移除，现在请使用其新位置 <code class="docutils literal notranslate"><span class="pre">django.urls</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">CommaSeparatedIntegerField</span></code> 已被移除，除了对历史迁移的支持外。</li>
<li>模板 <code class="docutils literal notranslate"><span class="pre">Context.has_key()</span></code> 方法已被移除。</li>
<li>对于 <code class="docutils literal notranslate"><span class="pre">django.core.files.storage.Storage.accessed_time()</span></code>, <code class="docutils literal notranslate"><span class="pre">created_time()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">modified_time()</span></code> 方法的支持已被移除。</li>
<li>当设置了 <code class="docutils literal notranslate"><span class="pre">Meta.default_related_name</span></code> 时，不再支持使用模型名称进行查询查找。</li>
<li>MySQL 中的 <code class="docutils literal notranslate"><span class="pre">__search</span></code> 查找已被移除。</li>
<li>移除了支持自定义相关管理器类但没有 <code class="docutils literal notranslate"><span class="pre">_apply_rel_filters()</span></code> 方法的 shim。</li>
<li>不再支持将 <code class="docutils literal notranslate"><span class="pre">User.is_authenticated()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">User.is_anonymous()</span></code> 作为方法使用，而不是属性。</li>
<li><code class="docutils literal notranslate"><span class="pre">Model._meta.virtual_fields</span></code> 属性已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">Field.contribute_to_class()</span></code> 中的关键字参数 <code class="docutils literal notranslate"><span class="pre">virtual_only</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Model._meta.add_field()</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">virtual</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">javascript_catalog()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">json_catalog()</span></code> 视图已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.gis.utils.precision_wkt()</span></code> 已被移除。</li>
<li>在多表继承中，不再隐式将 <code class="docutils literal notranslate"><span class="pre">OneToOneField</span></code> 提升为 <code class="docutils literal notranslate"><span class="pre">parent_link</span></code>。</li>
<li>不再支持 <code class="docutils literal notranslate"><span class="pre">Widget._format_value()</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">FileField</span></code> 的方法 <code class="docutils literal notranslate"><span class="pre">get_directory_name()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">get_filename()</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">mark_for_escaping()</span></code> 函数以及它使用的类：<code class="docutils literal notranslate"><span class="pre">EscapeData</span></code>、<code class="docutils literal notranslate"><span class="pre">EscapeBytes</span></code>、<code class="docutils literal notranslate"><span class="pre">EscapeText</span></code>、<code class="docutils literal notranslate"><span class="pre">EscapeString</span></code> 和 <code class="docutils literal notranslate"><span class="pre">EscapeUnicode</span></code> 都已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">escape</span></code> 过滤器现在使用 <code class="docutils literal notranslate"><span class="pre">django.utils.html.conditional_escape()</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">Manager.use_for_related_fields</span></code> 已被移除。</li>
<li>模型的 <code class="docutils literal notranslate"><span class="pre">Manager</span></code> 继承遵循 MRO 继承规则。不再需要使用 <code class="docutils literal notranslate"><span class="pre">Meta.manager_inheritance_from_future</span></code> 来选择使用这种行为。</li>
<li>不再支持使用 <code class="docutils literal notranslate"><span class="pre">settings.MIDDLEWARE_CLASSES</span></code> 的老式中间件。</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Django 2.0 版本发行说明</a><ul>
<li><a class="reference internal" href="#python-compatibility">Python 兼容性</a></li>
<li><a class="reference internal" href="#third-party-library-support-for-older-version-of-django">对于较旧版本的 Django 的第三方库支持</a></li>
<li><a class="reference internal" href="#what-s-new-in-django-2-0">Django 2.0 新特性</a><ul>
<li><a class="reference internal" href="#simplified-url-routing-syntax">简化 URL 路由语法</a></li>
<li><a class="reference internal" href="#mobile-friendly-contrib-admin"><code class="docutils literal notranslate"><span class="pre">contrib.admin</span></code> 针对移动设备的优化改进</a></li>
<li><a class="reference internal" href="#window-expressions">Window 表达式</a></li>
<li><a class="reference internal" href="#minor-features">次要特性</a><ul>
<li><a class="reference internal" href="#django-contrib-admin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-auth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-gis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-postgres"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sitemaps"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sitemaps</span></code></a></li>
<li><a class="reference internal" href="#cache">缓存</a></li>
<li><a class="reference internal" href="#file-storage">文件存储</a></li>
<li><a class="reference internal" href="#forms">表单</a></li>
<li><a class="reference internal" href="#generic-views">通用视图</a></li>
<li><a class="reference internal" href="#management-commands">管理命令</a></li>
<li><a class="reference internal" href="#migrations">迁移</a></li>
<li><a class="reference internal" href="#models">模型</a></li>
<li><a class="reference internal" href="#pagination">分页</a></li>
<li><a class="reference internal" href="#requests-and-responses">请求和响应</a></li>
<li><a class="reference internal" href="#templates">模板</a></li>
<li><a class="reference internal" href="#tests">测试</a></li>
<li><a class="reference internal" href="#validators">验证器</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-incompatible-changes-in-2-0">2.0 版本的不向后兼容变更</a><ul>
<li><a class="reference internal" href="#removed-support-for-bytestrings-in-some-places">在某些地方移除了对字节字符串的支持</a></li>
<li><a class="reference internal" href="#database-backend-api">数据库后端 API</a></li>
<li><a class="reference internal" href="#dropped-support-for-oracle-11-2">不再支持 Oracle 11.2</a></li>
<li><a class="reference internal" href="#default-mysql-isolation-level-is-read-committed">默认的 MySQL 隔离级别为读已提交（read committed）</a></li>
<li><a class="reference internal" href="#abstractuser-last-name-max-length-increased-to-150"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AbstractUser.last_name</span></code> 的 <code class="docutils literal notranslate"><span class="pre">max_length</span></code> 增加到了 150。</a></li>
<li><a class="reference internal" href="#queryset-reverse-and-last-are-prohibited-after-slicing">在切片之后，禁止使用 <code class="docutils literal notranslate"><span class="pre">QuerySet.reverse()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">last()</span></code>。</a></li>
<li><a class="reference internal" href="#form-fields-no-longer-accept-optional-arguments-as-positional-arguments">表单字段不再将可选参数作为位置参数接受</a></li>
<li><a class="reference internal" href="#call-command-validates-the-options-it-receives"><code class="docutils literal notranslate"><span class="pre">call_command()</span></code> 验证它接收到的选项</a></li>
<li><a class="reference internal" href="#indexes-no-longer-accept-positional-arguments">索引不再接受位置参数</a></li>
<li><a class="reference internal" href="#foreign-key-constraints-are-now-enabled-on-sqlite">现在在 SQLite 上启用了外键约束（Foreign key constraints）</a></li>
<li><a class="reference internal" href="#miscellaneous">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-deprecated-in-2-0">在 2.0 中被废弃的功能</a><ul>
<li><a class="reference internal" href="#context-argument-of-field-from-db-value-and-expression-convert-value"><code class="docutils literal notranslate"><span class="pre">Field.from_db_value()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Expression.convert_value()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">context</span></code> 参数</a></li>
<li><a class="reference internal" href="#id1">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-removed-in-2-0">在 2.0 版本中移除的功能</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="2.0.1.html"
                          title="上一章">Django 2.0.1 版本发行说明</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="1.11.29.html"
                          title="下一章">Django 1.11.29 版本发行说明</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/releases/2.0.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">2月 21, 2024</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="2.0.1.html" title="Django 2.0.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="1.11.29.html" title="Django 1.11.29 版本发行说明">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>