
<!DOCTYPE html>

<html lang="zh_Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Django 3.0 版本发行说明 &#8212; Django 5.0.3.dev20240221071519 文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Django 2.2.28 版本发行说明" href="2.2.28.html" />
    <link rel="prev" title="Django 3.0.1 版本发行说明" href="3.0.1.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 5.0.3.dev20240221071519 文档</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="3.0.1.html" title="Django 3.0.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="2.2.28.html" title="Django 2.2.28 版本发行说明">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="releases-3.0">
            
  <div class="section" id="s-django-3-0-release-notes">
<span id="django-3-0-release-notes"></span><h1>Django 3.0 版本发行说明<a class="headerlink" href="#django-3-0-release-notes" title="永久链接至标题">¶</a></h1>
<p><em>2019 年 12 月 2 日</em></p>
<p>欢迎使用 Django 3.0 ！</p>
<p>这些发行说明涵盖了 <a class="reference internal" href="#whats-new-3-0"><span class="std std-ref">新功能</span></a>，以及一些 <a class="reference internal" href="#backwards-incompatible-3-0"><span class="std std-ref">不兼容的变化</span></a>，当您从 Django 2.2 或更早版本升级时需要注意。我们已经 <a class="reference internal" href="#removed-features-3-0"><span class="std std-ref">删除了一些已经完成了其弃用周期的功能</span></a>，并且我们已经 <a class="reference internal" href="#deprecated-features-3-0"><span class="std std-ref">开始了一些功能的弃用过程</span></a>。</p>
<p>如果你要更新现有的项目，请看 <a class="reference internal" href="../howto/upgrade-version.html"><span class="doc">如何将 Django 更新至新的版本</span></a> 指南。</p>
<div class="section" id="s-python-compatibility">
<span id="python-compatibility"></span><h2>Python 兼容性<a class="headerlink" href="#python-compatibility" title="永久链接至标题">¶</a></h2>
<p>Django 3.0 支持 Python 3.6、3.7、3.8 和 3.9（截至 3.0.11 版）。我们 <strong>强烈推荐</strong> 并且只官方支持每个系列的最新版本。</p>
<p>Django 2.2.x 系列是最后一个支持 Python 3.5 的版本。</p>
</div>
<div class="section" id="s-third-party-library-support-for-older-version-of-django">
<span id="third-party-library-support-for-older-version-of-django"></span><h2>对于较旧版本的 Django 的第三方库支持<a class="headerlink" href="#third-party-library-support-for-older-version-of-django" title="永久链接至标题">¶</a></h2>
<p>在发布 Django 3.0 后，我们建议第三方应用程序作者停止支持 Django 2.2 之前的所有版本。在那个时候，您应该能够使用 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-Wd</span></code> 运行您包的测试，以便看到弃用警告。在进行弃用警告修复后，您的应用程序应该与 Django 3.0 兼容。</p>
</div>
<div class="section" id="s-what-s-new-in-django-3-0">
<span id="s-whats-new-3-0"></span><span id="what-s-new-in-django-3-0"></span><span id="whats-new-3-0"></span><h2>Django 3.0 新特性<a class="headerlink" href="#what-s-new-in-django-3-0" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-mariadb-support">
<span id="mariadb-support"></span><h3>MariaDB 支持<a class="headerlink" href="#mariadb-support" title="永久链接至标题">¶</a></h3>
<p>Django 现在正式支持 <a class="reference external" href="https://mariadb.org/">MariaDB</a> 10.1 及更高版本。更多详情请参阅 <a class="reference internal" href="../ref/databases.html#mariadb-notes"><span class="std std-ref">MariaDB 注意事项</span></a>。</p>
</div>
<div class="section" id="s-asgi-support">
<span id="asgi-support"></span><h3>ASGI 支持<a class="headerlink" href="#asgi-support" title="永久链接至标题">¶</a></h3>
<p>Django 3.0 开始了我们使 Django 完全支持异步的旅程，通过提供作为 <a class="reference external" href="https://asgi.readthedocs.io/">ASGI</a> 应用程序运行的支持。</p>
<p>这是在我们现有的 WSGI 支持之外的补充。 Django 计划在可预见的未来同时支持两者。然而，异步功能只适用于在 ASGI 下运行的应用程序。</p>
<p>在当前阶段，异步支持仅适用于外部 ASGI 应用程序。内部的所有内容仍然是同步的。异步中间件、视图等尚不受支持。但是，您可以在 Django 应用程序周围使用 ASGI 中间件，从而可以将 Django 与其他 ASGI 框架结合使用。</p>
<p>除非您想开始尝试异步代码，否则没有必要切换您的应用程序，但如果您想了解更多信息，我们有关于使用 ASGI 部署的 <a class="reference internal" href="../howto/deployment/asgi/index.html"><span class="doc">文档</span></a>。</p>
<p>请注意，由于这个改变的副作用，Django 现在可以识别异步事件循环，并会阻止您从异步上下文中调用标记为 &quot;async unsafe&quot; 的代码，比如 ORM 操作。如果您以前从异步代码中使用 Django，那么如果使用不正确，这可能会触发问题。如果看到 <code class="docutils literal notranslate"><span class="pre">SynchronousOnlyOperation</span></code> 错误，请仔细检查您的代码，并将任何数据库操作移动到同步的子线程中。</p>
</div>
<div class="section" id="s-exclusion-constraints-on-postgresql">
<span id="exclusion-constraints-on-postgresql"></span><h3>PostgreSQL 上的排除约束<a class="headerlink" href="#exclusion-constraints-on-postgresql" title="永久链接至标题">¶</a></h3>
<p>新的 <a class="reference internal" href="../ref/contrib/postgres/constraints.html#django.contrib.postgres.constraints.ExclusionConstraint" title="django.contrib.postgres.constraints.ExclusionConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExclusionConstraint</span></code></a> 类允许在 PostgreSQL 上添加排除约束。约束通过在模型中使用 <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.constraints" title="django.db.models.Options.constraints"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.constraints</span></code></a> 选项来添加。</p>
</div>
<div class="section" id="s-filter-expressions">
<span id="filter-expressions"></span><h3>过滤表达式<a class="headerlink" href="#filter-expressions" title="永久链接至标题">¶</a></h3>
<p>现在可以直接在 <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> 过滤器中使用输出 <a class="reference internal" href="../ref/models/fields.html#django.db.models.BooleanField" title="django.db.models.BooleanField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BooleanField</span></code></a> 的表达式，而不需要首先注释然后对注释进行过滤。</p>
</div>
<div class="section" id="s-enumerations-for-model-field-choices">
<span id="enumerations-for-model-field-choices"></span><h3>模型字段选择的枚举类型<a class="headerlink" href="#enumerations-for-model-field-choices" title="永久链接至标题">¶</a></h3>
<p>现在可以使用自定义枚举类型 <code class="docutils literal notranslate"><span class="pre">TextChoices</span></code>、<code class="docutils literal notranslate"><span class="pre">IntegerChoices</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Choices</span></code> 来定义 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.choices" title="django.db.models.Field.choices"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Field.choices</span></code></a>。<code class="docutils literal notranslate"><span class="pre">TextChoices</span></code> 和 <code class="docutils literal notranslate"><span class="pre">IntegerChoices</span></code> 类型用于文本和整数字段。<code class="docutils literal notranslate"><span class="pre">Choices</span></code> 类允许为其他具体数据类型定义兼容的枚举。这些自定义枚举类型支持可翻译的人类可读标签，并可以通过枚举或其成员的属性来访问。有关更多详细信息和示例，请参阅 <a class="reference internal" href="../ref/models/fields.html#field-choices-enum-types"><span class="std std-ref">枚举类型</span></a>。</p>
</div>
<div class="section" id="s-minor-features">
<span id="minor-features"></span><h3>次要特性<a class="headerlink" href="#minor-features" title="永久链接至标题">¶</a></h3>
<div class="section" id="s-django-contrib-admin">
<span id="django-contrib-admin"></span><h4><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#django-contrib-admin" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.list_display" title="django.contrib.admin.ModelAdmin.list_display"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.list_display</span></code></a> 中的属性上添加了对 <code class="docutils literal notranslate"><span class="pre">admin_order_field</span></code> 属性的支持。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.get_inlines" title="django.contrib.admin.ModelAdmin.get_inlines"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModelAdmin.get_inlines()</span></code></a> 方法允许根据请求或模型实例来指定内联。</li>
<li>Select2 库的版本已从 4.0.3 升级到 4.0.7 。</li>
<li>jQuery 的版本已从 3.3.1 升级到 3.4.1 。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-auth">
<span id="django-contrib-auth"></span><h4><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a><a class="headerlink" href="#django-contrib-auth" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.views.PasswordResetConfirmView" title="django.contrib.auth.views.PasswordResetConfirmView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetConfirmView</span></code></a> 中新增了 <code class="docutils literal notranslate"><span class="pre">reset_url_token</span></code> 属性，允许指定作为密码重置 URL 组件显示的令牌参数。</li>
<li>添加了 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.BaseBackend" title="django.contrib.auth.backends.BaseBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseBackend</span></code></a> 类，以便更容易自定义身份验证后端。</li>
<li>添加了 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User.get_user_permissions" title="django.contrib.auth.models.User.get_user_permissions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_user_permissions()</span></code></a> 方法，以对应现有的 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.User.get_group_permissions" title="django.contrib.auth.models.User.get_group_permissions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_group_permissions()</span></code></a> 方法。</li>
<li>在 <a class="reference internal" href="../topics/auth/default.html#module-django.contrib.auth.forms" title="django.contrib.auth.forms"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth.forms</span></code></a> 中的用户名、电子邮件和密码字段的小部件中添加了 HTML <code class="docutils literal notranslate"><span class="pre">autocomplete</span></code> 属性，以更好地与浏览器密码管理器交互。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-createsuperuser"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">createsuperuser</span></code></a> 现在在非交互模式下，当没有提供相应的命令行参数时，会回退到环境变量来获取密码和必填字段。</li>
<li><a class="reference internal" href="../topics/auth/customizing.html#django.contrib.auth.models.CustomUser.REQUIRED_FIELDS" title="django.contrib.auth.models.CustomUser.REQUIRED_FIELDS"><code class="xref py py-attr docutils literal notranslate"><span class="pre">REQUIRED_FIELDS</span></code></a> 现在支持 <a class="reference internal" href="../ref/models/fields.html#django.db.models.ManyToManyField" title="django.db.models.ManyToManyField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManyToManyField</span></code></a>。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.UserManager.with_perm" title="django.contrib.auth.models.UserManager.with_perm"><code class="xref py py-meth docutils literal notranslate"><span class="pre">UserManager.with_perm()</span></code></a> 方法返回具有指定权限的用户。</li>
<li>PBKDF2 密码哈希器的默认迭代次数从 150 , 000 增加到 180 , 000 。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-gis">
<span id="django-contrib-gis"></span><h4><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#django-contrib-gis" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>允许 MySQL 空间查询函数在真实几何对象上操作。之前的支持仅限于边界框。</li>
<li>添加了 <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.GeometryDistance" title="django.contrib.gis.db.models.functions.GeometryDistance"><code class="xref py py-class docutils literal notranslate"><span class="pre">GeometryDistance</span></code></a> 函数，在 PostGIS 上支持。</li>
<li>在 <a class="reference internal" href="../ref/contrib/gis/measure.html#django.contrib.gis.measure.Distance" title="django.contrib.gis.measure.Distance"><code class="xref py py-class docutils literal notranslate"><span class="pre">Distance</span></code></a> 中添加了对 <code class="docutils literal notranslate"><span class="pre">furlong</span></code> 单位的支持。</li>
<li><a class="reference internal" href="../ref/contrib/gis/geoip2.html#std-setting-GEOIP_PATH"><code class="xref std std-setting docutils literal notranslate"><span class="pre">GEOIP_PATH</span></code></a> 设置现在支持 <a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a>。</li>
<li><a class="reference internal" href="../ref/contrib/gis/geoip2.html#django.contrib.gis.geoip2.GeoIP2" title="django.contrib.gis.geoip2.GeoIP2"><code class="xref py py-class docutils literal notranslate"><span class="pre">GeoIP2</span></code></a> 类现在接受 <a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">path</span></code>。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-postgres">
<span id="django-contrib-postgres"></span><h4><a class="reference internal" href="../ref/contrib/postgres/index.html#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a><a class="headerlink" href="#django-contrib-postgres" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/contrib/postgres/fields.html#django.contrib.postgres.fields.RangeOperators" title="django.contrib.postgres.fields.RangeOperators"><code class="xref py py-class docutils literal notranslate"><span class="pre">RangeOperators</span></code></a> 有助于避免在可以与 <a class="reference internal" href="../ref/contrib/postgres/fields.html#django.contrib.postgres.fields.RangeField" title="django.contrib.postgres.fields.RangeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">RangeField</span></code></a> 一起使用的 SQL 运算符中出现拼写错误。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/postgres/fields.html#django.contrib.postgres.fields.RangeBoundary" title="django.contrib.postgres.fields.RangeBoundary"><code class="xref py py-class docutils literal notranslate"><span class="pre">RangeBoundary</span></code></a> 表达式表示范围的边界。</li>
<li>新的 <a class="reference internal" href="../ref/contrib/postgres/operations.html#django.contrib.postgres.operations.AddIndexConcurrently" title="django.contrib.postgres.operations.AddIndexConcurrently"><code class="xref py py-class docutils literal notranslate"><span class="pre">AddIndexConcurrently</span></code></a> 和 <a class="reference internal" href="../ref/contrib/postgres/operations.html#django.contrib.postgres.operations.RemoveIndexConcurrently" title="django.contrib.postgres.operations.RemoveIndexConcurrently"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoveIndexConcurrently</span></code></a> 类允许在 PostgreSQL 上使用 <code class="docutils literal notranslate"><span class="pre">CONCURRENTLY</span></code> 创建和删除索引。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sessions">
<span id="django-contrib-sessions"></span><h4><a class="reference internal" href="../topics/http/sessions.html#module-django.contrib.sessions" title="django.contrib.sessions: Provides session management for Django projects."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a><a class="headerlink" href="#django-contrib-sessions" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../topics/http/sessions.html#django.contrib.sessions.backends.base.SessionBase.get_session_cookie_age" title="django.contrib.sessions.backends.base.SessionBase.get_session_cookie_age"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_session_cookie_age()</span></code></a> 方法允许动态指定会话 cookie 的过期时间。</li>
</ul>
</div>
<div class="section" id="s-django-contrib-syndication">
<span id="django-contrib-syndication"></span><h4><a class="reference internal" href="../ref/contrib/syndication.html#module-django.contrib.syndication" title="django.contrib.syndication: A framework for generating syndication feeds, in RSS and Atom, quite easily."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.syndication</span></code></a><a class="headerlink" href="#django-contrib-syndication" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>在 <a class="reference internal" href="../ref/contrib/syndication.html#django.contrib.syndication.views.Feed" title="django.contrib.syndication.views.Feed"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.contrib.syndication.views.Feed</span></code></a> 中添加了 <code class="docutils literal notranslate"><span class="pre">language</span></code> 类属性，以自定义 feed 的语言。默认值是 <a class="reference internal" href="../ref/utils.html#django.utils.translation.get_language" title="django.utils.translation.get_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_language()</span></code></a>，而不是 <a class="reference internal" href="../ref/settings.html#std-setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a>。</li>
</ul>
</div>
<div class="section" id="s-cache">
<span id="cache"></span><h4>缓存<a class="headerlink" href="#cache" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/utils.html#django.utils.cache.add_never_cache_headers" title="django.utils.cache.add_never_cache_headers"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_never_cache_headers()</span></code></a> 和 <a class="reference internal" href="../topics/http/decorators.html#django.views.decorators.cache.never_cache" title="django.views.decorators.cache.never_cache"><code class="xref py py-func docutils literal notranslate"><span class="pre">never_cache()</span></code></a> 现在在 <code class="docutils literal notranslate"><span class="pre">Cache-Control</span></code> 头中添加了 <code class="docutils literal notranslate"><span class="pre">private</span></code> 指令。</li>
</ul>
</div>
<div class="section" id="s-file-storage">
<span id="file-storage"></span><h4>文件存储<a class="headerlink" href="#file-storage" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.Storage.get_alternative_name" title="django.core.files.storage.Storage.get_alternative_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Storage.get_alternative_name()</span></code></a> 方法允许自定义生成文件名的算法，如果已经存在具有上传名称的文件。</li>
</ul>
</div>
<div class="section" id="s-forms">
<span id="forms"></span><h4>表单<a class="headerlink" href="#forms" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>通过设置 <a class="reference internal" href="../topics/forms/formsets.html#django.forms.formsets.BaseFormSet.ordering_widget" title="django.forms.formsets.BaseFormSet.ordering_widget"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ordering_widget</span></code></a> 属性或覆盖 <a class="reference internal" href="../topics/forms/formsets.html#django.forms.formsets.BaseFormSet.get_ordering_widget" title="django.forms.formsets.BaseFormSet.get_ordering_widget"><code class="xref py py-attr docutils literal notranslate"><span class="pre">get_ordering_widget()</span></code></a>，表单集合可以控制在通过 <a class="reference internal" href="../topics/forms/formsets.html#django.forms.formsets.BaseFormSet.can_order" title="django.forms.formsets.BaseFormSet.can_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_order</span></code></a> 排序表单时使用的小部件。</li>
</ul>
</div>
<div class="section" id="s-internationalization">
<span id="internationalization"></span><h4>国际化<a class="headerlink" href="#internationalization" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>添加了 <a class="reference internal" href="../ref/settings.html#std-setting-LANGUAGE_COOKIE_HTTPONLY"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_HTTPONLY</span></code></a>、<a class="reference internal" href="../ref/settings.html#std-setting-LANGUAGE_COOKIE_SAMESITE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_SAMESITE</span></code></a> 和 <a class="reference internal" href="../ref/settings.html#std-setting-LANGUAGE_COOKIE_SECURE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_SECURE</span></code></a> 设置，用于在语言 cookie 上设置 <code class="docutils literal notranslate"><span class="pre">HttpOnly</span></code>、<code class="docutils literal notranslate"><span class="pre">SameSite</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Secure</span></code> 标志。这些设置的默认值保留了以前的行为。</li>
<li>增加了对乌兹别克语的支持和翻译。</li>
</ul>
</div>
<div class="section" id="s-logging">
<span id="logging"></span><h4>日志<a class="headerlink" href="#logging" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/logging.html#django.utils.log.AdminEmailHandler" title="django.utils.log.AdminEmailHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">AdminEmailHandler</span></code></a> 的新参数 <code class="docutils literal notranslate"><span class="pre">reporter_class</span></code> 允许提供一个 <code class="docutils literal notranslate"><span class="pre">django.views.debug.ExceptionReporter</span></code> 的子类，以自定义在 <a class="reference internal" href="../ref/settings.html#std-setting-DEBUG"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEBUG</span></code></a> 为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 时发送给站点 <a class="reference internal" href="../ref/settings.html#std-setting-ADMINS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">ADMINS</span></code></a> 的异常回溯文本。</li>
</ul>
</div>
<div class="section" id="s-management-commands">
<span id="management-commands"></span><h4>管理命令<a class="headerlink" href="#management-commands" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-compilemessages-ignore"><code class="xref std std-option docutils literal notranslate"><span class="pre">compilemessages</span> <span class="pre">--ignore</span></code></a> 选项允许在搜索要编译的 <code class="docutils literal notranslate"><span class="pre">.po</span></code> 文件时忽略特定目录。</li>
<li><a class="reference internal" href="../ref/django-admin.html#cmdoption-showmigrations-list"><code class="xref std std-option docutils literal notranslate"><span class="pre">showmigrations</span> <span class="pre">--list</span></code></a> 在 <code class="docutils literal notranslate"><span class="pre">--verbosity</span></code> 为 2 及以上时现在会显示已应用的日期时间。</li>
<li>在 PostgreSQL 上，<a class="reference internal" href="../ref/django-admin.html#django-admin-dbshell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">dbshell</span></code></a> 现在支持客户端端的 TLS 证书。</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-inspectdb"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">inspectdb</span></code></a> 现在在外键具有唯一或主键约束时会检查 <a class="reference internal" href="../ref/models/fields.html#django.db.models.OneToOneField" title="django.db.models.OneToOneField"><code class="xref py py-class docutils literal notranslate"><span class="pre">OneToOneField</span></code></a>。</li>
<li>新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-skip-checks"><code class="xref std std-option docutils literal notranslate"><span class="pre">--skip-checks</span></code></a> 选项在运行命令之前跳过运行系统检查。</li>
<li><a class="reference internal" href="../ref/django-admin.html#cmdoption-startapp-template"><code class="xref std std-option docutils literal notranslate"><span class="pre">startapp</span> <span class="pre">--template</span></code></a> 和 <a class="reference internal" href="../ref/django-admin.html#cmdoption-startproject-template"><code class="xref std std-option docutils literal notranslate"><span class="pre">startproject</span> <span class="pre">--template</span></code></a> 选项现在支持存储在 XZ 存档（<code class="docutils literal notranslate"><span class="pre">.tar.xz</span></code>、<code class="docutils literal notranslate"><span class="pre">.txz</span></code>）和 LZMA 存档（<code class="docutils literal notranslate"><span class="pre">.tar.lzma</span></code>、<code class="docutils literal notranslate"><span class="pre">.tlz</span></code>）中的模板。</li>
</ul>
</div>
<div class="section" id="s-models">
<span id="models"></span><h4>模型<a class="headerlink" href="#models" title="永久链接至标题">¶</a></h4>
<ul>
<li><p class="first">添加了哈希数据库函数 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.MD5" title="django.db.models.functions.MD5"><code class="xref py py-class docutils literal notranslate"><span class="pre">MD5</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.SHA1" title="django.db.models.functions.SHA1"><code class="xref py py-class docutils literal notranslate"><span class="pre">SHA1</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.SHA224" title="django.db.models.functions.SHA224"><code class="xref py py-class docutils literal notranslate"><span class="pre">SHA224</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.SHA256" title="django.db.models.functions.SHA256"><code class="xref py py-class docutils literal notranslate"><span class="pre">SHA256</span></code></a>、<a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.SHA384" title="django.db.models.functions.SHA384"><code class="xref py py-class docutils literal notranslate"><span class="pre">SHA384</span></code></a> 和 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.SHA512" title="django.db.models.functions.SHA512"><code class="xref py py-class docutils literal notranslate"><span class="pre">SHA512</span></code></a>。</p>
</li>
<li><p class="first">添加了 <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Sign" title="django.db.models.functions.Sign"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sign</span></code></a> 数据库函数。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Trunc" title="django.db.models.functions.Trunc"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trunc</span></code></a> 数据库函数的新参数 <code class="docutils literal notranslate"><span class="pre">is_dst</span></code> 决定了不存在和模糊的日期时间的处理方式。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">connection.queries</span></code> 现在在 PostgreSQL 上显示 <code class="docutils literal notranslate"><span class="pre">COPY</span> <span class="pre">…</span> <span class="pre">TO</span></code> 语句。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/models/fields.html#django.db.models.FilePathField" title="django.db.models.FilePathField"><code class="xref py py-class docutils literal notranslate"><span class="pre">FilePathField</span></code></a> 现在接受可调用对象作为 <code class="docutils literal notranslate"><span class="pre">path</span></code>。</p>
</li>
<li><p class="first">允许自引用 <a class="reference internal" href="../ref/models/fields.html#django.db.models.ManyToManyField" title="django.db.models.ManyToManyField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManyToManyField</span></code></a> 的对称中间表。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/models/constraints.html#django.db.models.CheckConstraint" title="django.db.models.CheckConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">CheckConstraint</span></code></a>、<a class="reference internal" href="../ref/models/constraints.html#django.db.models.UniqueConstraint" title="django.db.models.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint</span></code></a> 和 <a class="reference internal" href="../ref/models/indexes.html#django.db.models.Index" title="django.db.models.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">name</span></code> 属性现在支持使用 <code class="docutils literal notranslate"><span class="pre">'%(app_label)s'</span></code> 和 <code class="docutils literal notranslate"><span class="pre">'%(class)s'</span></code> 占位符进行应用标签和类插值。</p>
</li>
<li><p class="first">新的 <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.descriptor_class" title="django.db.models.Field.descriptor_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Field.descriptor_class</span></code></a> 属性允许模型字段通过重写它们的 <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#descriptors" title="(在 Python v3.12)"><span class="xref std std-ref">描述符</span></a> 来自定义获取和设置行为。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/models/querysets.html#django.db.models.Avg" title="django.db.models.Avg"><code class="xref py py-class docutils literal notranslate"><span class="pre">Avg</span></code></a> 和 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.Sum" title="django.db.models.Sum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sum</span></code></a> 现在支持 <code class="docutils literal notranslate"><span class="pre">distinct</span></code> 参数。</p>
</li>
<li><p class="first">添加了 <a class="reference internal" href="../ref/models/fields.html#django.db.models.SmallAutoField" title="django.db.models.SmallAutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">SmallAutoField</span></code></a>，它的行为类似于 <a class="reference internal" href="../ref/models/fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a>，但它只允许在某个（与数据库相关的）限制内的值。在Django支持的所有数据库中，值从 <code class="docutils literal notranslate"><span class="pre">1</span></code> 到 <code class="docutils literal notranslate"><span class="pre">32767</span></code> 都是安全的。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/models/fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a>、<a class="reference internal" href="../ref/models/fields.html#django.db.models.BigAutoField" title="django.db.models.BigAutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">BigAutoField</span></code></a> 和 <a class="reference internal" href="../ref/models/fields.html#django.db.models.SmallAutoField" title="django.db.models.SmallAutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">SmallAutoField</span></code></a> 现在分别继承自 <code class="docutils literal notranslate"><span class="pre">IntegerField</span></code>、<code class="docutils literal notranslate"><span class="pre">BigIntegerField</span></code> 和 <code class="docutils literal notranslate"><span class="pre">SmallIntegerField</span></code>。系统检查和验证器现在也会正确继承。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/models/fields.html#django.db.models.FileField.upload_to" title="django.db.models.FileField.upload_to"><code class="xref py py-attr docutils literal notranslate"><span class="pre">FileField.upload_to</span></code></a> 现在支持 <a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a>。</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/models/constraints.html#django.db.models.CheckConstraint" title="django.db.models.CheckConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">CheckConstraint</span></code></a> 现在在 MySQL 8.0.16+ 上受支持。</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">django.db.backends.base.BaseDatabaseFeatures</span></code> 的新方法 <code class="docutils literal notranslate"><span class="pre">allows_group_by_selected_pks_on_model()</span></code> 允许优化 <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> 子句，只需要选定的模型主键。默认情况下，它仅在 PostgreSQL 上支持托管的模型。</p>
<p>要启用针对未托管模型的 <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> 主键优化，您需要子类化 PostgreSQL 数据库引擎，并根据需要覆盖 features 类的 <code class="docutils literal notranslate"><span class="pre">allows_group_by_selected_pks_on_model()</span></code> 方法。有关示例，请参阅 <a class="reference internal" href="../ref/databases.html#subclassing-database-backends"><span class="std std-ref">子类化内置数据库后端</span></a>。</p>
</li>
</ul>
</div>
<div class="section" id="s-requests-and-responses">
<span id="requests-and-responses"></span><h4>请求和响应<a class="headerlink" href="#requests-and-responses" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>允许使用 <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#memoryview" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">memoryview</span></code></a> 内容初始化 <a class="reference internal" href="../ref/request-response.html#django.http.HttpResponse" title="django.http.HttpResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpResponse</span></code></a>。</li>
<li>例如，在 Django 模板中，现在允许使用下划线（例如，<code class="docutils literal notranslate"><span class="pre">user_agent</span></code>）来查找 <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.headers" title="django.http.HttpRequest.headers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">HttpRequest.headers</span></code></a>，而不是连字符。</li>
</ul>
</div>
<div class="section" id="s-security">
<span id="s-whats-new-security-3-0"></span><span id="security"></span><span id="whats-new-security-3-0"></span><h4>安全<a class="headerlink" href="#security" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/settings.html#std-setting-X_FRAME_OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">X_FRAME_OPTIONS</span></code></a> 现在默认为 <code class="docutils literal notranslate"><span class="pre">'DENY'</span></code>。在较旧的版本中，<a class="reference internal" href="../ref/settings.html#std-setting-X_FRAME_OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">X_FRAME_OPTIONS</span></code></a> 设置默认为 <code class="docutils literal notranslate"><span class="pre">'SAMEORIGIN'</span></code>。如果您的站点使用自身的框架，您将需要显式设置 <code class="docutils literal notranslate"><span class="pre">X_FRAME_OPTIONS</span> <span class="pre">=</span> <span class="pre">'SAMEORIGIN'</span></code>，以便它们继续正常工作。</li>
<li><a class="reference internal" href="../ref/settings.html#std-setting-SECURE_CONTENT_TYPE_NOSNIFF"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SECURE_CONTENT_TYPE_NOSNIFF</span></code></a> 现在默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。启用此选项后，<a class="reference internal" href="../ref/middleware.html#django.middleware.security.SecurityMiddleware" title="django.middleware.security.SecurityMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecurityMiddleware</span></code></a> 会在所有尚未设置该标头的响应上设置 <a class="reference internal" href="../ref/middleware.html#x-content-type-options"><span class="std std-ref">X-Content-Type-Options: nosniff</span></a> 标头。</li>
<li><a class="reference internal" href="../ref/middleware.html#django.middleware.security.SecurityMiddleware" title="django.middleware.security.SecurityMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">SecurityMiddleware</span></code></a> 现在可以发送 <a class="reference internal" href="../ref/middleware.html#referrer-policy"><span class="std std-ref">Referrer-Policy</span></a> 标头。</li>
</ul>
</div>
<div class="section" id="s-tests">
<span id="tests"></span><h4>测试<a class="headerlink" href="#tests" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>新的测试 <a class="reference internal" href="../topics/testing/tools.html#django.test.Client" title="django.test.Client"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client</span></code></a> 参数 <code class="docutils literal notranslate"><span class="pre">raise_request_exception</span></code> 允许控制请求期间引发的异常是否也应该在测试中引发。默认情况下，该值为 <code class="docutils literal notranslate"><span class="pre">True</span></code>，以保持向后兼容性。如果它为 <code class="docutils literal notranslate"><span class="pre">False</span></code> 并且发生异常，测试客户端将返回一个带有属性 <a class="reference internal" href="../topics/testing/tools.html#django.test.Response.exc_info" title="django.test.Response.exc_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">exc_info</span></code></a> 的 500 响应，该属性是一个元组，提供了发生的异常信息。</li>
<li>可以使用新的 <a class="reference internal" href="../ref/django-admin.html#cmdoption-test-k"><code class="xref std std-option docutils literal notranslate"><span class="pre">test</span> <span class="pre">-k</span></code></a> 选项通过测试名称模式选择要运行的测试和测试用例。</li>
<li>HTML 比较，如 <a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase.assertHTMLEqual" title="django.test.SimpleTestCase.assertHTMLEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertHTMLEqual()</span></code></a> 所使用的，现在将相同字符引用的文本、字符引用和实体引用视为等效。</li>
<li>Django 测试运行程序现在支持在支持的浏览器上的无头模式的 Selenium 测试。添加 <code class="docutils literal notranslate"><span class="pre">--headless</span></code> 选项以启用此模式。</li>
<li>Django 测试运行程序现在支持 <code class="docutils literal notranslate"><span class="pre">--start-at</span></code> 和 <code class="docutils literal notranslate"><span class="pre">--start-after</span></code> 选项，以从特定顶级模块开始运行测试。</li>
<li>Django 测试运行程序现在支持 <code class="docutils literal notranslate"><span class="pre">--pdb</span></code> 选项，以在每次出现错误或失败时启动调试器。</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-backwards-incompatible-changes-in-3-0">
<span id="s-backwards-incompatible-3-0"></span><span id="backwards-incompatible-changes-in-3-0"></span><span id="backwards-incompatible-3-0"></span><h2>3.0 版本中的不向后兼容的更改。<a class="headerlink" href="#backwards-incompatible-changes-in-3-0" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-model-save-when-providing-a-default-for-the-primary-key">
<span id="model-save-when-providing-a-default-for-the-primary-key"></span><h3>在提供主键默认值时，使用 <code class="docutils literal notranslate"><span class="pre">Model.save()</span></code><a class="headerlink" href="#model-save-when-providing-a-default-for-the-primary-key" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.save()</span></code></a> 在保存新的 <code class="docutils literal notranslate"><span class="pre">Model</span></code> 实例并提供主键的默认值时不再尝试查找行，而总是执行单个 <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> 查询。在较早的 Django 版本中，<code class="docutils literal notranslate"><span class="pre">Model.save()</span></code> 根据行是否存在执行了 <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> 或 <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>。</p>
<p>这使得在提供默认主键值的情况下调用 <code class="docutils literal notranslate"><span class="pre">Model.save()</span></code> 等效于将 <a class="reference internal" href="../ref/models/instances.html#ref-models-force-insert"><span class="std std-ref">force_insert=True</span></a> 传递给模型的 <code class="docutils literal notranslate"><span class="pre">save()</span></code>。尝试使用新的 <code class="docutils literal notranslate"><span class="pre">Model</span></code> 实例更新现有行将导致 <code class="docutils literal notranslate"><span class="pre">IntegrityError</span></code>。</p>
<p>要更新特定主键值的现有模型，请使用 <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.update_or_create" title="django.db.models.query.QuerySet.update_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">update_or_create()</span></code></a> 方法或 <code class="docutils literal notranslate"><span class="pre">QuerySet.filter(pk=…).update(…)</span></code>。例如：</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">update_or_create</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">existing_pk</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;new name&quot;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">existing_pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;new name&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-database-backend-api">
<span id="database-backend-api"></span><h3>数据库后端 API<a class="headerlink" href="#database-backend-api" title="永久链接至标题">¶</a></h3>
<p>本节介绍了第三方数据库后端可能需要的更改。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.get_geometry_type()</span></code> 的第二个参数现在是行描述而不是列名。</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.get_field_type()</span></code> 可能不再返回元组。</li>
<li>如果数据库可以在添加字段的同一 SQL 语句中创建外键，请添加适当的 SQL 到 <code class="docutils literal notranslate"><span class="pre">SchemaEditor.sql_create_column_inline_fk</span></code>；否则，请设置 <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.can_create_inline_fk</span> <span class="pre">=</span> <span class="pre">False</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.can_return_id_from_insert</span></code> 和 <code class="docutils literal notranslate"><span class="pre">can_return_ids_from_bulk_insert</span></code> 已更名为 <code class="docutils literal notranslate"><span class="pre">can_return_columns_from_insert</span></code> 和 <code class="docutils literal notranslate"><span class="pre">can_return_rows_from_bulk_insert</span></code>。</li>
<li>数据库函数现在在使用 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.timedelta</span></code></a> 实例创建时处理 <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timezone" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.timezone</span></code></a> 格式（例如 <code class="docutils literal notranslate"><span class="pre">timezone(timedelta(hours=5))</span></code>，这将输出 <code class="docutils literal notranslate"><span class="pre">'UTC+05:00'</span></code>）。第三方后端应在准备 <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">datetime_cast_date_sql()</span></code>、<code class="docutils literal notranslate"><span class="pre">datetime_extract_sql()</span></code> 等时处理这种格式。</li>
<li>为了支持这些字段类型上的整数范围验证器，已经将 <code class="docutils literal notranslate"><span class="pre">AutoField</span></code>、<code class="docutils literal notranslate"><span class="pre">BigAutoField</span></code> 和 <code class="docutils literal notranslate"><span class="pre">SmallAutoField</span></code> 的条目添加到 <code class="docutils literal notranslate"><span class="pre">DatabaseOperations.integer_field_ranges</span></code> 中。第三方后端可能需要自定义默认条目。</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseOperations.fetch_returned_insert_id()</span></code> 已被替换为 <code class="docutils literal notranslate"><span class="pre">fetch_returned_insert_columns()</span></code>，它返回由 <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">…</span> <span class="pre">RETURNING</span></code> 语句返回的值列表，而不是单个值。</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseOperations.return_insert_id()</span></code> 已被替换为 <code class="docutils literal notranslate"><span class="pre">return_insert_columns()</span></code>，它接受一个 <code class="docutils literal notranslate"><span class="pre">fields</span></code> 参数，该参数是要在插入后返回的字段的可迭代对象。通常这只是自动生成的主键。</li>
</ul>
</div>
<div class="section" id="s-id1">
<span id="id1"></span><h3><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>管理者模型历史更改消息现在更偏向于使用可读性更高的字段标签，而不是字段名称。</li>
</ul>
</div>
<div class="section" id="s-id2">
<span id="id2"></span><h3><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>不再支持 PostGIS 2.1 。</li>
<li>不再支持 SpatiaLite 4.1 和 4.2 。</li>
<li>不再支持 GDAL 1.11 和 GEOS 3.4 。</li>
</ul>
</div>
<div class="section" id="s-dropped-support-for-postgresql-9-4">
<span id="dropped-support-for-postgresql-9-4"></span><h3>不再支持 PostgreSQL 9.4 。<a class="headerlink" href="#dropped-support-for-postgresql-9-4" title="永久链接至标题">¶</a></h3>
<p>上游对于 PostgreSQL 9.4 的支持在 2019 年 12 月结束。 Django 3.0 支持 PostgreSQL 9.5 及更高版本。</p>
</div>
<div class="section" id="s-dropped-support-for-oracle-12-1">
<span id="dropped-support-for-oracle-12-1"></span><h3>不再支持 Oracle 12.1 。<a class="headerlink" href="#dropped-support-for-oracle-12-1" title="永久链接至标题">¶</a></h3>
<p>Oracle 12.1 的上游支持将于 2021 年 7 月结束。 Django 2.2 将支持至 2022 年 4 月。 Django 3.0 正式支持 Oracle 12.2 和 18c 版本。</p>
</div>
<div class="section" id="s-removed-private-python-2-compatibility-apis">
<span id="removed-private-python-2-compatibility-apis"></span><h3>移除了私有的 Python 2 兼容 API 。<a class="headerlink" href="#removed-private-python-2-compatibility-apis" title="永久链接至标题">¶</a></h3>
<p>尽管在 Django 2.0 中移除了对 Python 2 的支持，但某些私有 API 未被移除，以便第三方应用程序在 Python 2 生命周期结束之前仍可继续使用它们。</p>
<p>由于我们预计在添加对 Django 3.0 的支持时，应用程序将放弃对 Python 2 的兼容性，因此我们此时正在移除这些 API 。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.test.utils.str_prefix()</span></code> - 在 Python 3 中，字符串不再具有 'u' 前缀。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.test.utils.patch_logger()</span></code> - 请改用 <a class="reference external" href="https://docs.python.org/3/library/unittest.html#unittest.TestCase.assertLogs" title="(在 Python v3.12)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">unittest.TestCase.assertLogs()</span></code></a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.lru_cache.lru_cache()</span></code> - 是 <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.lru_cache" title="(在 Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.lru_cache()</span></code></a> 的别名。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.decorators.available_attrs()</span></code> - 此函数返回 <code class="docutils literal notranslate"><span class="pre">functools.WRAPPER_ASSIGNMENTS</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.decorators.ContextDecorator</span></code> - 是 <a class="reference external" href="https://docs.python.org/3/library/contextlib.html#contextlib.ContextDecorator" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">contextlib.ContextDecorator</span></code></a> 的别名。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils._os.abspathu()</span></code> - 是 <a class="reference external" href="https://docs.python.org/3/library/os.path.html#os.path.abspath" title="(在 Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">os.path.abspath()</span></code></a> 的别名。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils._os.upath()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">npath()</span></code> - 在 Python 3 上不执行任何操作。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.six</span></code> - 移除对此库的使用或切换到 <a class="reference external" href="https://pypi.org/project/six/">six</a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.encoding.python_2_unicode_compatible()</span></code> - 是 <code class="docutils literal notranslate"><span class="pre">six.python_2_unicode_compatible()</span></code> 的别名。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.functional.curry()</span></code> - 请使用 <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.partial" title="(在 Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">functools.partial()</span></code></a> 或 <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.partialmethod" title="(在 Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">functools.partialmethod</span></code></a>。请参阅 <a class="reference external" href="https://github.com/django/django/commit/5b1c389603a353625ae1603ba345147356336afb">5b1c389603a353625ae1603ba345147356336afb</a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.safestring.SafeBytes</span></code> - 自 Django 2.0 起未使用。</li>
</ul>
</div>
<div class="section" id="s-new-default-value-for-the-file-upload-permissions-setting">
<span id="new-default-value-for-the-file-upload-permissions-setting"></span><h3><code class="docutils literal notranslate"><span class="pre">FILE_UPLOAD_PERMISSIONS</span></code> 设置的新默认值。<a class="headerlink" href="#new-default-value-for-the-file-upload-permissions-setting" title="永久链接至标题">¶</a></h3>
<p>在较早的版本中，<a class="reference internal" href="../ref/settings.html#std-setting-FILE_UPLOAD_PERMISSIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">FILE_UPLOAD_PERMISSIONS</span></code></a> 设置的默认值为 <code class="docutils literal notranslate"><span class="pre">None</span></code>。在默认的:setting:FILE_UPLOAD_HANDLERS 的情况下，这导致上传的文件根据其大小和使用的上传处理程序而具有不同的权限。</p>
<p>现在，默认情况下，<code class="docutils literal notranslate"><span class="pre">FILE_UPLOAD_PERMISSIONS</span></code> 默认为 <code class="docutils literal notranslate"><span class="pre">0o644</span></code>，以避免这种不一致性。</p>
</div>
<div class="section" id="s-new-default-values-for-security-settings">
<span id="new-default-values-for-security-settings"></span><h3>安全设置的新默认值。<a class="headerlink" href="#new-default-values-for-security-settings" title="永久链接至标题">¶</a></h3>
<p>为了使 Django 项目在默认情况下更加安全，一些安全设置现在具有更安全的默认值：</p>
<ul class="simple">
<li><a class="reference internal" href="../ref/settings.html#std-setting-X_FRAME_OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">X_FRAME_OPTIONS</span></code></a> 现在默认为 <code class="docutils literal notranslate"><span class="pre">'DENY'</span></code>。</li>
<li><a class="reference internal" href="../ref/settings.html#std-setting-SECURE_CONTENT_TYPE_NOSNIFF"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SECURE_CONTENT_TYPE_NOSNIFF</span></code></a> 现在默认为 <code class="docutils literal notranslate"><span class="pre">True</span></code>。</li>
</ul>
<p>有关这些更改的更多详细信息，请参阅上面的 <em>What's New</em> <a class="reference internal" href="#whats-new-security-3-0"><span class="std std-ref">Security section</span></a>。</p>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h3>杂项<a class="headerlink" href="#miscellaneous" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ContentType.__str__()</span></code> 现在包括模型的 <code class="docutils literal notranslate"><span class="pre">app_label</span></code> 以消除在不同应用程序中具有相同名称的模型的歧义。</li>
<li>由于已弃用在 cookie 中而不是会话中访问语言，因此 <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> 不再在会话中查找用户的语言，而 <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.logout" title="django.contrib.auth.logout"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.auth.logout()</span></code></a> 在注销后不再保留会话的语言。</li>
<li><a class="reference internal" href="../ref/utils.html#django.utils.html.escape" title="django.utils.html.escape"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.html.escape()</span></code></a> 现在使用 <a class="reference external" href="https://docs.python.org/3/library/html.html#html.escape" title="(在 Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">html.escape()</span></code></a> 来转义 HTML。这会将 <code class="docutils literal notranslate"><span class="pre">'</span></code> 转换为 <code class="docutils literal notranslate"><span class="pre">&amp;#x27;</span></code>，而不是以前的等效十进制代码 <code class="docutils literal notranslate"><span class="pre">&amp;#39;</span></code>。</li>
<li><code class="docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">test</span> <span class="pre">-k</span></code> 选项现在与 <a class="reference external" href="https://docs.python.org/3/library/unittest.html#cmdoption-unittest-k" title="(在 Python v3.12)"><code class="xref std std-option docutils literal notranslate"><span class="pre">unittest</span> <span class="pre">-k</span></code></a> 选项一样工作，而不再作为 <code class="docutils literal notranslate"><span class="pre">--keepdb</span></code> 的快捷方式。</li>
<li>对于 <code class="docutils literal notranslate"><span class="pre">pywatchman</span></code> 版本低于 1.2.0 的支持已被移除。</li>
<li>在 <code class="docutils literal notranslate"><span class="pre">doseq=False</span></code> 时，<a class="reference internal" href="../ref/utils.html#django.utils.http.urlencode" title="django.utils.http.urlencode"><code class="xref py py-func docutils literal notranslate"><span class="pre">urlencode()</span></code></a> 现在会像标准库的 <a class="reference external" href="https://docs.python.org/3/library/urllib.parse.html#urllib.parse.urlencode" title="(在 Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.parse.urlencode()</span></code></a> 函数一样，将可迭代的值按原样编码，而不是迭代它们。</li>
<li><code class="docutils literal notranslate"><span class="pre">intword</span></code> 模板过滤器现在将 <code class="docutils literal notranslate"><span class="pre">1.0</span></code> 翻译为单数短语，将所有其他数值视为复数。这对某些语言可能不正确。</li>
<li>给模型的 <a class="reference internal" href="../ref/models/fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a> 或 <a class="reference internal" href="../ref/models/fields.html#django.db.models.OneToOneField" title="django.db.models.OneToOneField"><code class="xref py py-class docutils literal notranslate"><span class="pre">OneToOneField</span></code></a> 的 <code class="docutils literal notranslate"><span class="pre">'_id'</span></code> 属性分配一个值现在会取消对应字段的设置。之后访问该字段将导致查询。</li>
<li><a class="reference internal" href="../ref/utils.html#django.utils.cache.patch_vary_headers" title="django.utils.cache.patch_vary_headers"><code class="xref py py-func docutils literal notranslate"><span class="pre">patch_vary_headers()</span></code></a> 现在按照 <span class="target" id="index-2"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7231.html#section-7.1.4"><strong>RFC 7231#section-7.1.4</strong></a> 处理星号 <code class="docutils literal notranslate"><span class="pre">'*'</span></code>，即如果标头字段名称列表包含星号，则 <code class="docutils literal notranslate"><span class="pre">Vary</span></code> 标头将包含单个星号 <code class="docutils literal notranslate"><span class="pre">'*'</span></code>。</li>
<li>在 MySQL 8.0.16+ 上，<code class="docutils literal notranslate"><span class="pre">PositiveIntegerField</span></code> 和 <code class="docutils literal notranslate"><span class="pre">PositiveSmallIntegerField</span></code> 现在包括一个检查约束，以防止数据库中出现负值。</li>
<li><code class="docutils literal notranslate"><span class="pre">alias=None</span></code> 已添加到 <a class="reference internal" href="../ref/models/expressions.html#django.db.models.Expression.get_group_by_cols" title="django.db.models.Expression.get_group_by_cols"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Expression.get_group_by_cols()</span></code></a> 的签名中。</li>
<li><code class="docutils literal notranslate"><span class="pre">RegexPattern</span></code>，由 <a class="reference internal" href="../ref/urls.html#django.urls.re_path" title="django.urls.re_path"><code class="xref py py-func docutils literal notranslate"><span class="pre">re_path()</span></code></a> 使用，不再返回带有 <code class="docutils literal notranslate"><span class="pre">None</span></code> 值的关键字参数，以便传递给视图，用于缺少的可选命名组。</li>
</ul>
</div>
</div>
<div class="section" id="s-features-deprecated-in-3-0">
<span id="s-deprecated-features-3-0"></span><span id="features-deprecated-in-3-0"></span><span id="deprecated-features-3-0"></span><h2>在 3.0 中被废弃的功能<a class="headerlink" href="#features-deprecated-in-3-0" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-django-utils-encoding-force-text-and-smart-text">
<span id="django-utils-encoding-force-text-and-smart-text"></span><h3><code class="docutils literal notranslate"><span class="pre">django.utils.encoding.force_text()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">smart_text()</span></code><a class="headerlink" href="#django-utils-encoding-force-text-and-smart-text" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">smart_text()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">force_text()</span></code> 别名（自 Django 2.0 起）的 <code class="docutils literal notranslate"><span class="pre">smart_str()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">force_str()</span></code> 已被弃用。如果您的代码支持 Python 2，请忽略此弃用，因为在 Python 2 中，<code class="docutils literal notranslate"><span class="pre">smart_str()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">force_str()</span></code> 的行为是不同的。</p>
</div>
<div class="section" id="s-id3">
<span id="id3"></span><h3>杂项<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.utils.http.urlquote()</span></code>, <code class="docutils literal notranslate"><span class="pre">urlquote_plus()</span></code>, <code class="docutils literal notranslate"><span class="pre">urlunquote()</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">urlunquote_plus()</span></code> 已被弃用，建议使用它们的别名函数：<a class="reference external" href="https://docs.python.org/3/library/urllib.parse.html#urllib.parse.quote" title="(在 Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">urllib.parse.quote()</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/urllib.parse.html#urllib.parse.quote_plus" title="(在 Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">quote_plus()</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/urllib.parse.html#urllib.parse.unquote" title="(在 Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">unquote()</span></code></a>, 和 <a class="reference external" href="https://docs.python.org/3/library/urllib.parse.html#urllib.parse.unquote_plus" title="(在 Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">unquote_plus()</span></code></a>。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.translation.ugettext()</span></code>, <code class="docutils literal notranslate"><span class="pre">ugettext_lazy()</span></code>, <code class="docutils literal notranslate"><span class="pre">ugettext_noop()</span></code>, <code class="docutils literal notranslate"><span class="pre">ungettext()</span></code>, 和 <code class="docutils literal notranslate"><span class="pre">ungettext_lazy()</span></code> 已被弃用，建议使用它们的别名函数：<a class="reference internal" href="../ref/utils.html#django.utils.translation.gettext" title="django.utils.translation.gettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.gettext()</span></code></a>, <a class="reference internal" href="../ref/utils.html#django.utils.translation.gettext_lazy" title="django.utils.translation.gettext_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext_lazy()</span></code></a>, <a class="reference internal" href="../ref/utils.html#django.utils.translation.gettext_noop" title="django.utils.translation.gettext_noop"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext_noop()</span></code></a>, <a class="reference internal" href="../ref/utils.html#django.utils.translation.ngettext" title="django.utils.translation.ngettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">ngettext()</span></code></a>, 和 <a class="reference internal" href="../ref/utils.html#django.utils.translation.ngettext_lazy" title="django.utils.translation.ngettext_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">ngettext_lazy()</span></code></a>。</li>
<li>为了限制会话的创建，从而支持某些缓存策略，在 Django 4.0 中，<a class="reference internal" href="../topics/i18n/translation.html#django.views.i18n.set_language" title="django.views.i18n.set_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.views.i18n.set_language()</span></code></a> 将停止在会话中设置用户的语言。自 Django 2.1 起，语言始终存储在 <a class="reference internal" href="../ref/settings.html#std-setting-LANGUAGE_COOKIE_NAME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_NAME</span></code></a> cookie 中。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.text.unescape_entities()</span></code> 已被弃用，建议使用 <a class="reference external" href="https://docs.python.org/3/library/html.html#html.unescape" title="(在 Python v3.12)"><code class="xref py py-func docutils literal notranslate"><span class="pre">html.unescape()</span></code></a>。请注意，与 <code class="docutils literal notranslate"><span class="pre">unescape_entities()</span></code> 不同，<code class="docutils literal notranslate"><span class="pre">html.unescape()</span></code> 立即评估延迟字符串。</li>
<li>为了避免对有效范围的可能混淆，私有的内部实用程序 <code class="docutils literal notranslate"><span class="pre">is_safe_url()</span></code> 被重命名为 <code class="docutils literal notranslate"><span class="pre">url_has_allowed_host_and_scheme()</span></code>。通常情况下，一个 URL 具有允许的主机和方案并不意味着它是&quot;安全的&quot;。例如，它可能仍然被引用不正确。请确保在不受信任的 URL 的路径组件上也使用 <a class="reference internal" href="../ref/utils.html#django.utils.encoding.iri_to_uri" title="django.utils.encoding.iri_to_uri"><code class="xref py py-func docutils literal notranslate"><span class="pre">iri_to_uri()</span></code></a>。</li>
</ul>
</div>
</div>
<div class="section" id="s-features-removed-in-3-0">
<span id="s-removed-features-3-0"></span><span id="features-removed-in-3-0"></span><span id="removed-features-3-0"></span><h2>在 3.0 版本中删除的功能。<a class="headerlink" href="#features-removed-in-3-0" title="永久链接至标题">¶</a></h2>
<p>这些功能已经完成了其弃用周期，并在 Django 3.0 中被移除。</p>
<p>有关这些更改的详细信息，包括如何移除对这些功能的使用，请参阅 <a class="reference internal" href="2.0.html#deprecated-features-2-0"><span class="std std-ref">在 2.0 中被废弃的功能</span></a>。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.db.backends.postgresql_psycopg2</span></code> 模块已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.shortcuts.render_to_response()</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">DEFAULT_CONTENT_TYPE</span></code> 设置已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">HttpRequest.xreadlines()</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">Field.from_db_value()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Expression.convert_value()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">context</span></code> 参数支持已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">QuerySet.earliest()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">latest()</span></code> 的 <code class="docutils literal notranslate"><span class="pre">field_name</span></code> 关键参数已被移除。</li>
</ul>
<p>请参阅 <a class="reference internal" href="2.1.html#deprecated-features-2-1"><span class="std std-ref">在 2.1 中被废弃的功能</span></a> 以获取有关这些更改的详细信息，包括如何移除对这些功能的使用。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ForceRHR</span></code> GIS 函数已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.utils.http.cookie_date()</span></code> 已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">staticfiles</span></code> 和 <code class="docutils literal notranslate"><span class="pre">admin_static</span></code> 模板标签库已被移除。</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.staticfiles.templatetags.staticfiles.static()</span></code> 已被移除。</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Django 3.0 版本发行说明</a><ul>
<li><a class="reference internal" href="#python-compatibility">Python 兼容性</a></li>
<li><a class="reference internal" href="#third-party-library-support-for-older-version-of-django">对于较旧版本的 Django 的第三方库支持</a></li>
<li><a class="reference internal" href="#what-s-new-in-django-3-0">Django 3.0 新特性</a><ul>
<li><a class="reference internal" href="#mariadb-support">MariaDB 支持</a></li>
<li><a class="reference internal" href="#asgi-support">ASGI 支持</a></li>
<li><a class="reference internal" href="#exclusion-constraints-on-postgresql">PostgreSQL 上的排除约束</a></li>
<li><a class="reference internal" href="#filter-expressions">过滤表达式</a></li>
<li><a class="reference internal" href="#enumerations-for-model-field-choices">模型字段选择的枚举类型</a></li>
<li><a class="reference internal" href="#minor-features">次要特性</a><ul>
<li><a class="reference internal" href="#django-contrib-admin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-auth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-gis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-postgres"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sessions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sessions</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-syndication"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.syndication</span></code></a></li>
<li><a class="reference internal" href="#cache">缓存</a></li>
<li><a class="reference internal" href="#file-storage">文件存储</a></li>
<li><a class="reference internal" href="#forms">表单</a></li>
<li><a class="reference internal" href="#internationalization">国际化</a></li>
<li><a class="reference internal" href="#logging">日志</a></li>
<li><a class="reference internal" href="#management-commands">管理命令</a></li>
<li><a class="reference internal" href="#models">模型</a></li>
<li><a class="reference internal" href="#requests-and-responses">请求和响应</a></li>
<li><a class="reference internal" href="#security">安全</a></li>
<li><a class="reference internal" href="#tests">测试</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-incompatible-changes-in-3-0">3.0 版本中的不向后兼容的更改。</a><ul>
<li><a class="reference internal" href="#model-save-when-providing-a-default-for-the-primary-key">在提供主键默认值时，使用 <code class="docutils literal notranslate"><span class="pre">Model.save()</span></code></a></li>
<li><a class="reference internal" href="#database-backend-api">数据库后端 API</a></li>
<li><a class="reference internal" href="#id1"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#id2"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#dropped-support-for-postgresql-9-4">不再支持 PostgreSQL 9.4 。</a></li>
<li><a class="reference internal" href="#dropped-support-for-oracle-12-1">不再支持 Oracle 12.1 。</a></li>
<li><a class="reference internal" href="#removed-private-python-2-compatibility-apis">移除了私有的 Python 2 兼容 API 。</a></li>
<li><a class="reference internal" href="#new-default-value-for-the-file-upload-permissions-setting"><code class="docutils literal notranslate"><span class="pre">FILE_UPLOAD_PERMISSIONS</span></code> 设置的新默认值。</a></li>
<li><a class="reference internal" href="#new-default-values-for-security-settings">安全设置的新默认值。</a></li>
<li><a class="reference internal" href="#miscellaneous">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-deprecated-in-3-0">在 3.0 中被废弃的功能</a><ul>
<li><a class="reference internal" href="#django-utils-encoding-force-text-and-smart-text"><code class="docutils literal notranslate"><span class="pre">django.utils.encoding.force_text()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">smart_text()</span></code></a></li>
<li><a class="reference internal" href="#id3">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-removed-in-3-0">在 3.0 版本中删除的功能。</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="3.0.1.html"
                          title="上一章">Django 3.0.1 版本发行说明</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="2.2.28.html"
                          title="下一章">Django 2.2.28 版本发行说明</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/releases/3.0.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">2月 21, 2024</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="3.0.1.html" title="Django 3.0.1 版本发行说明">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="2.2.28.html" title="Django 2.2.28 版本发行说明">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>