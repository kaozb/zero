
<!DOCTYPE html>

<html lang="zh_Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>表单集 &#8212; Django 4.2.6.dev20230904111759 文档</title>
    <link rel="stylesheet" type="text/css" href="../../static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../static/default.css" />
    <script data-url_root="../../" id="documentation_options" src="../../static/documentation_options.js"></script>
    <script src="../../static/jquery.js"></script>
    <script src="../../static/underscore.js"></script>
    <script src="../../static/doctools.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="从模型创建表单" href="modelforms.html" />
    <link rel="prev" title="使用表单" href="index.html" />



 
<script src="../../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Django 4.2.6.dev20230904111759 文档</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Table of contents" href="../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../genindex.html">Index</a>  |
        <a title="Module index" href="../../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="index.html" title="使用表单">previous</a>
     |
    <a href="../index.html" title="使用 Django" accesskey="U">up</a>
   |
    <a href="modelforms.html" title="从模型创建表单">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="topics-forms-formsets">
            
  <div class="section" id="s-formsets">
<span id="formsets"></span><h1>表单集<a class="headerlink" href="#formsets" title="永久链接至标题">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><code class="sig-name descname"><span class="pre">BaseFormSet</span></code><a class="headerlink" href="#django.forms.formsets.BaseFormSet" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>A formset is a layer of abstraction to work with multiple forms on the same
page. It can be best compared to a data grid. Let's say you have the following
form:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">ArticleForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">title</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>You might want to allow the user to create several articles at once. To create
a formset out of an <code class="docutils literal notranslate"><span class="pre">ArticleForm</span></code> you would do:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">)</span>
</pre></div>
</div>
<p>You now have created a formset class named <code class="docutils literal notranslate"><span class="pre">ArticleFormSet</span></code>.
Instantiating the formset gives you the ability to iterate over the forms
in the formset and display them as you would with a regular form:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="n">formset</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">as_table</span><span class="p">())</span>
<span class="gp">...</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-title&quot;&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-title&quot; id=&quot;id_form-0-title&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-pub_date&quot;&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-pub_date&quot; id=&quot;id_form-0-pub_date&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
</pre></div>
</div>
<p>As you can see it only displayed one empty form. The number of empty forms
that is displayed is controlled by the <code class="docutils literal notranslate"><span class="pre">extra</span></code> parameter. By default,
<a class="reference internal" href="../../ref/forms/formsets.html#django.forms.formsets.formset_factory" title="django.forms.formsets.formset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">formset_factory()</span></code></a> defines one extra form; the
following example will create a formset class to display two blank forms:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>遍历 formset 将按照它们创建的顺序渲染表单。你可以通过为 <code class="docutils literal notranslate"><span class="pre">__iter__()</span></code> 方法提供替代的实现来改变这个顺序。</p>
<p>表单集也可以被索引然后返回对应的表单。如果您已经覆盖了 <code class="docutils literal notranslate"><span class="pre">__iter__</span></code> ，则还需覆盖  <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> 让它具备匹配行为。</p>
<div class="section" id="s-using-initial-data-with-a-formset">
<span id="s-formsets-initial-data"></span><span id="using-initial-data-with-a-formset"></span><span id="formsets-initial-data"></span><h2>使用formset的初始数据<a class="headerlink" href="#using-initial-data-with-a-formset" title="永久链接至标题">¶</a></h2>
<p>Initial data is what drives the main usability of a formset. As shown above
you can define the number of extra forms. What this means is that you are
telling the formset how many additional forms to show in addition to the
number of forms it generates from the initial data. Let's take a look at an
example:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">initial</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span>
<span class="gp">... </span>            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Django is now open source&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="s2">&quot;pub_date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span>
<span class="gp">... </span>        <span class="p">}</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="n">formset</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">as_table</span><span class="p">())</span>
<span class="gp">...</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-title&quot;&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-title&quot; value=&quot;Django is now open source&quot; id=&quot;id_form-0-title&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-pub_date&quot;&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-pub_date&quot; value=&quot;2008-05-12&quot; id=&quot;id_form-0-pub_date&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-1-title&quot;&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-1-title&quot; id=&quot;id_form-1-title&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-1-pub_date&quot;&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-1-pub_date&quot; id=&quot;id_form-1-pub_date&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-2-title&quot;&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-2-title&quot; id=&quot;id_form-2-title&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-2-pub_date&quot;&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-2-pub_date&quot; id=&quot;id_form-2-pub_date&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
</pre></div>
</div>
<p>现在上面显示了三张表单。一张是传了初始数据的，另外两张是额外的。需要注意的是，我们通过传递一个字典列表来作为初始数据。</p>
<p>如果您使用了 <code class="docutils literal notranslate"><span class="pre">initial</span></code> 来显示formset，那么您需要在处理formset提交时传入相同的 <code class="docutils literal notranslate"><span class="pre">initial</span></code> ，以便formset检测用户更改了哪些表单。例如，您可能有这样的： <code class="docutils literal notranslate"><span class="pre">ArticleFormSet(request.POST,</span> <span class="pre">initial=[...])</span></code> 。</p>
<div class="admonition seealso">
<p class="first admonition-title">参见</p>
<p class="last"><a class="reference internal" href="modelforms.html#model-formsets"><span class="std std-ref">创建模型表单集</span></a>。</p>
</div>
</div>
<div class="section" id="s-limiting-the-maximum-number-of-forms">
<span id="s-formsets-max-num"></span><span id="limiting-the-maximum-number-of-forms"></span><span id="formsets-max-num"></span><h2>限制表单的最大数量<a class="headerlink" href="#limiting-the-maximum-number-of-forms" title="永久链接至标题">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">max_num</span></code> parameter to <a class="reference internal" href="../../ref/forms/formsets.html#django.forms.formsets.formset_factory" title="django.forms.formsets.formset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">formset_factory()</span></code></a>
gives you the ability to limit the number of forms the formset will display:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="n">formset</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">as_table</span><span class="p">())</span>
<span class="gp">...</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-title&quot;&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-title&quot; id=&quot;id_form-0-title&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-pub_date&quot;&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-pub_date&quot; id=&quot;id_form-0-pub_date&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
</pre></div>
</div>
<p>如果 <code class="docutils literal notranslate"><span class="pre">max_num</span></code> 的值大于初始数据现有数量，那空白表单可显示的数量取决于 <code class="docutils literal notranslate"><span class="pre">extra</span></code> 的数量，只要总表单数不超过 <code class="docutils literal notranslate"><span class="pre">max_num</span></code> 。例如， <code class="docutils literal notranslate"><span class="pre">extra=2</span></code> ， <code class="docutils literal notranslate"><span class="pre">max_num=2</span></code> 并且formset有一个 <code class="docutils literal notranslate"><span class="pre">initial</span></code> 初始化项，则会显示一张初始化表单和一张空白表单。</p>
<p>如果初始数据项的数量超过 <code class="docutils literal notranslate"><span class="pre">max_num</span></code> ，那么 <code class="docutils literal notranslate"><span class="pre">max_num</span></code> 的值会被无视，所有初始数据表单都会显示，并且也不会有额外的表单显示。例如，假设 <code class="docutils literal notranslate"><span class="pre">extra=3</span></code> ， <code class="docutils literal notranslate"><span class="pre">max_num=1</span></code> 并且formset有两个初始化项，那么只会显示两张有初始化数据的表单。</p>
<p><code class="docutils literal notranslate"><span class="pre">max_num</span></code> 的值 <code class="docutils literal notranslate"><span class="pre">None</span></code> (默认值)，它限制最多显示(1000)张表单，其实这相当于没有限制。</p>
<p><code class="docutils literal notranslate"><span class="pre">max_num</span></code> 默认只影响显示多少数量的表单而不影响验证。如果将 <code class="docutils literal notranslate"><span class="pre">validate_max=True</span></code> 传给 <a class="reference internal" href="../../ref/forms/formsets.html#django.forms.formsets.formset_factory" title="django.forms.formsets.formset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">formset_factory()</span></code></a>，那么 <code class="docutils literal notranslate"><span class="pre">max_num</span></code> 将会影响验证。参见 <a class="reference internal" href="#validate-max"><span class="std std-ref">validate_max</span></a> 。</p>
</div>
<div class="section" id="s-limiting-the-maximum-number-of-instantiated-forms">
<span id="s-formsets-absolute-max"></span><span id="limiting-the-maximum-number-of-instantiated-forms"></span><span id="formsets-absolute-max"></span><h2>限制实例化表单的最大数量<a class="headerlink" href="#limiting-the-maximum-number-of-instantiated-forms" title="永久链接至标题">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">absolute_max</span></code> parameter to <a class="reference internal" href="../../ref/forms/formsets.html#django.forms.formsets.formset_factory" title="django.forms.formsets.formset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">formset_factory()</span></code></a> allows limiting the
number of forms that can be instantiated when supplying <code class="docutils literal notranslate"><span class="pre">POST</span></code> data. This
protects against memory exhaustion attacks using forged <code class="docutils literal notranslate"><span class="pre">POST</span></code> requests:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms.formsets</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">,</span> <span class="n">absolute_max</span><span class="o">=</span><span class="mi">1500</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;1501&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">forms</span><span class="p">)</span>
<span class="go">1500</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">non_form_errors</span><span class="p">()</span>
<span class="go">[&#39;Please submit at most 1000 forms.&#39;]</span>
</pre></div>
</div>
<p>当 <code class="docutils literal notranslate"><span class="pre">absolute_max</span></code> 为 <code class="docutils literal notranslate"><span class="pre">None</span></code> 时，它默认为 <code class="docutils literal notranslate"><span class="pre">max_num</span> <span class="pre">+</span> <span class="pre">1000</span></code>。（如果 <code class="docutils literal notranslate"><span class="pre">max_num</span></code> 是 <code class="docutils literal notranslate"><span class="pre">None</span></code>，则默认为 <code class="docutils literal notranslate"><span class="pre">2000</span></code>）。</p>
<p>如果 <code class="docutils literal notranslate"><span class="pre">absolute_max</span></code> 小于 <code class="docutils literal notranslate"><span class="pre">max_num</span></code>，将引发 <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>。</p>
</div>
<div class="section" id="s-formset-validation">
<span id="formset-validation"></span><h2>Formset验证<a class="headerlink" href="#formset-validation" title="永久链接至标题">¶</a></h2>
<p>Validation with a formset is almost identical to a regular <code class="docutils literal notranslate"><span class="pre">Form</span></code>. There is
an <code class="docutils literal notranslate"><span class="pre">is_valid</span></code> method on the formset to provide a convenient way to validate
all forms in the formset:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>We passed in no data to the formset which is resulting in a valid form. The
formset is smart enough to ignore extra forms that were not changed. If we
provide an invalid article:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-title&quot;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-pub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;1904-06-16&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-1-title&quot;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-1-pub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># &lt;-- this date is missing but required</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">errors</span>
<span class="go">[{}, {&#39;pub_date&#39;: [&#39;This field is required.&#39;]}]</span>
</pre></div>
</div>
<p>正如我们看到的，<code class="docutils literal notranslate"><span class="pre">formset.errors</span></code> 是一张列表，它的内容对应着formset中表单。两张表都进行了验证，并且第二项中出现了预期的错误消息。</p>
<p>和使用普通 <code class="docutils literal notranslate"><span class="pre">Form</span></code> 一样，formset表单中的每个字段都可能包含HTML属性，例如用于浏览器验证的 <code class="docutils literal notranslate"><span class="pre">maxlength</span></code> 。但是由于表单添加、删除的时候会影响属性 <code class="docutils literal notranslate"><span class="pre">required</span></code> 的验证，表单集中的表单不会包含此属性。</p>
<dl class="py method">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.total_error_count">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">total_error_count</span></code>()<a class="headerlink" href="#django.forms.formsets.BaseFormSet.total_error_count" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>To check how many errors there are in the formset, we can use the
<code class="docutils literal notranslate"><span class="pre">total_error_count</span></code> method:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Using the previous example</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">errors</span>
<span class="go">[{}, {&#39;pub_date&#39;: [&#39;This field is required.&#39;]}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">formset</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">total_error_count</span><span class="p">()</span>
<span class="go">1</span>
</pre></div>
</div>
<p>We can also check if form data differs from the initial data (i.e. the form was
sent without any data):</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-title&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-pub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">has_changed</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
<div class="section" id="s-understanding-the-managementform">
<span id="s-id1"></span><span id="understanding-the-managementform"></span><span id="id1"></span><h3>理解 <code class="docutils literal notranslate"><span class="pre">ManagementForm</span></code><a class="headerlink" href="#understanding-the-managementform" title="永久链接至标题">¶</a></h3>
<p>You may have noticed the additional data (<code class="docutils literal notranslate"><span class="pre">form-TOTAL_FORMS</span></code>,
<code class="docutils literal notranslate"><span class="pre">form-INITIAL_FORMS</span></code>) that was required in the formset's data above. This
data is required for the <code class="docutils literal notranslate"><span class="pre">ManagementForm</span></code>. This form is used by the formset
to manage the collection of forms contained in the formset. If you don't
provide this management data, the formset will be invalid:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-title&quot;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-pub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
<p>它被用来跟踪显示了多少个表单实例。如果您通过JavaScript添加新表单，那您同样需要增加相应内容到那些数量字段中，另一方面，如果您允许通过JavaScript来删除已存在对象，那么您需确认被移除的对象已经被标记在 <code class="docutils literal notranslate"><span class="pre">form-#-DELETE</span></code> 中并被放到 <code class="docutils literal notranslate"><span class="pre">POST</span></code> 内。无论如何，所有表单都要确保在 <code class="docutils literal notranslate"><span class="pre">POST</span></code> 数据中。</p>
<p>管理表单以formset的一项属性而存在。在模板中渲染formset时，你可以使用 <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">my_formset.management_form</span> <span class="pre">}}</span></code>  (将my_formset替换为自己的formset名称)渲染出所有管理表单的数据。</p>
<div class="admonition note">
<p class="first admonition-title">备注</p>
<p class="last">除了这里的例子中显示的 <code class="docutils literal notranslate"><span class="pre">form-TOTAL_FORMS</span></code> 和 <code class="docutils literal notranslate"><span class="pre">form-INITIAL_FORMS</span></code> 字段，管理表单还包括 <code class="docutils literal notranslate"><span class="pre">form-MIN_NUM_FORMS</span></code> 和 <code class="docutils literal notranslate"><span class="pre">form-MAX_NUM_FORMS</span></code> 字段。它们与管理表单的其他部分一起输出，但只是为了方便客户端的代码。这些字段不是必须的，所以没有显示在示例的 <code class="docutils literal notranslate"><span class="pre">POST</span></code> 数据中。</p>
</div>
</div>
<div class="section" id="s-total-form-count-and-initial-form-count">
<span id="total-form-count-and-initial-form-count"></span><h3><code class="docutils literal notranslate"><span class="pre">total_form_count</span></code> 和 <code class="docutils literal notranslate"><span class="pre">initial_form_count</span></code><a class="headerlink" href="#total-form-count-and-initial-form-count" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">BaseFormSet</span></code> 有一对与 <code class="docutils literal notranslate"><span class="pre">ManagementForm</span></code> 密切相关的方法， <code class="docutils literal notranslate"><span class="pre">total_form_count</span></code>  和  <code class="docutils literal notranslate"><span class="pre">initial_form_count</span></code> 。</p>
<p><code class="docutils literal notranslate"><span class="pre">total_form_count</span></code> 返回该formset内表单的总和。 <code class="docutils literal notranslate"><span class="pre">initial_form_count</span></code> 返回该formset内预填充的表单数量，同时用于定义需要多少表单。你可能永远不会重写这两个方法，因此在使用之前请理解它们的用途。</p>
</div>
<div class="section" id="s-empty-form">
<span id="s-id2"></span><span id="empty-form"></span><span id="id2"></span><h3><code class="docutils literal notranslate"><span class="pre">empty_form</span></code><a class="headerlink" href="#empty-form" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">BaseFormSet``有一项属性``empty_form</span></code>，它返回一个以``__prefix__`` 为前缀的表单实例，这是为了方便在动态表单中配合JavaScript使用。</p>
</div>
<div class="section" id="s-error-messages">
<span id="s-formsets-error-messages"></span><span id="error-messages"></span><span id="formsets-error-messages"></span><h3><code class="docutils literal notranslate"><span class="pre">error_messages</span></code><a class="headerlink" href="#error-messages" title="永久链接至标题">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">error_messages</span></code> argument lets you override the default messages that the
formset will raise. Pass in a dictionary with keys matching the error messages
you want to override. Error message keys include <code class="docutils literal notranslate"><span class="pre">'too_few_forms'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'too_many_forms'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'missing_management_form'</span></code>. The
<code class="docutils literal notranslate"><span class="pre">'too_few_forms'</span></code> and <code class="docutils literal notranslate"><span class="pre">'too_many_forms'</span></code> error messages may contain
<code class="docutils literal notranslate"><span class="pre">%(num)d</span></code>, which will be replaced with <code class="docutils literal notranslate"><span class="pre">min_num</span></code> and <code class="docutils literal notranslate"><span class="pre">max_num</span></code>,
respectively.</p>
<p>For example, here is the default error message when the
management form is missing:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">({})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">non_form_errors</span><span class="p">()</span>
<span class="go">[&#39;ManagementForm data is missing or has been tampered with. Missing fields: form-TOTAL_FORMS, form-INITIAL_FORMS. You may need to file a bug report if the issue persists.&#39;]</span>
</pre></div>
</div>
<p>And here is a custom error message:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">{},</span> <span class="n">error_messages</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;missing_management_form&quot;</span><span class="p">:</span> <span class="s2">&quot;Sorry, something went wrong.&quot;</span><span class="p">}</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">non_form_errors</span><span class="p">()</span>
<span class="go">[&#39;Sorry, something went wrong.&#39;]</span>
</pre></div>
</div>
<div class="versionchanged">
<span class="title">Changed in Django 4.1:</span> <p>The <code class="docutils literal notranslate"><span class="pre">'too_few_forms'</span></code> and <code class="docutils literal notranslate"><span class="pre">'too_many_forms'</span></code> keys were added.</p>
</div>
</div>
<div class="section" id="s-custom-formset-validation">
<span id="custom-formset-validation"></span><h3>自定义formset验证<a class="headerlink" href="#custom-formset-validation" title="永久链接至标题">¶</a></h3>
<p>A formset has a <code class="docutils literal notranslate"><span class="pre">clean</span></code> method similar to the one on a <code class="docutils literal notranslate"><span class="pre">Form</span></code> class. This
is where you define your own validation that works at the formset level:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">BaseFormSet</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">BaseArticleFormSet</span><span class="p">(</span><span class="n">BaseFormSet</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="sd">&quot;&quot;&quot;Checks that no two articles have the same title.&quot;&quot;&quot;</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">):</span>
<span class="gp">... </span>            <span class="c1"># Don&#39;t bother validating the formset unless each form is valid on its own</span>
<span class="gp">... </span>            <span class="k">return</span>
<span class="gp">... </span>        <span class="n">titles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="gp">... </span>        <span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forms</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_delete</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_delete_form</span><span class="p">(</span><span class="n">form</span><span class="p">):</span>
<span class="gp">... </span>                <span class="k">continue</span>
<span class="gp">... </span>            <span class="n">title</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
<span class="gp">... </span>            <span class="k">if</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">titles</span><span class="p">:</span>
<span class="gp">... </span>                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Articles in a set must have distinct titles.&quot;</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">titles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">,</span> <span class="n">formset</span><span class="o">=</span><span class="n">BaseArticleFormSet</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-title&quot;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-pub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;1904-06-16&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-1-title&quot;</span><span class="p">:</span> <span class="s2">&quot;Test&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-1-pub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;1912-06-23&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">errors</span>
<span class="go">[{}, {}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">non_form_errors</span><span class="p">()</span>
<span class="go">[&#39;Articles in a set must have distinct titles.&#39;]</span>
</pre></div>
</div>
<p>formset的 <code class="docutils literal notranslate"><span class="pre">clean</span></code> 方法会在所有 <code class="docutils literal notranslate"><span class="pre">Form.clean</span></code> 方法调用完之后被调用。可以使用formset的 <code class="docutils literal notranslate"><span class="pre">non_form_errors()</span></code> 方法来查看错误信息。</p>
<p>非表单错误将用一个额外的类 <code class="docutils literal notranslate"><span class="pre">nonform</span></code> 来呈现，以帮助区分它们与表单特定错误。例如，<code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">formset.non_form_errors</span> <span class="pre">}}</span></code> 将看起来像:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;errorlist nonform&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>Articles in a set must have distinct titles.<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-validating-the-number-of-forms-in-a-formset">
<span id="validating-the-number-of-forms-in-a-formset"></span><h2>验证formset中表单的数量<a class="headerlink" href="#validating-the-number-of-forms-in-a-formset" title="永久链接至标题">¶</a></h2>
<p>Django提供了一对方法来验证已提交的表单的最小和最大数量。如果要对应用程序进行更多的可定制验证，那需要使用自定义formset验证。</p>
<div class="section" id="s-validate-max">
<span id="s-id3"></span><span id="validate-max"></span><span id="id3"></span><h3><code class="docutils literal notranslate"><span class="pre">validate_max</span></code><a class="headerlink" href="#validate-max" title="永久链接至标题">¶</a></h3>
<p>如果方法 <a class="reference internal" href="../../ref/forms/formsets.html#django.forms.formsets.formset_factory" title="django.forms.formsets.formset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">formset_factory()</span></code></a> 有设置参数 <code class="docutils literal notranslate"><span class="pre">validate_max=True</span></code> ，验证还会检查数据集内表单的数量，减去那些被标记为删除的表单数量，剩余数量需小于等于 <code class="docutils literal notranslate"><span class="pre">max_num</span></code> 。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">,</span> <span class="n">max_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">validate_max</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;form-0-title&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;form-0-pub_date&#39;</span><span class="p">:</span> <span class="s1">&#39;1904-06-16&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;form-1-title&#39;</span><span class="p">:</span> <span class="s1">&#39;Test 2&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;form-1-pub_date&#39;</span><span class="p">:</span> <span class="s1">&#39;1912-06-23&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">errors</span>
<span class="go">[{}, {}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">non_form_errors</span><span class="p">()</span>
<span class="go">[&#39;Please submit at most 1 form.&#39;]</span>
</pre></div>
</div>
<p>即使因为提供的初始数据量过大而超过了 <code class="docutils literal notranslate"><span class="pre">max_num</span></code> 所定义的，<code class="docutils literal notranslate"><span class="pre">validate_max=True</span></code> 还是会严格针对 <code class="docutils literal notranslate"><span class="pre">max_num</span></code> 进行验证。</p>
<p>The error message can be customized by passing the <code class="docutils literal notranslate"><span class="pre">'too_many_forms'</span></code> message
to the <a class="reference internal" href="#formsets-error-messages"><span class="std std-ref">error_messages</span></a> argument.</p>
<div class="admonition note">
<p class="first admonition-title">备注</p>
<p class="last">不管 <code class="docutils literal notranslate"><span class="pre">validate_max</span></code> 如何，如果数据集中的表单数量超过 <code class="docutils literal notranslate"><span class="pre">absolute_max</span></code>，那么表单将无法验证，就像 <code class="docutils literal notranslate"><span class="pre">validate_max</span></code> 被设置一样，另外只有第一个 <code class="docutils literal notranslate"><span class="pre">absolute_max</span></code> 的表单会被验证。其余的将被完全截断。这是为了防止使用伪造的 POST 请求的内存耗尽攻击。参见 <a class="reference internal" href="#formsets-absolute-max"><span class="std std-ref">限制实例化表单的最大数量</span></a>。</p>
</div>
</div>
<div class="section" id="s-validate-min">
<span id="validate-min"></span><h3><code class="docutils literal notranslate"><span class="pre">validate_min</span></code><a class="headerlink" href="#validate-min" title="永久链接至标题">¶</a></h3>
<p>如果方法 <a class="reference internal" href="../../ref/forms/formsets.html#django.forms.formsets.formset_factory" title="django.forms.formsets.formset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">formset_factory()</span></code></a> 有传参数 <code class="docutils literal notranslate"><span class="pre">validate_min=True</span></code> ，还会验证数据集中的表单的数量减去那些被标记为删除的表单数量是否大于或等于 <code class="docutils literal notranslate"><span class="pre">min_num</span></code> 定义的数量。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">,</span> <span class="n">min_num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">validate_min</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;form-TOTAL_FORMS&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;form-INITIAL_FORMS&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;form-0-title&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;form-0-pub_date&#39;</span><span class="p">:</span> <span class="s1">&#39;1904-06-16&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;form-1-title&#39;</span><span class="p">:</span> <span class="s1">&#39;Test 2&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;form-1-pub_date&#39;</span><span class="p">:</span> <span class="s1">&#39;1912-06-23&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">errors</span>
<span class="go">[{}, {}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">non_form_errors</span><span class="p">()</span>
<span class="go">[&#39;Please submit at least 3 forms.&#39;]</span>
</pre></div>
</div>
<p>The error message can be customized by passing the <code class="docutils literal notranslate"><span class="pre">'too_few_forms'</span></code> message
to the <a class="reference internal" href="#formsets-error-messages"><span class="std std-ref">error_messages</span></a> argument.</p>
<div class="admonition note">
<p class="first admonition-title">备注</p>
<p class="last">无论 <code class="docutils literal notranslate"><span class="pre">validate_min</span></code> 的值是什么，如果一个 formset 不包含任何数据，那么将显示 <code class="docutils literal notranslate"><span class="pre">extra</span> <span class="pre">+</span> <span class="pre">min_num</span></code> 空表单。</p>
</div>
</div>
</div>
<div class="section" id="s-dealing-with-ordering-and-deletion-of-forms">
<span id="dealing-with-ordering-and-deletion-of-forms"></span><h2>处理表单的排序和删除<a class="headerlink" href="#dealing-with-ordering-and-deletion-of-forms" title="永久链接至标题">¶</a></h2>
<p>方法 <a class="reference internal" href="../../ref/forms/formsets.html#django.forms.formsets.formset_factory" title="django.forms.formsets.formset_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">formset_factory()</span></code></a> 提供了两个可选参数 <code class="docutils literal notranslate"><span class="pre">can_order</span></code> 和 <code class="docutils literal notranslate"><span class="pre">can_delete</span></code> 来协助处理formset中表单的排序和删除。</p>
<div class="section" id="s-can-order">
<span id="can-order"></span><h3><code class="docutils literal notranslate"><span class="pre">can_order</span></code><a class="headerlink" href="#can-order" title="永久链接至标题">¶</a></h3>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.can_order">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">can_order</span></code><a class="headerlink" href="#django.forms.formsets.BaseFormSet.can_order" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>默认值： <code class="docutils literal notranslate"><span class="pre">False</span></code></p>
<p>Lets you create a formset with the ability to order:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">,</span> <span class="n">can_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">initial</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #1&quot;</span><span class="p">,</span> <span class="s2">&quot;pub_date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #2&quot;</span><span class="p">,</span> <span class="s2">&quot;pub_date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">)},</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="n">formset</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">as_table</span><span class="p">())</span>
<span class="gp">...</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-title&quot;&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-title&quot; value=&quot;Article #1&quot; id=&quot;id_form-0-title&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-pub_date&quot;&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-pub_date&quot; value=&quot;2008-05-10&quot; id=&quot;id_form-0-pub_date&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-ORDER&quot;&gt;Order:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;number&quot; name=&quot;form-0-ORDER&quot; value=&quot;1&quot; id=&quot;id_form-0-ORDER&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-1-title&quot;&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-1-title&quot; value=&quot;Article #2&quot; id=&quot;id_form-1-title&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-1-pub_date&quot;&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-1-pub_date&quot; value=&quot;2008-05-11&quot; id=&quot;id_form-1-pub_date&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-1-ORDER&quot;&gt;Order:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;number&quot; name=&quot;form-1-ORDER&quot; value=&quot;2&quot; id=&quot;id_form-1-ORDER&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-2-title&quot;&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-2-title&quot; id=&quot;id_form-2-title&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-2-pub_date&quot;&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-2-pub_date&quot; id=&quot;id_form-2-pub_date&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-2-ORDER&quot;&gt;Order:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;number&quot; name=&quot;form-2-ORDER&quot; id=&quot;id_form-2-ORDER&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
</pre></div>
</div>
<p>This adds an additional field to each form. This new field is named <code class="docutils literal notranslate"><span class="pre">ORDER</span></code>
and is an <code class="docutils literal notranslate"><span class="pre">forms.IntegerField</span></code>. For the forms that came from the initial
data it automatically assigned them a numeric value. Let's look at what will
happen when the user changes these values:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #1&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-pub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2008-05-10&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-ORDER&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-1-title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #2&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-1-pub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2008-05-11&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-1-ORDER&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-2-title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #3&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-2-pub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2008-05-01&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-2-ORDER&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">initial</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #1&quot;</span><span class="p">,</span> <span class="s2">&quot;pub_date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #2&quot;</span><span class="p">,</span> <span class="s2">&quot;pub_date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">)},</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="n">formset</span><span class="o">.</span><span class="n">ordered_forms</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">{&#39;pub_date&#39;: datetime.date(2008, 5, 1), &#39;ORDER&#39;: 0, &#39;title&#39;: &#39;Article #3&#39;}</span>
<span class="go">{&#39;pub_date&#39;: datetime.date(2008, 5, 11), &#39;ORDER&#39;: 1, &#39;title&#39;: &#39;Article #2&#39;}</span>
<span class="go">{&#39;pub_date&#39;: datetime.date(2008, 5, 10), &#39;ORDER&#39;: 2, &#39;title&#39;: &#39;Article #1&#39;}</span>
</pre></div>
</div>
<p><a class="reference internal" href="#django.forms.formsets.BaseFormSet" title="django.forms.formsets.BaseFormSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseFormSet</span></code></a> 也提供了 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.ordering_widget" title="django.forms.formsets.BaseFormSet.ordering_widget"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ordering_widget</span></code></a> 属性和 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.get_ordering_widget" title="django.forms.formsets.BaseFormSet.get_ordering_widget"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_ordering_widget()</span></code></a> 方法，来控制与 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.can_order" title="django.forms.formsets.BaseFormSet.can_order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_order</span></code></a> 一起使用的小部件。</p>
<div class="section" id="s-ordering-widget">
<span id="ordering-widget"></span><h4><code class="docutils literal notranslate"><span class="pre">ordering_widget</span></code><a class="headerlink" href="#ordering-widget" title="永久链接至标题">¶</a></h4>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.ordering_widget">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">ordering_widget</span></code><a class="headerlink" href="#django.forms.formsets.BaseFormSet.ordering_widget" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>默认: <a class="reference internal" href="../../ref/forms/widgets.html#django.forms.NumberInput" title="django.forms.NumberInput"><code class="xref py py-class docutils literal notranslate"><span class="pre">NumberInput</span></code></a></p>
<p>Set <code class="docutils literal notranslate"><span class="pre">ordering_widget</span></code> to specify the widget class to be used with
<code class="docutils literal notranslate"><span class="pre">can_order</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">BaseFormSet</span><span class="p">,</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">BaseArticleFormSet</span><span class="p">(</span><span class="n">BaseFormSet</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">ordering_widget</span> <span class="o">=</span> <span class="n">HiddenInput</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">ArticleForm</span><span class="p">,</span> <span class="n">formset</span><span class="o">=</span><span class="n">BaseArticleFormSet</span><span class="p">,</span> <span class="n">can_order</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-get-ordering-widget">
<span id="get-ordering-widget"></span><h4><code class="docutils literal notranslate"><span class="pre">get_ordering_widget</span></code><a class="headerlink" href="#get-ordering-widget" title="永久链接至标题">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.get_ordering_widget">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">get_ordering_widget</span></code>()<a class="headerlink" href="#django.forms.formsets.BaseFormSet.get_ordering_widget" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>Override <code class="docutils literal notranslate"><span class="pre">get_ordering_widget()</span></code> if you need to provide a widget instance for
use with <code class="docutils literal notranslate"><span class="pre">can_order</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">BaseFormSet</span><span class="p">,</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">BaseArticleFormSet</span><span class="p">(</span><span class="n">BaseFormSet</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">get_ordering_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">HiddenInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;ordering&quot;</span><span class="p">})</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">ArticleForm</span><span class="p">,</span> <span class="n">formset</span><span class="o">=</span><span class="n">BaseArticleFormSet</span><span class="p">,</span> <span class="n">can_order</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-can-delete">
<span id="can-delete"></span><h3><code class="docutils literal notranslate"><span class="pre">can_delete</span></code><a class="headerlink" href="#can-delete" title="永久链接至标题">¶</a></h3>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.can_delete">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">can_delete</span></code><a class="headerlink" href="#django.forms.formsets.BaseFormSet.can_delete" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>默认值： <code class="docutils literal notranslate"><span class="pre">False</span></code></p>
<p>Lets you create a formset with the ability to select forms for deletion:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">initial</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #1&quot;</span><span class="p">,</span> <span class="s2">&quot;pub_date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #2&quot;</span><span class="p">,</span> <span class="s2">&quot;pub_date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">)},</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="n">formset</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">as_table</span><span class="p">())</span>
<span class="gp">...</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-title&quot;&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-title&quot; value=&quot;Article #1&quot; id=&quot;id_form-0-title&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-pub_date&quot;&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-pub_date&quot; value=&quot;2008-05-10&quot; id=&quot;id_form-0-pub_date&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-DELETE&quot;&gt;Delete:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;form-0-DELETE&quot; id=&quot;id_form-0-DELETE&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-1-title&quot;&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-1-title&quot; value=&quot;Article #2&quot; id=&quot;id_form-1-title&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-1-pub_date&quot;&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-1-pub_date&quot; value=&quot;2008-05-11&quot; id=&quot;id_form-1-pub_date&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-1-DELETE&quot;&gt;Delete:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;form-1-DELETE&quot; id=&quot;id_form-1-DELETE&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-2-title&quot;&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-2-title&quot; id=&quot;id_form-2-title&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-2-pub_date&quot;&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-2-pub_date&quot; id=&quot;id_form-2-pub_date&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-2-DELETE&quot;&gt;Delete:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;checkbox&quot; name=&quot;form-2-DELETE&quot; id=&quot;id_form-2-DELETE&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
</pre></div>
</div>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">can_order</span></code> this adds a new field to each form named <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>
and is a <code class="docutils literal notranslate"><span class="pre">forms.BooleanField</span></code>. When data comes through marking any of the
delete fields you can access them with <code class="docutils literal notranslate"><span class="pre">deleted_forms</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s2">&quot;form-TOTAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-INITIAL_FORMS&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #1&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-pub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2008-05-10&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-0-DELETE&quot;</span><span class="p">:</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-1-title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #2&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-1-pub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2008-05-11&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-1-DELETE&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-2-title&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-2-pub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s2">&quot;form-2-DELETE&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">data</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">initial</span><span class="o">=</span><span class="p">[</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #1&quot;</span><span class="p">,</span> <span class="s2">&quot;pub_date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span>
<span class="gp">... </span>        <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Article #2&quot;</span><span class="p">,</span> <span class="s2">&quot;pub_date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">)},</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span> <span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="n">formset</span><span class="o">.</span><span class="n">deleted_forms</span><span class="p">]</span>
<span class="go">[{&#39;DELETE&#39;: True, &#39;pub_date&#39;: datetime.date(2008, 5, 10), &#39;title&#39;: &#39;Article #1&#39;}]</span>
</pre></div>
</div>
<p>如果你使用 <a class="reference internal" href="modelforms.html#django.forms.models.BaseModelFormSet" title="django.forms.models.BaseModelFormSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelFormSet</span></code></a> ，那些标记为删除的表单模型实例会在调用 <code class="docutils literal notranslate"><span class="pre">formset.save()</span></code> 时被删除。</p>
<p>If you call <code class="docutils literal notranslate"><span class="pre">formset.save(commit=False)</span></code>, objects will not be deleted
automatically.  You'll need to call <code class="docutils literal notranslate"><span class="pre">delete()</span></code> on each of the
<a class="reference internal" href="modelforms.html#django.forms.models.BaseModelFormSet.deleted_objects" title="django.forms.models.BaseModelFormSet.deleted_objects"><code class="xref py py-attr docutils literal notranslate"><span class="pre">formset.deleted_objects</span></code></a> to actually delete
them:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">instances</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">formset</span><span class="o">.</span><span class="n">deleted_objects</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>另一方面，如果您使用的是普通的 <code class="docutils literal notranslate"><span class="pre">FormSet</span></code> ，那需要您自己去处理 <code class="docutils literal notranslate"><span class="pre">formset.deleted_forms</span></code> ，可能写在formset的 <code class="docutils literal notranslate"><span class="pre">save()</span></code> 方法中，因为对于阐述删除一张表单还没有一个通用的概念。</p>
<p><a class="reference internal" href="#django.forms.formsets.BaseFormSet" title="django.forms.formsets.BaseFormSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseFormSet</span></code></a> 也提供了一个 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.deletion_widget" title="django.forms.formsets.BaseFormSet.deletion_widget"><code class="xref py py-attr docutils literal notranslate"><span class="pre">deletion_widget</span></code></a> 属性和 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.get_deletion_widget" title="django.forms.formsets.BaseFormSet.get_deletion_widget"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_deletion_widget()</span></code></a> 方法，控制用于 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.can_delete" title="django.forms.formsets.BaseFormSet.can_delete"><code class="xref py py-attr docutils literal notranslate"><span class="pre">can_delete</span></code></a> 的部件。</p>
<div class="section" id="s-deletion-widget">
<span id="deletion-widget"></span><h4><code class="docutils literal notranslate"><span class="pre">deletion_widget</span></code><a class="headerlink" href="#deletion-widget" title="永久链接至标题">¶</a></h4>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.deletion_widget">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">deletion_widget</span></code><a class="headerlink" href="#django.forms.formsets.BaseFormSet.deletion_widget" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>默认： <a class="reference internal" href="../../ref/forms/widgets.html#django.forms.CheckboxInput" title="django.forms.CheckboxInput"><code class="xref py py-class docutils literal notranslate"><span class="pre">CheckboxInput</span></code></a></p>
<p>Set <code class="docutils literal notranslate"><span class="pre">deletion_widget</span></code> to specify the widget class to be used with
<code class="docutils literal notranslate"><span class="pre">can_delete</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">BaseFormSet</span><span class="p">,</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">BaseArticleFormSet</span><span class="p">(</span><span class="n">BaseFormSet</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">deletion_widget</span> <span class="o">=</span> <span class="n">HiddenInput</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">ArticleForm</span><span class="p">,</span> <span class="n">formset</span><span class="o">=</span><span class="n">BaseArticleFormSet</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-get-deletion-widget">
<span id="get-deletion-widget"></span><h4><code class="docutils literal notranslate"><span class="pre">get_deletion_widget</span></code><a class="headerlink" href="#get-deletion-widget" title="永久链接至标题">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.get_deletion_widget">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">get_deletion_widget</span></code>()<a class="headerlink" href="#django.forms.formsets.BaseFormSet.get_deletion_widget" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>Override <code class="docutils literal notranslate"><span class="pre">get_deletion_widget()</span></code> if you need to provide a widget instance for
use with <code class="docutils literal notranslate"><span class="pre">can_delete</span></code>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">BaseFormSet</span><span class="p">,</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">BaseArticleFormSet</span><span class="p">(</span><span class="n">BaseFormSet</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">get_deletion_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">HiddenInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;deletion&quot;</span><span class="p">})</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">ArticleForm</span><span class="p">,</span> <span class="n">formset</span><span class="o">=</span><span class="n">BaseArticleFormSet</span><span class="p">,</span> <span class="n">can_delete</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-can-delete-extra">
<span id="can-delete-extra"></span><h3><code class="docutils literal notranslate"><span class="pre">can_delete_extra</span></code><a class="headerlink" href="#can-delete-extra" title="永久链接至标题">¶</a></h3>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.can_delete_extra">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">can_delete_extra</span></code><a class="headerlink" href="#django.forms.formsets.BaseFormSet.can_delete_extra" title="永久链接至目标">¶</a></dt>
<dd></dd></dl>

<p>默认： <code class="docutils literal notranslate"><span class="pre">True</span></code></p>
<p>在设置 <code class="docutils literal notranslate"><span class="pre">can_delete=True</span></code> 的同时，指定 <code class="docutils literal notranslate"><span class="pre">can_delete_extra=False</span></code> 将移除删除额外表格的选项。</p>
</div>
</div>
<div class="section" id="s-adding-additional-fields-to-a-formset">
<span id="adding-additional-fields-to-a-formset"></span><h2>给一个formset添加额外字段<a class="headerlink" href="#adding-additional-fields-to-a-formset" title="永久链接至标题">¶</a></h2>
<p>If you need to add additional fields to the formset this can be easily
accomplished. The formset base class provides an <code class="docutils literal notranslate"><span class="pre">add_fields</span></code> method. You
can override this method to add your own fields or even redefine the default
fields/attributes of the order and deletion fields:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">BaseFormSet</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">BaseArticleFormSet</span><span class="p">(</span><span class="n">BaseFormSet</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">add_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_fields</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;my_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">,</span> <span class="n">formset</span><span class="o">=</span><span class="n">BaseArticleFormSet</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">form</span> <span class="ow">in</span> <span class="n">formset</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">as_table</span><span class="p">())</span>
<span class="gp">...</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-title&quot;&gt;Title:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-title&quot; id=&quot;id_form-0-title&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-pub_date&quot;&gt;Pub date:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-pub_date&quot; id=&quot;id_form-0-pub_date&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="go">&lt;tr&gt;&lt;th&gt;&lt;label for=&quot;id_form-0-my_field&quot;&gt;My field:&lt;/label&gt;&lt;/th&gt;&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;form-0-my_field&quot; id=&quot;id_form-0-my_field&quot;&gt;&lt;/td&gt;&lt;/tr&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="s-passing-custom-parameters-to-formset-forms">
<span id="s-custom-formset-form-kwargs"></span><span id="passing-custom-parameters-to-formset-forms"></span><span id="custom-formset-form-kwargs"></span><h2>传递自定义参数到formset表单<a class="headerlink" href="#passing-custom-parameters-to-formset-forms" title="永久链接至标题">¶</a></h2>
<p>Sometimes your form class takes custom parameters, like <code class="docutils literal notranslate"><span class="pre">MyArticleForm</span></code>.
You can pass this parameter when instantiating the formset:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">BaseFormSet</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MyArticleForm</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">MyArticleForm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span><span class="n">form_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">})</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">form_kwargs</span></code> may also depend on the specific form instance. The formset
base class provides a <code class="docutils literal notranslate"><span class="pre">get_form_kwargs</span></code> method. The method takes a single
argument - the index of the form in the formset. The index is <code class="docutils literal notranslate"><span class="pre">None</span></code> for the
<a class="reference internal" href="#empty-form"><span class="std std-ref">empty_form</span></a>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">BaseFormSet</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">BaseArticleFormSet</span><span class="p">(</span><span class="n">BaseFormSet</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">get_form_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_form_kwargs</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;custom_kwarg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">kwargs</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">MyArticleForm</span><span class="p">,</span> <span class="n">formset</span><span class="o">=</span><span class="n">BaseArticleFormSet</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="s-customizing-a-formset-s-prefix">
<span id="s-formset-prefix"></span><span id="customizing-a-formset-s-prefix"></span><span id="formset-prefix"></span><h2>自定义formset的前缀<a class="headerlink" href="#customizing-a-formset-s-prefix" title="永久链接至标题">¶</a></h2>
<p>在已渲染的HTML页面中，表单集中的每个字段都包含一个前缀。这个前缀默认是 <code class="docutils literal notranslate"><span class="pre">'form'</span></code> ，但可以使用formset的 <code class="docutils literal notranslate"><span class="pre">prefix</span></code> 参数来自定义。</p>
<p>例如，在默认情况下，您可能会看到:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;id_form-0-title&quot;</span><span class="p">&gt;</span>Title:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;form-0-title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;id_form-0-title&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>但使用 <code class="docutils literal notranslate"><span class="pre">ArticleFormset(prefix='article')</span></code> 的话就会变为：</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;id_article-0-title&quot;</span><span class="p">&gt;</span>Title:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;article-0-title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;id_article-0-title&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>如果您想 :ref:<a href="#id1"><span class="problematic" id="id2">`</span></a>在视图中使用多个formset &lt;multiple-formsets-in-view&gt; ` ，这个参数会很有用。</p>
</div>
<div class="section" id="s-using-a-formset-in-views-and-templates">
<span id="s-formset-rendering"></span><span id="using-a-formset-in-views-and-templates"></span><span id="formset-rendering"></span><h2>在视图和模板中使用formset<a class="headerlink" href="#using-a-formset-in-views-and-templates" title="永久链接至标题">¶</a></h2>
<p>Formsets have the following attributes and methods associated with rendering:</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.renderer">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">renderer</span></code><a class="headerlink" href="#django.forms.formsets.BaseFormSet.renderer" title="永久链接至目标">¶</a></dt>
<dd><p>指定 <a class="reference internal" href="../../ref/forms/renderers.html"><span class="doc">渲染器</span></a> 用于表单集。默认为 <code class="xref std std-setting docutils literal notranslate"><span class="pre">FORM_RENDER</span></code> 配置所指定的渲染器。</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.template_name">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">template_name</span></code><a class="headerlink" href="#django.forms.formsets.BaseFormSet.template_name" title="永久链接至目标">¶</a></dt>
<dd><p>The name of the template rendered if the formset is cast into a string,
e.g. via <code class="docutils literal notranslate"><span class="pre">print(formset)</span></code> or in a template via <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">formset</span> <span class="pre">}}</span></code>.</p>
<p>By default, a property returning the value of the renderer's
<a class="reference internal" href="../../ref/forms/renderers.html#django.forms.renderers.BaseRenderer.formset_template_name" title="django.forms.renderers.BaseRenderer.formset_template_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">formset_template_name</span></code></a>. You may
set it as a string template name in order to override that for a particular
formset class.</p>
<p>This template will be used to render the formset's management form, and
then each form in the formset as per the template defined by the form's
<a class="reference internal" href="../../ref/forms/api.html#django.forms.Form.template_name" title="django.forms.Form.template_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">template_name</span></code></a>.</p>
<div class="versionchanged">
<span class="title">Changed in Django 4.1:</span> <p>In older versions <code class="docutils literal notranslate"><span class="pre">template_name</span></code> defaulted to the string value
<code class="docutils literal notranslate"><span class="pre">'django/forms/formset/default.html'</span></code>.</p>
</div>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.template_name_div">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">template_name_div</span></code><a class="headerlink" href="#django.forms.formsets.BaseFormSet.template_name_div" title="永久链接至目标">¶</a></dt>
<dd><div class="versionadded">
<span class="title">New in Django 4.1.</span> </div>
<p>The name of the template used when calling <a class="reference internal" href="#django.forms.formsets.BaseFormSet.as_div" title="django.forms.formsets.BaseFormSet.as_div"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_div()</span></code></a>. By default this
is <code class="docutils literal notranslate"><span class="pre">&quot;django/forms/formsets/div.html&quot;</span></code>. This template renders the
formset's management form and then each form in the formset as per the
form's <a class="reference internal" href="../../ref/forms/api.html#django.forms.Form.as_div" title="django.forms.Form.as_div"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_div()</span></code></a> method.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.template_name_p">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">template_name_p</span></code><a class="headerlink" href="#django.forms.formsets.BaseFormSet.template_name_p" title="永久链接至目标">¶</a></dt>
<dd><p>The name of the template used when calling <a class="reference internal" href="#django.forms.formsets.BaseFormSet.as_p" title="django.forms.formsets.BaseFormSet.as_p"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_p()</span></code></a>. By default this
is <code class="docutils literal notranslate"><span class="pre">&quot;django/forms/formsets/p.html&quot;</span></code>. This template renders the formset's
management form and then each form in the formset as per the form's
<a class="reference internal" href="../../ref/forms/api.html#django.forms.Form.as_p" title="django.forms.Form.as_p"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_p()</span></code></a> method.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.template_name_table">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">template_name_table</span></code><a class="headerlink" href="#django.forms.formsets.BaseFormSet.template_name_table" title="永久链接至目标">¶</a></dt>
<dd><p>The name of the template used when calling <a class="reference internal" href="#django.forms.formsets.BaseFormSet.as_table" title="django.forms.formsets.BaseFormSet.as_table"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_table()</span></code></a>. By default
this is <code class="docutils literal notranslate"><span class="pre">&quot;django/forms/formsets/table.html&quot;</span></code>. This template renders the
formset's management form and then each form in the formset as per the
form's <a class="reference internal" href="../../ref/forms/api.html#django.forms.Form.as_table" title="django.forms.Form.as_table"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_table()</span></code></a> method.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.template_name_ul">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">template_name_ul</span></code><a class="headerlink" href="#django.forms.formsets.BaseFormSet.template_name_ul" title="永久链接至目标">¶</a></dt>
<dd><p>The name of the template used when calling <a class="reference internal" href="#django.forms.formsets.BaseFormSet.as_ul" title="django.forms.formsets.BaseFormSet.as_ul"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_ul()</span></code></a>. By default this
is <code class="docutils literal notranslate"><span class="pre">&quot;django/forms/formsets/ul.html&quot;</span></code>. This template renders the formset's
management form and then each form in the formset as per the form's
<a class="reference internal" href="../../ref/forms/api.html#django.forms.Form.as_ul" title="django.forms.Form.as_ul"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_ul()</span></code></a> method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.get_context">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">get_context</span></code>()<a class="headerlink" href="#django.forms.formsets.BaseFormSet.get_context" title="永久链接至目标">¶</a></dt>
<dd><p>返回用于在模板中渲染表单集的上下文。</p>
<p>可用的上下文：</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">formset</span></code>：表单集的实例。</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.render">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">render</span></code>(<em><span class="n"><span class="pre">template_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">context</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">renderer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>)<a class="headerlink" href="#django.forms.formsets.BaseFormSet.render" title="永久链接至目标">¶</a></dt>
<dd><p>The render method is called by <code class="docutils literal notranslate"><span class="pre">__str__</span></code> as well as the <a class="reference internal" href="#django.forms.formsets.BaseFormSet.as_div" title="django.forms.formsets.BaseFormSet.as_div"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_div()</span></code></a>,
<a class="reference internal" href="#django.forms.formsets.BaseFormSet.as_p" title="django.forms.formsets.BaseFormSet.as_p"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_p()</span></code></a>, <a class="reference internal" href="#django.forms.formsets.BaseFormSet.as_ul" title="django.forms.formsets.BaseFormSet.as_ul"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_ul()</span></code></a>, and <a class="reference internal" href="#django.forms.formsets.BaseFormSet.as_table" title="django.forms.formsets.BaseFormSet.as_table"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_table()</span></code></a> methods. All arguments
are optional and will default to:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">template_name</span></code>： <a class="reference internal" href="#django.forms.formsets.BaseFormSet.template_name" title="django.forms.formsets.BaseFormSet.template_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">template_name</span></code></a></li>
<li><code class="docutils literal notranslate"><span class="pre">context</span></code>： 由 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.get_context" title="django.forms.formsets.BaseFormSet.get_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_context()</span></code></a> 返回的值</li>
<li><code class="docutils literal notranslate"><span class="pre">renderer</span></code>： 由 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.renderer" title="django.forms.formsets.BaseFormSet.renderer"><code class="xref py py-attr docutils literal notranslate"><span class="pre">renderer</span></code></a> 返回的值</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.as_div">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">as_div</span></code>()<a class="headerlink" href="#django.forms.formsets.BaseFormSet.as_div" title="永久链接至目标">¶</a></dt>
<dd><div class="versionadded">
<span class="title">New in Django 4.1.</span> </div>
<p>Renders the formset with the <a class="reference internal" href="#django.forms.formsets.BaseFormSet.template_name_div" title="django.forms.formsets.BaseFormSet.template_name_div"><code class="xref py py-attr docutils literal notranslate"><span class="pre">template_name_div</span></code></a> template.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.as_p">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">as_p</span></code>()<a class="headerlink" href="#django.forms.formsets.BaseFormSet.as_p" title="永久链接至目标">¶</a></dt>
<dd><p>用 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.template_name_p" title="django.forms.formsets.BaseFormSet.template_name_p"><code class="xref py py-attr docutils literal notranslate"><span class="pre">template_name_p</span></code></a> 模板渲染表单集。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.as_table">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">as_table</span></code>()<a class="headerlink" href="#django.forms.formsets.BaseFormSet.as_table" title="永久链接至目标">¶</a></dt>
<dd><p>使用 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.template_name_table" title="django.forms.formsets.BaseFormSet.template_name_table"><code class="xref py py-attr docutils literal notranslate"><span class="pre">template_name_table</span></code></a> 模板渲染表单集。</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="django.forms.formsets.BaseFormSet.as_ul">
<code class="sig-prename descclassname"><span class="pre">BaseFormSet.</span></code><code class="sig-name descname"><span class="pre">as_ul</span></code>()<a class="headerlink" href="#django.forms.formsets.BaseFormSet.as_ul" title="永久链接至目标">¶</a></dt>
<dd><p>用 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.template_name_ul" title="django.forms.formsets.BaseFormSet.template_name_ul"><code class="xref py py-attr docutils literal notranslate"><span class="pre">template_name_ul</span></code></a> 模板渲染表单集。</p>
</dd></dl>

<p>在视图中使用formset与使用常规的 <code class="docutils literal notranslate"><span class="pre">Form</span></code> 类没有太多不同之处。你唯一需要注意的是确保要在模板中使用管理表单。我们来看一个示例视图：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span>


<span class="k">def</span> <span class="nf">manage_articles</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c1"># do something with the formset.cleaned_data</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;manage_articles.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;formset&quot;</span><span class="p">:</span> <span class="n">formset</span><span class="p">})</span>
</pre></div>
</div>
<p>模板 <code class="docutils literal notranslate"><span class="pre">manage_articles.html</span></code> 可能如下所示：</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">formset.management_form</span> <span class="cp">}}</span>
    <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">form</span> <span class="k">in</span> <span class="nv">formset</span> <span class="cp">%}</span>
        <span class="cp">{{</span> <span class="nv">form</span> <span class="cp">}}</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>但是对于上面让formset自己处理管理表单，还有个小小的捷径：</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
        <span class="cp">{{</span> <span class="nv">formset</span> <span class="cp">}}</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>上面的内容最终会调用表单集类上的 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.render" title="django.forms.formsets.BaseFormSet.render"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BaseFormSet.render()</span></code></a> 方法。这将使用 <a class="reference internal" href="#django.forms.formsets.BaseFormSet.template_name" title="django.forms.formsets.BaseFormSet.template_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">template_name</span></code></a> 属性指定的模板来渲染表单集。与表单类似，默认情况下，表单集将被渲染为 <code class="docutils literal notranslate"><span class="pre">as_table</span></code>，其他辅助方法 <code class="docutils literal notranslate"><span class="pre">as_p</span></code> 和 <code class="docutils literal notranslate"><span class="pre">as_ul</span></code> 可用。表单集的渲染可以通过指定 <code class="docutils literal notranslate"><span class="pre">template_name</span></code> 属性来定制，或者更普遍的是通过 <a class="reference internal" href="../../ref/forms/renderers.html#overriding-built-in-formset-templates"><span class="std std-ref">覆盖默认模板</span></a>。</p>
<div class="section" id="s-manually-rendered-can-delete-and-can-order">
<span id="s-id4"></span><span id="manually-rendered-can-delete-and-can-order"></span><span id="id4"></span><h3>手动渲染 <code class="docutils literal notranslate"><span class="pre">can_delete</span></code> 和 <code class="docutils literal notranslate"><span class="pre">can_order</span></code><a class="headerlink" href="#manually-rendered-can-delete-and-can-order" title="永久链接至标题">¶</a></h3>
<p>如果您在模板中手动渲染字段，您可以用 <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">form.DELETE</span> <span class="pre">}}</span></code> 来渲染参数 <code class="docutils literal notranslate"><span class="pre">can_delete</span></code> 。</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
    <span class="cp">{{</span> <span class="nv">formset.management_form</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">form</span> <span class="k">in</span> <span class="nv">formset</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.pub_date</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">if</span> <span class="nv">formset.can_delete</span> <span class="cp">%}</span>
                <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.DELETE</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
            <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>同样，如果formset能排序( <code class="docutils literal notranslate"><span class="pre">can_order=True</span></code> )，可以用 <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">form.ORDER</span> <span class="pre">}}</span></code> 来渲染它。</p>
</div>
<div class="section" id="s-using-more-than-one-formset-in-a-view">
<span id="s-multiple-formsets-in-view"></span><span id="using-more-than-one-formset-in-a-view"></span><span id="multiple-formsets-in-view"></span><h3>在视图中使用多个formset<a class="headerlink" href="#using-more-than-one-formset-in-a-view" title="永久链接至标题">¶</a></h3>
<p>你可以在视图中使用多个formset。表单集从表单上借鉴了很多行为。像之前说的，你可以使用参数 <code class="docutils literal notranslate"><span class="pre">prefix</span></code> 来给formset中表单的字段附上前缀，以避免多个formset的数据传到同一个视图而引起名称冲突。让我们来看下这是如何实现的：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.forms</span> <span class="kn">import</span> <span class="n">formset_factory</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">myapp.forms</span> <span class="kn">import</span> <span class="n">ArticleForm</span><span class="p">,</span> <span class="n">BookForm</span>


<span class="k">def</span> <span class="nf">manage_articles</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">ArticleFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">ArticleForm</span><span class="p">)</span>
    <span class="n">BookFormSet</span> <span class="o">=</span> <span class="n">formset_factory</span><span class="p">(</span><span class="n">BookForm</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">article_formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;articles&quot;</span><span class="p">)</span>
        <span class="n">book_formset</span> <span class="o">=</span> <span class="n">BookFormSet</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;books&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">article_formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span> <span class="ow">and</span> <span class="n">book_formset</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c1"># do something with the cleaned_data on the formsets.</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">article_formset</span> <span class="o">=</span> <span class="n">ArticleFormSet</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;articles&quot;</span><span class="p">)</span>
        <span class="n">book_formset</span> <span class="o">=</span> <span class="n">BookFormSet</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;books&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span>
        <span class="n">request</span><span class="p">,</span>
        <span class="s2">&quot;manage_articles.html&quot;</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="s2">&quot;article_formset&quot;</span><span class="p">:</span> <span class="n">article_formset</span><span class="p">,</span>
            <span class="s2">&quot;book_formset&quot;</span><span class="p">:</span> <span class="n">book_formset</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>然后您就可以像平时那样渲染表单集。需要指出的是，您需要同时在POST和非POST情况下传递 <code class="docutils literal notranslate"><span class="pre">prefix</span></code> ，以便它能被正确渲染和处理。</p>
<p>每个formset的 <a class="reference internal" href="#formset-prefix"><span class="std std-ref">prefix</span></a> 会替换添加到每个字段的 <code class="docutils literal notranslate"><span class="pre">name</span></code> 和 <code class="docutils literal notranslate"><span class="pre">id</span></code> HTML属性的默认 <code class="docutils literal notranslate"><span class="pre">form</span></code> 前缀。</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">表单集</a><ul>
<li><a class="reference internal" href="#using-initial-data-with-a-formset">使用formset的初始数据</a></li>
<li><a class="reference internal" href="#limiting-the-maximum-number-of-forms">限制表单的最大数量</a></li>
<li><a class="reference internal" href="#limiting-the-maximum-number-of-instantiated-forms">限制实例化表单的最大数量</a></li>
<li><a class="reference internal" href="#formset-validation">Formset验证</a><ul>
<li><a class="reference internal" href="#understanding-the-managementform">理解 <code class="docutils literal notranslate"><span class="pre">ManagementForm</span></code></a></li>
<li><a class="reference internal" href="#total-form-count-and-initial-form-count"><code class="docutils literal notranslate"><span class="pre">total_form_count</span></code> 和 <code class="docutils literal notranslate"><span class="pre">initial_form_count</span></code></a></li>
<li><a class="reference internal" href="#empty-form"><code class="docutils literal notranslate"><span class="pre">empty_form</span></code></a></li>
<li><a class="reference internal" href="#error-messages"><code class="docutils literal notranslate"><span class="pre">error_messages</span></code></a></li>
<li><a class="reference internal" href="#custom-formset-validation">自定义formset验证</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validating-the-number-of-forms-in-a-formset">验证formset中表单的数量</a><ul>
<li><a class="reference internal" href="#validate-max"><code class="docutils literal notranslate"><span class="pre">validate_max</span></code></a></li>
<li><a class="reference internal" href="#validate-min"><code class="docutils literal notranslate"><span class="pre">validate_min</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#dealing-with-ordering-and-deletion-of-forms">处理表单的排序和删除</a><ul>
<li><a class="reference internal" href="#can-order"><code class="docutils literal notranslate"><span class="pre">can_order</span></code></a><ul>
<li><a class="reference internal" href="#ordering-widget"><code class="docutils literal notranslate"><span class="pre">ordering_widget</span></code></a></li>
<li><a class="reference internal" href="#get-ordering-widget"><code class="docutils literal notranslate"><span class="pre">get_ordering_widget</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#can-delete"><code class="docutils literal notranslate"><span class="pre">can_delete</span></code></a><ul>
<li><a class="reference internal" href="#deletion-widget"><code class="docutils literal notranslate"><span class="pre">deletion_widget</span></code></a></li>
<li><a class="reference internal" href="#get-deletion-widget"><code class="docutils literal notranslate"><span class="pre">get_deletion_widget</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#can-delete-extra"><code class="docutils literal notranslate"><span class="pre">can_delete_extra</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-additional-fields-to-a-formset">给一个formset添加额外字段</a></li>
<li><a class="reference internal" href="#passing-custom-parameters-to-formset-forms">传递自定义参数到formset表单</a></li>
<li><a class="reference internal" href="#customizing-a-formset-s-prefix">自定义formset的前缀</a></li>
<li><a class="reference internal" href="#using-a-formset-in-views-and-templates">在视图和模板中使用formset</a><ul>
<li><a class="reference internal" href="#manually-rendered-can-delete-and-can-order">手动渲染 <code class="docutils literal notranslate"><span class="pre">can_delete</span></code> 和 <code class="docutils literal notranslate"><span class="pre">can_order</span></code></a></li>
<li><a class="reference internal" href="#using-more-than-one-formset-in-a-view">在视图中使用多个formset</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="index.html"
                          title="上一章">使用表单</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="modelforms.html"
                          title="下一章">从模型创建表单</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../../sources/topics/forms/formsets.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">9月 04, 2023</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="index.html" title="使用表单">previous</a>
     |
    <a href="../index.html" title="使用 Django" accesskey="U">up</a>
   |
    <a href="modelforms.html" title="从模型创建表单">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>