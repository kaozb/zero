
<!DOCTYPE html>

<html lang="zh_Hans">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Django 4.2 release notes &#8212; Django 4.2.6.dev20230904111759 文档</title>
    <link rel="stylesheet" type="text/css" href="../static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../static/default.css" />
    <script data-url_root="../" id="documentation_options" src="../static/documentation_options.js"></script>
    <script src="../static/jquery.js"></script>
    <script src="../static/underscore.js"></script>
    <script src="../static/doctools.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Django 4.1.11 release notes" href="4.1.11.html" />
    <link rel="prev" title="Django 4.2.1 release notes" href="4.2.1.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Django 4.2.6.dev20230904111759 文档</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="4.2.1.html" title="Django 4.2.1 release notes">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="4.1.11.html" title="Django 4.1.11 release notes">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="releases-4.2">
            
  <div class="section" id="s-django-4-2-release-notes">
<span id="django-4-2-release-notes"></span><h1>Django 4.2 release notes<a class="headerlink" href="#django-4-2-release-notes" title="永久链接至标题">¶</a></h1>
<p><em>April 3, 2023</em></p>
<p>Welcome to Django 4.2!</p>
<p>These release notes cover the <a class="reference internal" href="#whats-new-4-2"><span class="std std-ref">new features</span></a>, as well as
some <a class="reference internal" href="#backwards-incompatible-4-2"><span class="std std-ref">backwards incompatible changes</span></a> you'll
want to be aware of when upgrading from Django 4.1 or earlier. We've
<a class="reference internal" href="#deprecated-features-4-2"><span class="std std-ref">begun the deprecation process for some features</span></a>.</p>
<p>如果你要更新现有的项目，请看 <a class="reference internal" href="../howto/upgrade-version.html"><span class="doc">如何将 Django 更新至新的版本</span></a> 指南。</p>
<p>Django 4.2 is designated as a <a class="reference internal" href="../internals/release-process.html#term-Long-term-support-release"><span class="xref std std-term">long-term support release</span></a>. It will receive security updates for at least
three years after its release. Support for the previous LTS, Django 3.2, will
end in April 2024.</p>
<div class="section" id="s-python-compatibility">
<span id="python-compatibility"></span><h2>Python 兼容性<a class="headerlink" href="#python-compatibility" title="永久链接至标题">¶</a></h2>
<p>Django 4.2 supports Python 3.8, 3.9, 3.10, and 3.11. We <strong>highly recommend</strong>
and only officially support the latest release of each series.</p>
</div>
<div class="section" id="s-what-s-new-in-django-4-2">
<span id="s-whats-new-4-2"></span><span id="what-s-new-in-django-4-2"></span><span id="whats-new-4-2"></span><h2>What's new in Django 4.2<a class="headerlink" href="#what-s-new-in-django-4-2" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-psycopg-3-support">
<span id="psycopg-3-support"></span><h3>Psycopg 3 support<a class="headerlink" href="#psycopg-3-support" title="永久链接至标题">¶</a></h3>
<p>Django now supports <a class="reference external" href="https://www.psycopg.org/psycopg3/">psycopg</a> version 3.1.8 or higher. To update your code,
install the <a class="reference external" href="https://pypi.org/project/psycopg/">psycopg library</a>, you don't need to change the
<a class="reference internal" href="../ref/settings.html#std-setting-DATABASE-ENGINE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">ENGINE</span></code></a> as <code class="docutils literal notranslate"><span class="pre">django.db.backends.postgresql</span></code>
supports both libraries.</p>
<p>Support for <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> is likely to be deprecated and removed at some point
in the future.</p>
<p>Be aware that <code class="docutils literal notranslate"><span class="pre">psycopg</span></code> 3 introduces some breaking changes over <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>.
As a consequence, you may need to make some changes to account for
<a class="reference external" href="https://www.psycopg.org/psycopg3/docs/basic/from_pg2.html">differences from psycopg2</a>.</p>
</div>
<div class="section" id="s-comments-on-columns-and-tables">
<span id="comments-on-columns-and-tables"></span><h3>Comments on columns and tables<a class="headerlink" href="#comments-on-columns-and-tables" title="永久链接至标题">¶</a></h3>
<p>The new <a class="reference internal" href="../ref/models/fields.html#django.db.models.Field.db_comment" title="django.db.models.Field.db_comment"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Field.db_comment</span></code></a> and
<a class="reference internal" href="../ref/models/options.html#django.db.models.Options.db_table_comment" title="django.db.models.Options.db_table_comment"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.db_table_comment</span></code></a>
options allow creating comments on columns and tables, respectively. For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Question</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">db_comment</span><span class="o">=</span><span class="s2">&quot;Poll question&quot;</span><span class="p">)</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span>
        <span class="n">db_comment</span><span class="o">=</span><span class="s2">&quot;Date and time when the question was published&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table_comment</span> <span class="o">=</span> <span class="s2">&quot;Poll questions&quot;</span>


<span class="k">class</span> <span class="nc">Answer</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">Question</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">db_comment</span><span class="o">=</span><span class="s2">&quot;Reference to a question&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">db_comment</span><span class="o">=</span><span class="s2">&quot;Question answer&quot;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table_comment</span> <span class="o">=</span> <span class="s2">&quot;Question answers&quot;</span>
</pre></div>
</div>
<p>Also, the new <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.AlterModelTableComment" title="django.db.migrations.operations.AlterModelTableComment"><code class="xref py py-class docutils literal notranslate"><span class="pre">AlterModelTableComment</span></code></a>
operation allows changing table comments defined in the
<a class="reference internal" href="../ref/models/options.html#django.db.models.Options.db_table_comment" title="django.db.models.Options.db_table_comment"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.db_table_comment</span></code></a>.</p>
</div>
<div class="section" id="s-mitigation-for-the-breach-attack">
<span id="mitigation-for-the-breach-attack"></span><h3>Mitigation for the BREACH attack<a class="headerlink" href="#mitigation-for-the-breach-attack" title="永久链接至标题">¶</a></h3>
<p><a class="reference internal" href="../ref/middleware.html#django.middleware.gzip.GZipMiddleware" title="django.middleware.gzip.GZipMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">GZipMiddleware</span></code></a> now includes a mitigation for
the BREACH attack. It will add up to 100 random bytes to gzip responses to make
BREACH attacks harder. Read more about the mitigation technique in the <a class="reference external" href="https://ieeexplore.ieee.org/document/9754554">Heal
The Breach (HTB) paper</a>.</p>
</div>
<div class="section" id="s-in-memory-file-storage">
<span id="in-memory-file-storage"></span><h3>In-memory file storage<a class="headerlink" href="#in-memory-file-storage" title="永久链接至标题">¶</a></h3>
<p>The new <a class="reference internal" href="../ref/files/storage.html#django.core.files.storage.InMemoryStorage" title="django.core.files.storage.InMemoryStorage"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.core.files.storage.InMemoryStorage</span></code></a> class provides a
non-persistent storage useful for speeding up tests by avoiding disk access.</p>
</div>
<div class="section" id="s-custom-file-storages">
<span id="custom-file-storages"></span><h3>Custom file storages<a class="headerlink" href="#custom-file-storages" title="永久链接至标题">¶</a></h3>
<p>The new <a class="reference internal" href="../ref/settings.html#std-setting-STORAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">STORAGES</span></code></a> setting allows configuring multiple custom file
storage backends. It also controls storage engines for managing
<a class="reference internal" href="../topics/files.html"><span class="doc">files</span></a> (the <code class="docutils literal notranslate"><span class="pre">&quot;default&quot;</span></code> key) and <a class="reference internal" href="../ref/contrib/staticfiles.html"><span class="doc">static files</span></a> (the <code class="docutils literal notranslate"><span class="pre">&quot;staticfiles&quot;</span></code> key).</p>
<p>The old <code class="docutils literal notranslate"><span class="pre">DEFAULT_FILE_STORAGE</span></code> and <code class="docutils literal notranslate"><span class="pre">STATICFILES_STORAGE</span></code> settings are
deprecated as of this release.</p>
</div>
<div class="section" id="s-minor-features">
<span id="minor-features"></span><h3>次要特性<a class="headerlink" href="#minor-features" title="永久链接至标题">¶</a></h3>
<div class="section" id="s-django-contrib-admin">
<span id="django-contrib-admin"></span><h4><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#django-contrib-admin" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>The light or dark color theme of the admin can now be toggled in the UI, as
well as being set to follow the system setting.</li>
<li>The admin's font stack now prefers system UI fonts and no longer requires
downloading fonts. Additionally, CSS variables are available to more easily
override the default font families.</li>
<li>The <a class="reference external" href="https://github.com/django/django/blob/main/django/contrib/admin/templates/admin/delete_confirmation.html">admin/delete_confirmation.html</a> template now
has some additional blocks and scripting hooks to ease customization.</li>
<li>The chosen options of
<a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.filter_horizontal" title="django.contrib.admin.ModelAdmin.filter_horizontal"><code class="xref py py-attr docutils literal notranslate"><span class="pre">filter_horizontal</span></code></a> and
<a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.filter_vertical" title="django.contrib.admin.ModelAdmin.filter_vertical"><code class="xref py py-attr docutils literal notranslate"><span class="pre">filter_vertical</span></code></a> widgets are now
filterable.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">admin/base.html</span></code> template now has a new block <code class="docutils literal notranslate"><span class="pre">nav-breadcrumbs</span></code>
which contains the navigation landmark and the <code class="docutils literal notranslate"><span class="pre">breadcrumbs</span></code> block.</li>
<li><a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.list_editable" title="django.contrib.admin.ModelAdmin.list_editable"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ModelAdmin.list_editable</span></code></a> now uses atomic transactions when making
edits.</li>
<li>jQuery is upgraded from version 3.6.0 to 3.6.4.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-auth">
<span id="django-contrib-auth"></span><h4><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a><a class="headerlink" href="#django-contrib-auth" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>The default iteration count for the PBKDF2 password hasher is increased from
390,000 to 600,000.</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.forms.UserCreationForm" title="django.contrib.auth.forms.UserCreationForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserCreationForm</span></code></a> now saves many-to-many
form fields for a custom user model.</li>
<li>The new <a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.forms.BaseUserCreationForm" title="django.contrib.auth.forms.BaseUserCreationForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseUserCreationForm</span></code></a> is now the
recommended base class for customizing the user creation form.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-gis">
<span id="django-contrib-gis"></span><h4><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#django-contrib-gis" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>The <a class="reference internal" href="../ref/contrib/gis/serializers.html"><span class="doc">GeoJSON serializer</span></a> now outputs the
<code class="docutils literal notranslate"><span class="pre">id</span></code> key for serialized features, which defaults to the primary key of
objects.</li>
<li>The <a class="reference internal" href="../ref/contrib/gis/gdal.html#django.contrib.gis.gdal.GDALRaster" title="django.contrib.gis.gdal.GDALRaster"><code class="xref py py-class docutils literal notranslate"><span class="pre">GDALRaster</span></code></a> class now supports
<a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(在 Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a>.</li>
<li>The <a class="reference internal" href="../ref/contrib/gis/geoip2.html#django.contrib.gis.geoip2.GeoIP2" title="django.contrib.gis.geoip2.GeoIP2"><code class="xref py py-class docutils literal notranslate"><span class="pre">GeoIP2</span></code></a> class now supports  <code class="docutils literal notranslate"><span class="pre">.mmdb</span></code>
files downloaded from DB-IP.</li>
<li>The OpenLayers template widget no longer includes inline CSS (which also
removes the former <code class="docutils literal notranslate"><span class="pre">map_css</span></code> block) to better comply with a strict Content
Security Policy.</li>
<li><a class="reference internal" href="../ref/contrib/gis/forms-api.html#django.contrib.gis.forms.widgets.OpenLayersWidget" title="django.contrib.gis.forms.widgets.OpenLayersWidget"><code class="xref py py-class docutils literal notranslate"><span class="pre">OpenLayersWidget</span></code></a> is now based on
OpenLayers 7.2.2 (previously 4.6.5).</li>
<li>The new <a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#std-fieldlookup-isempty"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">isempty</span></code></a> lookup and
<a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.IsEmpty" title="django.contrib.gis.db.models.functions.IsEmpty"><code class="xref py py-class docutils literal notranslate"><span class="pre">IsEmpty()</span></code></a>
expression allow filtering empty geometries on PostGIS.</li>
<li>The new <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.FromWKB" title="django.contrib.gis.db.models.functions.FromWKB"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromWKB()</span></code></a>
and <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.FromWKT" title="django.contrib.gis.db.models.functions.FromWKT"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromWKT()</span></code></a>
functions allow creating geometries from Well-known binary (WKB) and
Well-known text (WKT) representations.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-postgres">
<span id="django-contrib-postgres"></span><h4><a class="reference internal" href="../ref/contrib/postgres/index.html#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a><a class="headerlink" href="#django-contrib-postgres" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>The new <a class="reference internal" href="../ref/contrib/postgres/lookups.html#std-fieldlookup-trigram_strict_word_similar"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">trigram_strict_word_similar</span></code></a> lookup, and the
<a class="reference internal" href="../ref/contrib/postgres/search.html#django.contrib.postgres.search.TrigramStrictWordSimilarity" title="django.contrib.postgres.search.TrigramStrictWordSimilarity"><code class="xref py py-class docutils literal notranslate"><span class="pre">TrigramStrictWordSimilarity()</span></code></a> and
<a class="reference internal" href="../ref/contrib/postgres/search.html#django.contrib.postgres.search.TrigramStrictWordDistance" title="django.contrib.postgres.search.TrigramStrictWordDistance"><code class="xref py py-class docutils literal notranslate"><span class="pre">TrigramStrictWordDistance()</span></code></a> expressions allow
using trigram strict word similarity.</li>
<li>The <a class="reference internal" href="../ref/contrib/postgres/fields.html#std-fieldlookup-arrayfield.overlap"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">arrayfield.overlap</span></code></a> lookup now supports <code class="docutils literal notranslate"><span class="pre">QuerySet.values()</span></code>
and <code class="docutils literal notranslate"><span class="pre">values_list()</span></code> as a right-hand side.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-sitemaps">
<span id="django-contrib-sitemaps"></span><h4><a class="reference internal" href="../ref/contrib/sitemaps.html#module-django.contrib.sitemaps" title="django.contrib.sitemaps: A framework for generating Google sitemap XML files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sitemaps</span></code></a><a class="headerlink" href="#django-contrib-sitemaps" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>The new <a class="reference internal" href="../ref/contrib/sitemaps.html#django.contrib.sitemaps.Sitemap.get_languages_for_item" title="django.contrib.sitemaps.Sitemap.get_languages_for_item"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Sitemap.get_languages_for_item()</span></code></a> method allows customizing the
list of languages for which the item is displayed.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-staticfiles">
<span id="django-contrib-staticfiles"></span><h4><a class="reference internal" href="../ref/contrib/staticfiles.html#module-django.contrib.staticfiles" title="django.contrib.staticfiles: An app for handling static files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a><a class="headerlink" href="#django-contrib-staticfiles" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/contrib/staticfiles.html#django.contrib.staticfiles.storage.ManifestStaticFilesStorage" title="django.contrib.staticfiles.storage.ManifestStaticFilesStorage"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code></a> now
has experimental support for replacing paths to JavaScript modules in
<code class="docutils literal notranslate"><span class="pre">import</span></code> and <code class="docutils literal notranslate"><span class="pre">export</span></code> statements with their hashed counterparts. If you
want to try it, subclass <code class="docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code> and set the
<code class="docutils literal notranslate"><span class="pre">support_js_module_import_aggregation</span></code> attribute to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</li>
<li>The new <a class="reference internal" href="../ref/contrib/staticfiles.html#django.contrib.staticfiles.storage.ManifestStaticFilesStorage.manifest_hash" title="django.contrib.staticfiles.storage.ManifestStaticFilesStorage.manifest_hash"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage.manifest_hash</span></code></a> attribute provides
a hash over all files in the manifest and changes whenever one of the files
changes.</li>
</ul>
</div>
<div class="section" id="s-database-backends">
<span id="database-backends"></span><h4>数据库后端<a class="headerlink" href="#database-backends" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>The new <code class="docutils literal notranslate"><span class="pre">&quot;assume_role&quot;</span></code> option is now supported in <a class="reference internal" href="../ref/settings.html#std-setting-OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">OPTIONS</span></code></a> on
PostgreSQL to allow specifying the <a class="reference internal" href="../ref/databases.html#database-role"><span class="std std-ref">session role</span></a>.</li>
<li>The new <code class="docutils literal notranslate"><span class="pre">&quot;server_side_binding&quot;</span></code> option is now supported in
<a class="reference internal" href="../ref/settings.html#std-setting-OPTIONS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">OPTIONS</span></code></a> on PostgreSQL with <code class="docutils literal notranslate"><span class="pre">psycopg</span></code> 3.1.8+ to allow using
<a class="reference internal" href="../ref/databases.html#database-server-side-parameters-binding"><span class="std std-ref">server-side binding cursors</span></a>.</li>
</ul>
</div>
<div class="section" id="s-error-reporting">
<span id="error-reporting"></span><h4>错误报告<a class="headerlink" href="#error-reporting" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>The debug page now shows <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0678/"><strong>exception notes</strong></a> and
<span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0657/"><strong>fine-grained error locations</strong></a> on Python 3.11+.</li>
<li>Session cookies are now treated as credentials and therefore hidden and
replaced with stars (<code class="docutils literal notranslate"><span class="pre">**********</span></code>) in error reports.</li>
</ul>
</div>
<div class="section" id="s-forms">
<span id="forms"></span><h4>表单<a class="headerlink" href="#forms" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../topics/forms/modelforms.html#django.forms.ModelForm" title="django.forms.ModelForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelForm</span></code></a> now accepts the new <code class="docutils literal notranslate"><span class="pre">Meta</span></code> option
<code class="docutils literal notranslate"><span class="pre">formfield_callback</span></code> to customize form fields.</li>
<li><a class="reference internal" href="../ref/forms/models.html#django.forms.models.modelform_factory" title="django.forms.models.modelform_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">modelform_factory()</span></code></a> now respects the
<code class="docutils literal notranslate"><span class="pre">formfield_callback</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">form</span></code>’s <code class="docutils literal notranslate"><span class="pre">Meta</span></code>.</li>
</ul>
</div>
<div class="section" id="s-internationalization">
<span id="internationalization"></span><h4>国际化<a class="headerlink" href="#internationalization" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Added support and translations for the Central Kurdish (Sorani) language.</li>
</ul>
</div>
<div class="section" id="s-logging">
<span id="logging"></span><h4>日志<a class="headerlink" href="#logging" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>The <a class="reference internal" href="../ref/logging.html#django-db-logger"><span class="std std-ref">django.db.backends</span></a> logger now logs transaction management queries
(<code class="docutils literal notranslate"><span class="pre">BEGIN</span></code>, <code class="docutils literal notranslate"><span class="pre">COMMIT</span></code>, and <code class="docutils literal notranslate"><span class="pre">ROLLBACK</span></code>) at the <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> level.</li>
</ul>
</div>
<div class="section" id="s-management-commands">
<span id="management-commands"></span><h4>管理命令<a class="headerlink" href="#management-commands" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> command now supports locales with private sub-tags
such as <code class="docutils literal notranslate"><span class="pre">nl_NL-x-informal</span></code>.</li>
<li>The new <a class="reference internal" href="../ref/django-admin.html#cmdoption-makemigrations-update"><code class="xref std std-option docutils literal notranslate"><span class="pre">makemigrations</span> <span class="pre">--update</span></code></a> option merges model changes into
the latest migration and optimizes the resulting operations.</li>
</ul>
</div>
<div class="section" id="s-migrations">
<span id="migrations"></span><h4>迁移<a class="headerlink" href="#migrations" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>Migrations now support serialization of <code class="docutils literal notranslate"><span class="pre">enum.Flag</span></code> objects.</li>
</ul>
</div>
<div class="section" id="s-models">
<span id="models"></span><h4>模型<a class="headerlink" href="#models" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> now extensively supports filtering against
<a class="reference internal" href="../ref/models/database-functions.html#window-functions"><span class="std std-ref">窗口函数</span></a> with the exception of disjunctive filter lookups
against window functions when performing aggregation.</li>
<li><a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.prefetch_related" title="django.db.models.query.QuerySet.prefetch_related"><code class="xref py py-meth docutils literal notranslate"><span class="pre">prefetch_related()</span></code></a> now supports
<a class="reference internal" href="../ref/models/querysets.html#django.db.models.Prefetch" title="django.db.models.Prefetch"><code class="xref py py-class docutils literal notranslate"><span class="pre">Prefetch</span></code></a> objects with sliced querysets.</li>
<li><a class="reference internal" href="../ref/models/lookups.html#lookup-registration-api"><span class="std std-ref">Registering lookups</span></a> on
<a class="reference internal" href="../ref/models/fields.html#django.db.models.Field" title="django.db.models.Field"><code class="xref py py-class docutils literal notranslate"><span class="pre">Field</span></code></a> instances is now supported.</li>
<li>The new <code class="docutils literal notranslate"><span class="pre">robust</span></code> argument for <a class="reference internal" href="../topics/db/transactions.html#django.db.transaction.on_commit" title="django.db.transaction.on_commit"><code class="xref py py-func docutils literal notranslate"><span class="pre">on_commit()</span></code></a>
allows performing actions that can fail after a database transaction is
successfully committed.</li>
<li>The new <a class="reference internal" href="../topics/db/queries.html#django.db.models.fields.json.KT" title="django.db.models.fields.json.KT"><code class="xref py py-class docutils literal notranslate"><span class="pre">KT()</span></code></a> expression represents
the text value of a key, index, or path transform of
<a class="reference internal" href="../ref/models/fields.html#django.db.models.JSONField" title="django.db.models.JSONField"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONField</span></code></a>.</li>
<li><a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Now" title="django.db.models.functions.Now"><code class="xref py py-class docutils literal notranslate"><span class="pre">Now</span></code></a> now supports microsecond precision
on MySQL and millisecond precision on SQLite.</li>
<li><a class="reference internal" href="../ref/models/expressions.html#django.db.models.F" title="django.db.models.F"><code class="xref py py-class docutils literal notranslate"><span class="pre">F()</span></code></a> expressions that output <code class="docutils literal notranslate"><span class="pre">BooleanField</span></code>
can now be negated using <code class="docutils literal notranslate"><span class="pre">~F()</span></code> (inversion operator).</li>
<li><code class="docutils literal notranslate"><span class="pre">Model</span></code> now provides asynchronous versions of some methods that use the
database, using an <code class="docutils literal notranslate"><span class="pre">a</span></code> prefix: <a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.adelete" title="django.db.models.Model.adelete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">adelete()</span></code></a>,
<a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.arefresh_from_db" title="django.db.models.Model.arefresh_from_db"><code class="xref py py-meth docutils literal notranslate"><span class="pre">arefresh_from_db()</span></code></a>, and <a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.asave" title="django.db.models.Model.asave"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asave()</span></code></a>.</li>
<li>Related managers now provide asynchronous versions of methods that change a
set of related objects, using an <code class="docutils literal notranslate"><span class="pre">a</span></code> prefix: <a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.aadd" title="django.db.models.fields.related.RelatedManager.aadd"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aadd()</span></code></a>,
<a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.aclear" title="django.db.models.fields.related.RelatedManager.aclear"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aclear()</span></code></a>, <a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.aremove" title="django.db.models.fields.related.RelatedManager.aremove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aremove()</span></code></a>, and
<a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.aset" title="django.db.models.fields.related.RelatedManager.aset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">aset()</span></code></a>.</li>
<li><a class="reference internal" href="../ref/models/fields.html#django.db.models.CharField.max_length" title="django.db.models.CharField.max_length"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CharField.max_length</span></code></a> is no
longer required to be set on PostgreSQL, which supports unlimited <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code>
columns.</li>
</ul>
</div>
<div class="section" id="s-requests-and-responses">
<span id="requests-and-responses"></span><h4>请求和响应<a class="headerlink" href="#requests-and-responses" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/request-response.html#django.http.StreamingHttpResponse" title="django.http.StreamingHttpResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamingHttpResponse</span></code></a> now supports async iterators
when Django is served via ASGI.</li>
</ul>
</div>
<div class="section" id="s-tests">
<span id="tests"></span><h4>测试<a class="headerlink" href="#tests" title="永久链接至标题">¶</a></h4>
<ul>
<li><p class="first">The <a class="reference internal" href="../ref/django-admin.html#cmdoption-test-debug-sql"><code class="xref std std-option docutils literal notranslate"><span class="pre">test</span> <span class="pre">--debug-sql</span></code></a> option now formats SQL queries with
<code class="docutils literal notranslate"><span class="pre">sqlparse</span></code>.</p>
</li>
<li><p class="first">The <a class="reference internal" href="../topics/testing/advanced.html#django.test.RequestFactory" title="django.test.RequestFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestFactory</span></code></a>,
<a class="reference internal" href="../topics/testing/advanced.html#django.test.AsyncRequestFactory" title="django.test.AsyncRequestFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncRequestFactory</span></code></a>, <a class="reference internal" href="../topics/testing/tools.html#django.test.Client" title="django.test.Client"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client</span></code></a>, and
<a class="reference internal" href="../topics/testing/tools.html#django.test.AsyncClient" title="django.test.AsyncClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncClient</span></code></a> classes now support the <code class="docutils literal notranslate"><span class="pre">headers</span></code>
parameter, which accepts a dictionary of header names and values. This allows
a more natural syntax for declaring headers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Before:</span>
<span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/home/&quot;</span><span class="p">,</span> <span class="n">HTTP_ACCEPT_LANGUAGE</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span><span class="p">)</span>
<span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">async_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/home/&quot;</span><span class="p">,</span> <span class="n">ACCEPT_LANGUAGE</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span><span class="p">)</span>

<span class="c1"># After:</span>
<span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/home/&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;accept-language&quot;</span><span class="p">:</span> <span class="s2">&quot;fr&quot;</span><span class="p">})</span>
<span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">async_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/home/&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;accept-language&quot;</span><span class="p">:</span> <span class="s2">&quot;fr&quot;</span><span class="p">})</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="s-utilities">
<span id="utilities"></span><h4>实用程序<a class="headerlink" href="#utilities" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>The new <code class="docutils literal notranslate"><span class="pre">encoder</span></code> parameter for <a class="reference internal" href="../ref/utils.html#django.utils.html.json_script" title="django.utils.html.json_script"><code class="xref py py-meth docutils literal notranslate"><span class="pre">django.utils.html.json_script()</span></code></a>
function allows customizing a JSON encoder class.</li>
<li>The private internal vendored copy of <code class="docutils literal notranslate"><span class="pre">urllib.parse.urlsplit()</span></code> now strips
<code class="docutils literal notranslate"><span class="pre">'\r'</span></code>, <code class="docutils literal notranslate"><span class="pre">'\n'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'\t'</span></code> (see <a class="reference external" href="https://nvd.nist.gov/vuln/detail/CVE-2022-0391">CVE-2022-0391</a> and <a class="reference external" href="https://bugs.python.org/issue?&#64;action=redirect&amp;bpo=43882">bpo-43882</a>).
This is to protect projects that may be incorrectly using the internal
<code class="docutils literal notranslate"><span class="pre">url_has_allowed_host_and_scheme()</span></code> function, instead of using one of the
documented functions for handling URL redirects. The Django functions were
not affected.</li>
<li>The new <a class="reference internal" href="../ref/utils.html#django.utils.http.content_disposition_header" title="django.utils.http.content_disposition_header"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.http.content_disposition_header()</span></code></a> function returns
a <code class="docutils literal notranslate"><span class="pre">Content-Disposition</span></code> HTTP header value as specified by <span class="target" id="index-2"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc6266.html"><strong>RFC 6266</strong></a>.</li>
</ul>
</div>
<div class="section" id="s-validators">
<span id="validators"></span><h4>验证器<a class="headerlink" href="#validators" title="永久链接至标题">¶</a></h4>
<ul class="simple">
<li>The list of common passwords used by <code class="docutils literal notranslate"><span class="pre">CommonPasswordValidator</span></code> is updated
to the most recent version.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-backwards-incompatible-changes-in-4-2">
<span id="s-backwards-incompatible-4-2"></span><span id="backwards-incompatible-changes-in-4-2"></span><span id="backwards-incompatible-4-2"></span><h2>Backwards incompatible changes in 4.2<a class="headerlink" href="#backwards-incompatible-changes-in-4-2" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-database-backend-api">
<span id="database-backend-api"></span><h3>数据库后端 API<a class="headerlink" href="#database-backend-api" title="永久链接至标题">¶</a></h3>
<p>本节介绍了第三方数据库后端可能需要的更改。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.allows_group_by_pk</span></code> is removed as it only remained to
accommodate a MySQL extension that has been supplanted by proper functional
dependency detection in MySQL 5.7.15. Note that
<code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.allows_group_by_selected_pks</span></code> is still supported and
should be enabled if your backend supports functional dependency detection in
<code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> clauses as specified by the <code class="docutils literal notranslate"><span class="pre">SQL:1999</span></code> standard.</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-inspectdb"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">inspectdb</span></code></a> now uses <code class="docutils literal notranslate"><span class="pre">display_size</span></code> from
<code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.get_table_description()</span></code> rather than
<code class="docutils literal notranslate"><span class="pre">internal_size</span></code> for <code class="docutils literal notranslate"><span class="pre">CharField</span></code>.</li>
</ul>
</div>
<div class="section" id="s-dropped-support-for-mariadb-10-3">
<span id="dropped-support-for-mariadb-10-3"></span><h3>Dropped support for MariaDB 10.3<a class="headerlink" href="#dropped-support-for-mariadb-10-3" title="永久链接至标题">¶</a></h3>
<p>Upstream support for MariaDB 10.3 ends in May 2023. Django 4.2 supports MariaDB
10.4 and higher.</p>
</div>
<div class="section" id="s-dropped-support-for-mysql-5-7">
<span id="dropped-support-for-mysql-5-7"></span><h3>Dropped support for MySQL 5.7<a class="headerlink" href="#dropped-support-for-mysql-5-7" title="永久链接至标题">¶</a></h3>
<p>Upstream support for MySQL 5.7 ends in October 2023. Django 4.2 supports MySQL
8 and higher.</p>
</div>
<div class="section" id="s-dropped-support-for-postgresql-11">
<span id="dropped-support-for-postgresql-11"></span><h3>Dropped support for PostgreSQL 11<a class="headerlink" href="#dropped-support-for-postgresql-11" title="永久链接至标题">¶</a></h3>
<p>Upstream support for PostgreSQL 11 ends in November 2023. Django 4.2 supports
PostgreSQL 12 and higher.</p>
</div>
<div class="section" id="s-setting-update-fields-in-model-save-may-now-be-required">
<span id="setting-update-fields-in-model-save-may-now-be-required"></span><h3>Setting <code class="docutils literal notranslate"><span class="pre">update_fields</span></code> in <code class="docutils literal notranslate"><span class="pre">Model.save()</span></code> may now be required<a class="headerlink" href="#setting-update-fields-in-model-save-may-now-be-required" title="永久链接至标题">¶</a></h3>
<p>In order to avoid updating unnecessary columns,
<a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.update_or_create" title="django.db.models.query.QuerySet.update_or_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.update_or_create()</span></code></a> now passes <code class="docutils literal notranslate"><span class="pre">update_fields</span></code> to the
<a class="reference internal" href="../ref/models/instances.html#django.db.models.Model.save" title="django.db.models.Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.save()</span></code></a> calls. As a consequence, any
fields modified in the custom <code class="docutils literal notranslate"><span class="pre">save()</span></code> methods should be added to the
<code class="docutils literal notranslate"><span class="pre">update_fields</span></code> keyword argument before calling <code class="docutils literal notranslate"><span class="pre">super()</span></code>. See
<a class="reference internal" href="../topics/db/models.html#overriding-model-methods"><span class="std std-ref">重写之前定义的模型方法</span></a> for more details.</p>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h3>杂项<a class="headerlink" href="#miscellaneous" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li>The undocumented <code class="docutils literal notranslate"><span class="pre">django.http.multipartparser.parse_header()</span></code> function is
removed. Use <code class="docutils literal notranslate"><span class="pre">django.utils.http.parse_header_parameters()</span></code> instead.</li>
<li><a class="reference internal" href="../topics/i18n/translation.html#std-templatetag-blocktranslate"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">asvar</span> <span class="pre">…</span> <span class="pre">%}</span></code></a> result is now marked as
safe for (HTML) output purposes.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">autofocus</span></code> HTML attribute in the admin search box is removed as it can
be confusing for screen readers.</li>
<li>The <a class="reference internal" href="../ref/django-admin.html#cmdoption-makemigrations-check"><code class="xref std std-option docutils literal notranslate"><span class="pre">makemigrations</span> <span class="pre">--check</span></code></a> option no longer creates missing
migration files.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">alias</span></code> argument for <a class="reference internal" href="../ref/models/expressions.html#django.db.models.Expression.get_group_by_cols" title="django.db.models.Expression.get_group_by_cols"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Expression.get_group_by_cols()</span></code></a> is removed.</li>
<li>The minimum supported version of <code class="docutils literal notranslate"><span class="pre">sqlparse</span></code> is increased from 0.2.2 to
0.3.1.</li>
<li>The undocumented <code class="docutils literal notranslate"><span class="pre">negated</span></code> parameter of the
<a class="reference internal" href="../ref/models/expressions.html#django.db.models.Exists" title="django.db.models.Exists"><code class="xref py py-class docutils literal notranslate"><span class="pre">Exists</span></code></a> expression is removed.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">is_summary</span></code> argument of the undocumented <code class="docutils literal notranslate"><span class="pre">Query.add_annotation()</span></code>
method is removed.</li>
<li>The minimum supported version of SQLite is increased from 3.9.0 to 3.21.0.</li>
<li>The minimum supported version of <code class="docutils literal notranslate"><span class="pre">asgiref</span></code> is increased from 3.5.2 to
3.6.0.</li>
<li><a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.forms.UserCreationForm" title="django.contrib.auth.forms.UserCreationForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserCreationForm</span></code></a> now rejects usernames
that differ only in case. If you need the previous behavior, use
<a class="reference internal" href="../topics/auth/default.html#django.contrib.auth.forms.BaseUserCreationForm" title="django.contrib.auth.forms.BaseUserCreationForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseUserCreationForm</span></code></a> instead.</li>
<li>The minimum supported version of <code class="docutils literal notranslate"><span class="pre">mysqlclient</span></code> is increased from 1.4.0 to
1.4.3.</li>
<li>The minimum supported version of <code class="docutils literal notranslate"><span class="pre">argon2-cffi</span></code> is increased  from 19.1.0 to
19.2.0.</li>
<li>The minimum supported version of <code class="docutils literal notranslate"><span class="pre">Pillow</span></code> is increased from 6.2.0 to 6.2.1.</li>
<li>The minimum supported version of <code class="docutils literal notranslate"><span class="pre">jinja2</span></code> is increased from 2.9.2 to
2.11.0.</li>
<li>The minimum supported version of <a class="reference external" href="https://pypi.org/project/redis/">redis-py</a> is increased from
3.0.0 to 3.4.0.</li>
<li>Manually instantiated <code class="docutils literal notranslate"><span class="pre">WSGIRequest</span></code> objects must be provided a file-like
object for <code class="docutils literal notranslate"><span class="pre">wsgi.input</span></code>. Previously, Django was more lax than the expected
behavior as specified by the WSGI specification.</li>
<li>Support for <code class="docutils literal notranslate"><span class="pre">PROJ</span></code> &lt; 5 is removed.</li>
<li><a class="reference internal" href="../topics/email.html#django.core.mail.backends.smtp.EmailBackend" title="django.core.mail.backends.smtp.EmailBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">EmailBackend</span></code></a> now verifies a
<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext.check_hostname" title="(在 Python v3.11)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">hostname</span></code></a> and
<a class="reference external" href="https://docs.python.org/3/library/ssl.html#ssl.SSLContext.verify_mode" title="(在 Python v3.11)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">certificates</span></code></a>. If you need the
previous behavior that is less restrictive and not recommended, subclass
<code class="docutils literal notranslate"><span class="pre">EmailBackend</span></code> and override the <code class="docutils literal notranslate"><span class="pre">ssl_context</span></code> property.</li>
</ul>
</div>
</div>
<div class="section" id="s-features-deprecated-in-4-2">
<span id="s-deprecated-features-4-2"></span><span id="features-deprecated-in-4-2"></span><span id="deprecated-features-4-2"></span><h2>Features deprecated in 4.2<a class="headerlink" href="#features-deprecated-in-4-2" title="永久链接至标题">¶</a></h2>
<div class="section" id="s-index-together-option-is-deprecated-in-favor-of-indexes">
<span id="index-together-option-is-deprecated-in-favor-of-indexes"></span><h3><code class="docutils literal notranslate"><span class="pre">index_together</span></code> option is deprecated in favor of <code class="docutils literal notranslate"><span class="pre">indexes</span></code><a class="headerlink" href="#index-together-option-is-deprecated-in-favor-of-indexes" title="永久链接至标题">¶</a></h3>
<p>The <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.index_together" title="django.db.models.Options.index_together"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.index_together</span></code></a>
option is deprecated in favor of the <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.indexes" title="django.db.models.Options.indexes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">indexes</span></code></a>
option.</p>
<p>Migrating existing <code class="docutils literal notranslate"><span class="pre">index_together</span></code> should be handled as a migration. For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">rank</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">index_together</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]]</span>
</pre></div>
</div>
<p>Should become:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">rank</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;rank&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">])]</span>
</pre></div>
</div>
<p>Running the <a class="reference internal" href="../ref/django-admin.html#django-admin-makemigrations"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemigrations</span></code></a> command will generate a migration
containing a <a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RenameIndex" title="django.db.migrations.operations.RenameIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">RenameIndex</span></code></a> operation
which will rename the existing index. Next, consider squashing migrations to
remove <code class="docutils literal notranslate"><span class="pre">index_together</span></code> from historical migrations.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">AlterIndexTogether</span></code> migration operation is now officially supported only
for pre-Django 4.2 migration files. For backward compatibility reasons, it's
still part of the public API, and there's no plan to deprecate or remove it,
but it should not be used for new migrations. Use
<a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.AddIndex" title="django.db.migrations.operations.AddIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">AddIndex</span></code></a> and
<a class="reference internal" href="../ref/migration-operations.html#django.db.migrations.operations.RemoveIndex" title="django.db.migrations.operations.RemoveIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoveIndex</span></code></a> operations instead.</p>
</div>
<div class="section" id="s-passing-encoded-json-string-literals-to-jsonfield-is-deprecated">
<span id="passing-encoded-json-string-literals-to-jsonfield-is-deprecated"></span><h3>Passing encoded JSON string literals to <code class="docutils literal notranslate"><span class="pre">JSONField</span></code> is deprecated<a class="headerlink" href="#passing-encoded-json-string-literals-to-jsonfield-is-deprecated" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">JSONField</span></code> and its associated lookups and aggregates used to allow passing
JSON encoded string literals which caused ambiguity on whether string literals
were already encoded from database backend's perspective.</p>
<p>During the deprecation period string literals will be attempted to be JSON
decoded and a warning will be emitted on success that points at passing
non-encoded forms instead.</p>
<p>Code that use to pass JSON encoded string literals:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">bulk_create</span><span class="p">(</span>
    <span class="n">Document</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;null&quot;</span><span class="p">)),</span>
    <span class="n">Document</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;[]&quot;</span><span class="p">)),</span>
    <span class="n">Document</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Value</span><span class="p">(</span><span class="s1">&#39;&quot;foo-bar&quot;&#39;</span><span class="p">)),</span>
<span class="p">)</span>
<span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="n">JSONBAgg</span><span class="p">(</span><span class="s2">&quot;field&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;[]&quot;</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Should become:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">bulk_create</span><span class="p">(</span>
    <span class="n">Document</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Value</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">JSONField</span><span class="p">())),</span>
    <span class="n">Document</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[]),</span>
    <span class="n">Document</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s2">&quot;foo-bar&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">Document</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="n">JSONBAgg</span><span class="p">(</span><span class="s2">&quot;field&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[]),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>From Django 5.1+ string literals will be implicitly interpreted as JSON string
literals.</p>
</div>
<div class="section" id="s-id1">
<span id="id1"></span><h3>杂项<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<ul>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">BaseUserManager.make_random_password()</span></code> method is deprecated. See
<a class="reference external" href="https://docs.python.org/3/library/secrets.html#recipes-and-best-practices">recipes and best practices</a>
for using Python's <a class="reference external" href="https://docs.python.org/3/library/secrets.html#module-secrets" title="(在 Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">secrets</span></code></a> module to generate passwords.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">length_is</span></code> template filter is deprecated in favor of <a class="reference internal" href="../ref/templates/builtins.html#std-templatefilter-length"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">length</span></code></a>
and the <code class="docutils literal notranslate"><span class="pre">==</span></code> operator within an <a class="reference internal" href="../ref/templates/builtins.html#std-templatetag-if"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">%}</span></code></a> tag. For example</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">value</span><span class="o">|</span><span class="nf">length</span> <span class="o">==</span> <span class="m">4</span> <span class="cp">%}</span>…<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">value</span><span class="o">|</span><span class="nf">length</span> <span class="o">==</span> <span class="m">4</span> <span class="cp">%}</span>True<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>False<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>instead of:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">value</span><span class="o">|</span><span class="nf">length_is</span><span class="o">:</span><span class="m">4</span> <span class="cp">%}</span>…<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">value</span><span class="o">|</span><span class="nf">length_is</span><span class="o">:</span><span class="m">4</span> <span class="cp">}}</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">django.contrib.auth.hashers.SHA1PasswordHasher</span></code>,
<code class="docutils literal notranslate"><span class="pre">django.contrib.auth.hashers.UnsaltedSHA1PasswordHasher</span></code>, and
<code class="docutils literal notranslate"><span class="pre">django.contrib.auth.hashers.UnsaltedMD5PasswordHasher</span></code> are deprecated.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.fields.CICharField</span></code> is deprecated in favor of
<code class="docutils literal notranslate"><span class="pre">CharField(db_collation=&quot;…&quot;)</span></code> with a case-insensitive non-deterministic
collation.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.fields.CIEmailField</span></code> is deprecated in favor of
<code class="docutils literal notranslate"><span class="pre">EmailField(db_collation=&quot;…&quot;)</span></code> with a case-insensitive non-deterministic
collation.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.fields.CITextField</span></code> is deprecated in favor of
<code class="docutils literal notranslate"><span class="pre">TextField(db_collation=&quot;…&quot;)</span></code> with a case-insensitive non-deterministic
collation.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">django.contrib.postgres.fields.CIText</span></code> mixin is deprecated.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">map_height</span></code> and <code class="docutils literal notranslate"><span class="pre">map_width</span></code> attributes of <code class="docutils literal notranslate"><span class="pre">BaseGeometryWidget</span></code> are
deprecated, use CSS to size map widgets instead.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">SimpleTestCase.assertFormsetError()</span></code> is deprecated in favor of
<code class="docutils literal notranslate"><span class="pre">assertFormSetError()</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">TransactionTestCase.assertQuerysetEqual()</span></code> is deprecated in favor of
<code class="docutils literal notranslate"><span class="pre">assertQuerySetEqual()</span></code>.</p>
</li>
<li><p class="first">Passing positional arguments to <code class="docutils literal notranslate"><span class="pre">Signer</span></code> and <code class="docutils literal notranslate"><span class="pre">TimestampSigner</span></code> is
deprecated in favor of keyword-only arguments.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">DEFAULT_FILE_STORAGE</span></code> setting is deprecated in favor of
<code class="docutils literal notranslate"><span class="pre">STORAGES[&quot;default&quot;]</span></code>.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">STATICFILES_STORAGE</span></code> setting is deprecated in favor of
<code class="docutils literal notranslate"><span class="pre">STORAGES[&quot;staticfiles&quot;]</span></code>.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">django.core.files.storage.get_storage_class()</span></code> function is deprecated.</p>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../contents.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">Django 4.2 release notes</a><ul>
<li><a class="reference internal" href="#python-compatibility">Python 兼容性</a></li>
<li><a class="reference internal" href="#what-s-new-in-django-4-2">What's new in Django 4.2</a><ul>
<li><a class="reference internal" href="#psycopg-3-support">Psycopg 3 support</a></li>
<li><a class="reference internal" href="#comments-on-columns-and-tables">Comments on columns and tables</a></li>
<li><a class="reference internal" href="#mitigation-for-the-breach-attack">Mitigation for the BREACH attack</a></li>
<li><a class="reference internal" href="#in-memory-file-storage">In-memory file storage</a></li>
<li><a class="reference internal" href="#custom-file-storages">Custom file storages</a></li>
<li><a class="reference internal" href="#minor-features">次要特性</a><ul>
<li><a class="reference internal" href="#django-contrib-admin"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-auth"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-gis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-postgres"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-sitemaps"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.sitemaps</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-staticfiles"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a></li>
<li><a class="reference internal" href="#database-backends">数据库后端</a></li>
<li><a class="reference internal" href="#error-reporting">错误报告</a></li>
<li><a class="reference internal" href="#forms">表单</a></li>
<li><a class="reference internal" href="#internationalization">国际化</a></li>
<li><a class="reference internal" href="#logging">日志</a></li>
<li><a class="reference internal" href="#management-commands">管理命令</a></li>
<li><a class="reference internal" href="#migrations">迁移</a></li>
<li><a class="reference internal" href="#models">模型</a></li>
<li><a class="reference internal" href="#requests-and-responses">请求和响应</a></li>
<li><a class="reference internal" href="#tests">测试</a></li>
<li><a class="reference internal" href="#utilities">实用程序</a></li>
<li><a class="reference internal" href="#validators">验证器</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-incompatible-changes-in-4-2">Backwards incompatible changes in 4.2</a><ul>
<li><a class="reference internal" href="#database-backend-api">数据库后端 API</a></li>
<li><a class="reference internal" href="#dropped-support-for-mariadb-10-3">Dropped support for MariaDB 10.3</a></li>
<li><a class="reference internal" href="#dropped-support-for-mysql-5-7">Dropped support for MySQL 5.7</a></li>
<li><a class="reference internal" href="#dropped-support-for-postgresql-11">Dropped support for PostgreSQL 11</a></li>
<li><a class="reference internal" href="#setting-update-fields-in-model-save-may-now-be-required">Setting <code class="docutils literal notranslate"><span class="pre">update_fields</span></code> in <code class="docutils literal notranslate"><span class="pre">Model.save()</span></code> may now be required</a></li>
<li><a class="reference internal" href="#miscellaneous">杂项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-deprecated-in-4-2">Features deprecated in 4.2</a><ul>
<li><a class="reference internal" href="#index-together-option-is-deprecated-in-favor-of-indexes"><code class="docutils literal notranslate"><span class="pre">index_together</span></code> option is deprecated in favor of <code class="docutils literal notranslate"><span class="pre">indexes</span></code></a></li>
<li><a class="reference internal" href="#passing-encoded-json-string-literals-to-jsonfield-is-deprecated">Passing encoded JSON string literals to <code class="docutils literal notranslate"><span class="pre">JSONField</span></code> is deprecated</a></li>
<li><a class="reference internal" href="#id1">杂项</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>上一个主题</h4>
    <p class="topless"><a href="4.2.1.html"
                          title="上一章">Django 4.2.1 release notes</a></p>
  </div>
  <div>
    <h4>下一个主题</h4>
    <p class="topless"><a href="4.1.11.html"
                          title="下一章">Django 4.1.11 release notes</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="../sources/releases/4.2.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">9月 04, 2023</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="4.2.1.html" title="Django 4.2.1 release notes">previous</a>
     |
    <a href="index.html" title="发行说明" accesskey="U">up</a>
   |
    <a href="4.1.11.html" title="Django 4.1.11 release notes">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>